<div id="start_parsons_container">
    <div class="flex flex-col">
        <div class="flex items-center justify-center bg-blue-200 p-10">
            <img class="rounded-full border-green-600 border-8 w-80" src="{{ static('/images/quiz_logo.jpg') }}" alt="quiz_logo"/>
        </div>
        <div class="p-8 border-t-8 bg-blue-400 border-blue-600">
            <h1 class="text-center text-white font-bold font-slab">{{_('start_parsons')}}</h1>
            <h2 class="text-center text-white"><i> {{_('level_title')}} {{ level }} </i></h2>
        </div>
    </div>
    <div class="flex py-4 px-4 bg-green-300 justify-between border-t-8 border-green-600">
        <button class="green-btn ltr:ml-1 rtl:mr-1" onclick="hedyApp.startParsons({{level}});">
            {{_('go_to_first_exercise')}}
        </button>
    </div>
</div>
<div id="parsons_container" class="hidden">
    {% if parsons_exercises > 1 %}
        <div class="flex flex-row items-center justify-around gap-2 border-b-2 border-gray-500 pb-2">
            {% for i in range(1, parsons_exercises + 1)%}
                {% if i == 1 %}
                 <div class="step current bg-gray-200" id="question_header_{{i}}"><span class="question_header_text_container" id="parsons_header_text_{{i}}">{{_('exercise')}}</span> {{ i }}</div>
                {% else %}
                    <div class="step {% if i % 2 == 0 %}bg-gray-400{% else %}bg-gray-200{% endif %}" id="parsons_header_{{i}}"><span class="question_header_text_container" id="parsons_header_text_{{i}}" style="display: none;">{{_('exercise')}}</span> {{ i }}</div>
                {% endif %}
            {% endfor %}
        </div>
    {% endif %}
    <div id="parsons_exercise_container" class="pt-2">
        <div class="flex flex-row">
            <div class="w-1/2 ltr:mr-2 rtl:ml-2">
                <p id="parsons_explanation_text"></p>
                <!-- Let's hard-code 10 possible lines, not really nice: but same approach as quiz. We should improve these two together later on -->
                <div class="flex flex-col mx-auto items-center" id="parsons_code_lines">
                    <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_start_line_container" style="background-color: #272822;" id="parsons_start_line_container_1">
                        <div index="" draggable="true" id="start_parsons_div_1" code="" class="start-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                        <pre level="{{ level }}" id="start_parsons_1" class="no-copy-button parsons text-sm"></pre>
                    </div>
                    <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_start_line_container" style="background-color: #272822;" id="parsons_start_line_container_2">
                        <div index="" draggable="true" id="start_parsons_div_2" code="" class="start-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                        <pre level="{{ level }}" id="start_parsons_2" class="no-copy-button parsons text-sm"></pre>
                    </div>
                    <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_start_line_container" style="background-color: #272822;" id="parsons_start_line_container_3">
                        <div index="" draggable="true" id="start_parsons_div_3" code="" class="start-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                        <pre level="{{ level }}" id="start_parsons_3" class="no-copy-button parsons text-sm"></pre>
                    </div>
                    <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_start_line_container" style="background-color: #272822;" id="parsons_start_line_container_4">
                        <div index="" draggable="true" id="start_parsons_div_4" code="" class="start-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                        <pre level="{{ level }}" id="start_parsons_4" class="no-copy-button parsons text-sm"></pre>
                    </div>
                    <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_start_line_container" style="background-color: #272822;" id="parsons_start_line_container_5">
                        <div index="" draggable="true" id="start_parsons_div_5" code="" class="start-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                        <pre level="{{ level }}" id="start_parsons_5" class="no-copy-button parsons text-sm"></pre>
                    </div>
                    <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_start_line_container" style="background-color: #272822;" id="parsons_start_line_container_6">
                        <div index="" draggable="true" id="start_parsons_div_6" code="" class="start-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                        <pre level="{{ level }}" id="start_parsons_6" class="no-copy-button parsons text-sm"></pre>
                    </div>
                    <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_start_line_container" style="background-color: #272822;" id="parsons_start_line_container_7">
                        <div index="" draggable="true" id="start_parsons_div_7" code="" class="start-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                        <pre level="{{ level }}" id="start_parsons_7" class="no-copy-button parsons text-sm"></pre>
                    </div>
                    <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_start_line_container" style="background-color: #272822;" id="parsons_start_line_container_8">
                        <div index="" draggable="true" id="start_parsons_div_8" code="" class="start-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                        <pre level="{{ level }}" id="start_parsons_8" class="no-copy-button parsons text-sm"></pre>
                    </div>
                    <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_start_line_container" style="background-color: #272822;" id="parsons_start_line_container_9">
                        <div index="" draggable="true" id="start_parsons_div_9" code="" class="start-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                        <pre level="{{ level }}" id="start_parsons_9" class="no-copy-button parsons text-sm"></pre>
                    </div>
                    <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_start_line_container" style="background-color: #272822;" id="parsons_start_line_container_10">
                        <div index="" draggable="true" id="start_parsons_div_10" code="" class="start-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                        <pre level="{{ level }}" id="start_parsons_10" class="no-copy-button parsons text-sm"></pre>
                    </div>
                </div>
            </div>
            <div class="w-1/2 ltr:ml-2 rtl:mr-2">
                <h2 class="text-center">{{_('what_should_my_code_do')}}</h2>
                <p id="parsons_explanation_story" class="mx-4 whitespace-pre-wrap"></p>
            </div>
        </div>
        <div class="ltr:clear-right rtl:clear-left"></div>
    </div>
    <div id="parsons_code_container" class="grid grid-cols-1 lg:grid-cols-2 gap-4 border-t-2 border-gray-500 pt-4">
        <div class="flex flex-col justify-between">
            <div>
                <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_goal_line_container" style="background-color: #272822;" id="parsons_goal_line_container_1">
                   <div index="-" draggable="true" code="" class="compiler-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                   <pre level="{{ level }}" id="goal_parsons_1" class="no-copy-button parsons text-sm"></pre>
               </div>
               <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_goal_line_container" style="background-color: #272822;" id="parsons_goal_line_container_2">
                   <div index="-" draggable="true" code="" class="compiler-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                   <pre level="{{ level }}" id="goal_parsons_2" class="no-copy-button parsons text-sm"></pre>
               </div>
               <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_goal_line_container" style="background-color: #272822;" id="parsons_goal_line_container_3">
                   <div index="-" draggable="true" code="" class="compiler-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                   <pre level="{{ level }}" id="goal_parsons_3" class="no-copy-button parsons text-sm"></pre>
               </div>
               <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_goal_line_container" style="background-color: #272822;" id="parsons_goal_line_container_4">
                   <div index="-" draggable="true" code="" class="compiler-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                   <pre level="{{ level }}" id="goal_parsons_4" class="no-copy-button parsons text-sm"></pre>
               </div>
               <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_goal_line_container" style="background-color: #272822;" id="parsons_goal_line_container_5">
                   <div index="-" draggable="true" code="" class="compiler-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                   <pre level="{{ level }}" id="goal_parsons_5" class="no-copy-button parsons text-sm"></pre>
               </div>
               <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_goal_line_container" style="background-color: #272822;" id="parsons_goal_line_container_6">
                   <div index="-" draggable="true" code="" class="compiler-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                   <pre level="{{ level }}" id="goal_parsons_6" class="no-copy-button parsons text-sm"></pre>
               </div>
               <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_goal_line_container" style="background-color: #272822;" id="parsons_goal_line_container_7">
                   <div index="-" draggable="true" code="" class="compiler-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                   <pre level="{{ level }}" id="goal_parsons_7" class="no-copy-button parsons text-sm"></pre>
               </div>
               <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_goal_line_container" style="background-color: #272822;" id="parsons_goal_line_container_8">
                   <div index="-" draggable="true" code="" class="compiler-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                   <pre level="{{ level }}" id="goal_parsons_8" class="no-copy-button parsons text-sm"></pre>
               </div>
               <div class="relative w-full mb-2 border-4 border-black rounded-lg parsons_goal_line_container" style="background-color: #272822;" id="parsons_goal_line_container_9">
                   <div index="-" draggable="true" code="" class="compiler-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                   <pre level="{{ level }}" id="goal_parsons_9" class="no-copy-button parsons text-sm"></pre>
               </div>
               <div class="relative turn-pre-into-ace w-full mb-2 border-4 border-black rounded-lg parsons_goal_line_container" style="background-color: #272822;" id="parsons_goal_line_container_10">
                   <div index="-" draggable="true" code="" class="compiler-parsons-box w-full absolute inset-0 z-10 rounded-lg"></div>
                   <pre level="{{ level }}" id="goal_parsons_10" class="no-copy-button parsons text-sm"></pre>
               </div>
            </div>
            <div class="flex flex-row justify-between">
                <div id="runButtonContainer">
                  <button id="runit" class="green-btn" onclick="hedyApp.runit({{ level }}, '{{ g.lang }}', '{{_('already_program_running')}}')">{{_('run_code_button')}} </button>
                  <button id="stopit" class="red-btn" onclick="hedyApp.stopit()" style="display: none;">{{_('stop_code_button')}}</button>
                </div>
                <button id="nextExercise" class="green-btn" style="display: none;" onclick="hedyApp.loadNextExercise();">{{_('next_exercise')}}</button>
            </div>
        </div>
        <div>
            <div class="flex flex-col order-3 relative" id="parsons_code_output" style="height: 22rem;">
              <div id="output" tabindex=0 class="flex-1 rounded p-2 px-3 bg-gray-900 color-white w-full text-lg overflow-auto" style="min-height: 3rem"></div>
              <div id="turtlecanvas" class="flex-0 ltr:pl-4 rtl:pr-4"></div>
              <div id="inline-modal" class="flex-0" style="display: none">
                <div class="py-2 text-left px-3 border-4 border-teal-500 mt-3 rounded bg-green-100">
                  <!--Title-->
                  <div class="flex justify-between items-center">
                    <p class="text-2xl font-bold caption">Header</p>
                  </div>
                  <!--Body-->
                  <form>
                    <div class="my-2 flex">
                      <input type="text" class="border border-green-400 rounded p-2 px-3 w-3/4" placeholder="{{_('enter_text')}}">
                      <input type="submit" onclick="hedyApp.ScrollOutputToBottom()" class="green-btn ltr:ml-3 rtl:mr-3" value="{{_('enter')}}"></p>
                    </div>
                  </form>
                </div>
              </div>
            </div>
        </div>
    </div>
</div>
<!-- Todo TB: This is fine for now, but we should move this to app.ts in the near future (05-22) -->
<script>
document.addEventListener('DOMContentLoaded', (event) => {
     function handleDragStart(e){
         this.style.opacity = 0.4;
         this.style.background = "#272822";

         dragSrcEl = this;

         $('.parsons_goal_line_container').removeClass('border-green-500 border-red-500');
         $('.parsons_goal_line_container').addClass('border-black');

         e.dataTransfer.effectAllowed = 'move';
         e.dataTransfer.setData('code', this.getAttribute('code'));
         e.dataTransfer.setData('text/plain', this.getAttribute('index'));
     }

     function handleDragEnd(e) {
         this.style.opacity = '1';
         this.style.background = "";

         start_items.forEach(function (item) {
             item.classList.remove('over');
         });
         goal_items.forEach(function (item) {
             item.classList.remove('over');
         });
     }

     function handleDragOver(e) {
         e.preventDefault();
     }

     function handleDrop(e) {
         e.stopPropagation(); // stops the browser from redirecting.

         if (dragSrcEl !== this) {
             // Now it gets complex: also update both ace editors
             let start_ace = ace.edit(dragSrcEl.parentNode.childNodes[3].getAttribute('id'));
             let goal_ace = ace.edit(this.parentNode.childNodes[3].getAttribute('id'));

             start_ace.session.setValue(this.getAttribute('code').replace(/\n+$/, ''), -1);
             goal_ace.session.setValue(e.dataTransfer.getData('code').replace(/\n+$/, ''), -1);

             dragSrcEl.setAttribute('index', this.getAttribute('index'));
             dragSrcEl.setAttribute('code', this.getAttribute('code'));

             this.setAttribute('index', e.dataTransfer.getData('text/plain'));
             this.setAttribute('code', e.dataTransfer.getData('code'));
         }
         return false;
     }

     let start_items = document.querySelectorAll('.start-parsons-box');
     start_items.forEach(function (item) {
         item.addEventListener('dragstart', handleDragStart);
         item.addEventListener('dragover', handleDragOver);
         item.addEventListener('dragend', handleDragEnd);
         item.addEventListener('drop', handleDrop);
     });
     let goal_items = document.querySelectorAll('.compiler-parsons-box');
     goal_items.forEach(function (item) {
         item.addEventListener('dragstart', handleDragStart);
         item.addEventListener('dragover', handleDragOver);
         item.addEventListener('dragend', handleDragEnd);
         item.addEventListener('drop', handleDrop);
     });
 });
</script>