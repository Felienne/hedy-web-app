{% extends "auth.html" %}

{% block regular_content %}
{% if tutorial %}
<div id = "tutorial-pop-up" class = "z-50 fixed hidden" style = "width: 500px; top: 20%; left: 50%; transform: translate(-50%, -50%);" >
      <div class = "bg-blue-500 border border-black rounded-lg px-8 py-4 text-center" >
          <h2 id = "tutorial_title" class = "text-white" > </h2 >
          <p id = "tutorial_text" > </p >
          <button id = "tutorial_next_button" class = "green-btn mt-4" > {{_('next_step_tutorial')}} < /button >
      </div >
  </div>
{% endif %}
<div class="flex-col">
  <div class="flex flex-row gap-4 mb-8 mt-10 md:px-16">
    <div class="flex flex-col items-left gap-3 pb-4 bg-gray-200 border border-gray-400 px-10 rounded-lg w-full lg:w-1/4 p-8">
      <h2 class="m-0"> {{_('classes')}} </h2>
      <div class="text-black">
      <p>{{ _('classes_info') }}</p>
      </div>
      <div class="flex flex-row gap-3 justify-end">
        <button class="green-btn inline-flex items-center" id="create_class_button" onclick='hedyApp.create_class ({{_('class_name_prompt')|default(None)|tojson}})'
        {% if second_teacher and role == 'viewer' %}disabled{% endif %}>{{_('create_class')}}</button>
        <button class="white-btn inline-flex items-center gap-2"
        _="on click toggle .hidden on #classes_table
        set t to #adventures_table
        if not t.classList.contains('hidden')
          toggle .hidden on #adventures_table
          remove .rotate-180 from #adventures_arrow end
        on click
        set arrow to #classes_arrow
        if not arrow.classList.contains('rotate-180')
          add .rotate-180 to arrow
        else
          remove .rotate-180 from arrow"
        >
        <span>{{_('view_classes')}}</span>
        <svg id="classes_arrow" class="fill-current h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
          <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
        </svg>
      </button>
      </div>
    </div>
    <div class="flex flex-col items-left gap-3 pb-10 bg-gray-200 border border-gray-400 px-10 rounded-lg w-full lg:w-1/4 p-8">
      <h2 class="m-0"> {{_('adventures')}} </h2>
      <div class="text-black">{{ _('adventures_info') }}</div>
      <div class="flex flex-row gap-3">
            <button id="create_adventure_button" class="green-btn inline-flex items-center" 
              hx-trigger="click"
              hx-post="/for-teachers/create-adventure"
              hx-swap="none"
              _="on htmx:afterRequest if detail.xhr.response
              window.open('/for-teachers/customize-adventure/' + detail.xhr.response, '_self')"
              data-cy="edit-link"{% if second_teacher and role == 'viewer' %}disabled{% endif %}>{{_('create_adventure')}}</button>
            <button class="white-btn inline-flex items-center"
            _="on click toggle .hidden on #adventures_table
            set t to #classes_table
            if not t.classList.contains('hidden')
              toggle .hidden on #classes_table
              remove .rotate-180 from #classes_arrow end
            on click
            set arrow to #adventures_arrow
            if not arrow.classList.contains('rotate-180')
              add .rotate-180 to arrow
            else
              remove .rotate-180 from arrow">
            <span>{{_('view_adventures')}}</span>
            <svg id="adventures_arrow" class="fill-current h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
              <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
            </svg>
          </button>
          <button id="public-adventures-link" class="blue-btn inline-flex items-center"
          _="on click window.open('/public-adventures', '_self')">{{_('public_adventures')}}</button>
      </div>
    </div>
  </div>
  <div class="flex flex-col gap-4 mb-8 md:px-16 hidden" id="classes_table">
    <div class="flex flex-col gap-4 pb-4 bg-gray-200 border border-gray-400 px-10 rounded-lg w-full lg:w-1/4 p-8">
      <h2 class="m-0 justify-left"> {{_('my_classes')}} </h2>
      <div class="overflow-hidden rounded-lg shadow-lg">
        <table class="w-full border border-gray-400">
        <thead>
          <tr class="bg-blue-300 text-blue-900">
            <th class="px-10 py-2 text-center">{{_('name')}}</th>
            <th class="px-10 py-2 text-center">{{_('teacher')}}</th>
            <th class="px-10 py-2">{{_('students')[0]|upper}}{{_('students')[1:]}}</th>
            <th class="px-4 p-2 bg-blue-900 text-white">{{_('actions')}}</th>
          </tr>
        </thead>
        <tbody>
          {% for class in teacher_classes %}
            <tr class="{% if loop.index is divisibleby 2 %}bg-gray-200{% else %}bg-white{% endif %}">
              <td class="text-center px-4 py-2"><a href="for-teachers/class/{{class.id}}" class="view_class" data-cy="view_class_link">{{class.name|e}}</a></td>
              <td class="text-center p-2">{{class.teacher}}</td>
              <td class="text-center p-2">{{class.students|length}}</td>
              <td class="text-center p-2">
                <div class="flex justify-center text-blue-900">
                  <button class="flex flex-col items-center mr-16"
                  _="on click window.open('/for-teachers/customize-class/{{class.id}}', '_self')">
                    <span class="fas fa-pen block mb-1"></span>
                    <span>{{_('customize')}}</span>
                  </button>
                  <button class="flex flex-col items-center mr-16"
                  onclick='hedyApp.duplicate_class("{{class.id}}", "{{class.second_teachers}}", {{_('second_teacher_copy_prompt')|default(None)|tojson}}, {{_('class_name_prompt')|default(None)|tojson}}, {% if class.teacher != username %}"{{class.name}}"{% else %}" "{% endif %})'>
                    <span class="fas fa-copy block mb-1"></span>
                    <span>{{_('duplicate')}}</span>
                  </button>
                  <button class="flex flex-col items-center mr-16"
                  _="on click window.open('/for-teachers/class/{{class.id}}/preview', '_self')">
                    <span class="fas fa-eye block mb-1"></span>
                    <span>{{_('preview')}}</span>
                  </button>
                  <button class="flex flex-col items-center"
                  onclick='hedyApp.delete_class("{{class.id}}", {{_('delete_class_prompt')|default(None)|tojson}})'>
                    <span class="fas fa-trash block mb-1 text-red-700"></span>
                    <span class="text-red-700">{{_('remove')}}</span>
                  </button>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      </div>
      </div>
    </div>
    <div class="flex flex-col gap-4 mb-8 md:px-16 hidden" id="adventures_table">
      <div class="flex flex-col gap-4 pb-4 bg-gray-200 border border-gray-400 px-10 rounded-lg w-full lg:w-1/4 p-8">
        <h2 class="m-0 justify-left"> {{_('my_adventures')}} </h2>
        <div class="overflow-hidden rounded-lg shadow-lg">
        <table class="w-full border border-gray-400">
          <thead>
            <tr class="bg-blue-300 text-blue-900">
              <th class="px-10 py-2 text-center">{{_('name')}}</th>
              <th class="px-10 py-2 text-center">{{_('creator')}}</th>
              <th class="px-10 py-2 text-center">{{_('owner')}}</th>
              <th class="p-2">{{_('level')}}</th>
              <th class="p-2 hidden sm:block">{{_('last_update')}}</th>
              <th class="px-4 p-2 bg-blue-900 text-white">{{_('actions')}}</th>
            </tr>
          </thead>
          <tbody>
            {% for adventure in teacher_adventures %}
              <tr class="{% if loop.index is divisibleby 2 %}bg-gray-200{% else %}bg-white{% endif %}">
                <td class="text-center px-4 py-2"><a href="for-teachers/customize-adventure/{{adventure.id}}" class="no-underline" data-cy="edit-link">{{adventure.name|e}}</a></td>
                <td class="text-center owner_username_cell">{{adventure.author or adventure.creator}}</td>
                <td class="text-center username_cell">{{adventure.creator}}</td>
                <td class="text-center p-2">
                  {% if adventure.levels %}
                      {% for level in adventure.levels %}
                          {{level}}{% if loop.index != adventure.levels|length %}, {% endif %}
                      {% endfor %}
                    {% elif adventure.level %}
                      {{adventure.level}}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td class="text-center p-2 hidden sm:block">{{adventure.date}}</td>
                <td class="text-center p-2">
                  <div class="flex justify-center text-blue-900">
                    <button class="flex flex-col items-center mr-16"
                    _="on click window.open('/adventure/{{ adventure.name }}?creator={{ adventure.creator }}', '_self')">
                      <span class="fas fa-eye block mb-1"></span>
                      <span>{{_('preview')}}</span>
                    </button>
                    <button class="flex flex-col items-center" data-cy="delete-adventure"
                    onclick='hedyApp.delete_adventure("{{adventure.id}}", {{_('delete_adventure_prompt')|default(None)|tojson}})'>
                      <span class="fas fa-trash block mb-1 text-red-700"></span>
                      <span class="text-red-700">{{_('remove')}}</span>
                    </button>
                  </div>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
        </div>
        </div>
      </div>
      <div class="flex flex-col gap-4 mb-8 md:px-16" id="slides_table">
      <div class="flex flex-col gap-4 pb-4 bg-gray-200 border border-gray-400 px-10 rounded-lg w-full lg:w-1/4 p-8">
      <h2 class="m-0"> {{_('slides')}} </h2>
      <div class="text-black">{{ _('slides_info') }}</div>
      <div style="text-align: right;">
        <button class="white-btn inline-flex items-center"
        _="on click toggle .hidden on #adventure_table
        set arrow to #slides_arrow
        if not arrow.classList.contains('rotate-180')
          add .rotate-180 to arrow
        else
          remove .rotate-180 from arrow"
        >
        <span>{{_('view_slides')}}</span>
          <svg id="slides_arrow" class="fill-current h-6 w-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
            <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
          </svg>
        </button>
      </div>
      <div class="overflow-hidden">
        <div class="w-full hidden" id="adventure_table">
            {% for level in slides %}
            <div class="bg-gray-100 border rounded-lg mb-4 p-2 flex justify-between items-center">
                <div class="text-left text-blue-500 font-semibold ml-6">
                    {% if level == 0 %}
                    {{_('hedy_introduction_slides')}}
                    {% else %}
                    {{_('slides_for_level')}} {{level}}
                    {% endif %}
                </div>
                <div class="flex flex-row gap-3 mb-2 mr-6"> <!-- Changed justify-center to justify-between -->
                    <iframe class="hidden" id="level-{{level}}-slides" data-src="/slides/{{level}}" src="about:blank"></iframe>
                    <a class="green-btn mt-4" href="/slides/{{level}}" target="_blank">
                        {{_('view_slides')}}
                    </a>
                    <button class="white-btn mt-4" id="download-slides-{{level}}" onclick="hedyApp.downloadSlides({{level}})">
                        {{_('download')}}
                        <a class="fa fa-download"></a>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    </div>
  </div>
</div>
</div>
<div class="flex flex-col gap-4 hidden">
    <div id="teacher_classes" class="flex flex-col items-center gap-3 pb-4 border-b">
        <div class="flex flex-row gap-3 items-center">
          <h2 class="m-0"> {{_('my_classes')}} </h2>
          <button _="on click toggle .hidden on #classes_info">
            <svg class="fill-current h-4 w-4 text-blue-500 cursor-pointer !m-0 !p-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
              <path
                d="M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z" />
            </svg>
          </button>
        </div>
        <div class="border border-gray-400 px-4 rounded-lg w-full lg:w-3/4 p-4 text-center {% if teacher_classes %}hidden{% endif %}" id="classes_info">
          <p>
            {{ _('classes_info') }}
          </p>
        </div>
        {% if teacher_classes %}
          <table class="table-auto w-full lg:w-3/4 border-separate space-y-6 border border-black rounded-lg">
            <thead class="bg-gray-200">
              <tr>
                  <th class="px-4 py-2 text-left">{{_('name')}}</th>
                  <th class="px-4 py-2 text-left">{{_('teacher')}}</th>
                  <!-- This is a bucket-fix to get the first letter capitalized, should find a long-term solution -->
                  <th class="px-4 py-2">{{_('students')[0]|upper}}{{_('students')[1:]}}</th>
                  <th class="p-2">{{_('customize_class')}}</th>
                  <th class="p-2">{{_('duplicate')}}</th>
                  <th class="p-2">{{_('preview')}}</th>
                  <th class="p-2">{{_('remove')}}</th>
              </tr>
            </thead>
            <tbody>
              {% for class in teacher_classes %}
                <tr>
                  <td class="px-4 py-2"><a href="for-teachers/class/{{class.id}}" class="view_class" data-cy="view_class_link">{{class.name|e}}</a></td>
                  <td class="username_cell">{{class.teacher}}</td>
                  <td class="text-center p-2">{{class.students|length}}</td>
                  <td class="text-center p-2"><a class="no-underline cursor-pointer" href="for-teachers/customize-class/{{class.id}}">📝</a></td>
                  <td class="text-center p-2"><a class="no-underline cursor-pointer" onclick='hedyApp.duplicate_class("{{class.id}}", "{{class.second_teachers}}", {{_('second_teacher_copy_prompt')|default(None)|tojson}}, {{_('class_name_prompt')|default(None)|tojson}}, {% if class.teacher != username %}"{{class.name}}"{% else %}" "{% endif %})'><span class="fas fa-copy"></span></a></td>
                  <td class="text-center p-2"><a href="for-teachers/class/{{class.id}}/preview" class="no-underline cursor-pointer preview_class" data-cy="preview_class_link">👁</a></td>
                  <td class="text-center p-2"><a class="no-underline cursor-pointer" onclick='hedyApp.delete_class("{{class.id}}", {{_('delete_class_prompt')|default(None)|tojson}})'>🗑️</a></td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}
      <button class="green-btn mt-4" id="create_class_button" onclick='hedyApp.create_class ({{_('class_name_prompt')|default(None)|tojson}})'
      {% if second_teacher and role == 'viewer' %}disabled{% endif %}>{{_('create_class')}}</button>
    </div>
    <div id="teacher_adventures" class="flex flex-col items-center gap-3 pb-4 border-b">
      <div class="flex flex-row gap-3 items-center">
        <h2 class="m-0"> {{_('my_adventures')}} </h2>
        <button _="on click toggle .hidden on #adventures_info">
          <svg class="fill-current h-4 w-4 text-blue-500 cursor-pointer !m-0 !p-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
            <path
              d="M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z" />
          </svg>
        </button>
      </div>
      <div class="border border-gray-400 px-4 rounded-lg w-full lg:w-3/4 p-4 text-center {% if teacher_adventures %}hidden{% endif %}" id="adventures_info">
        <p>
          {{ _('adventures_info') }}
        </p>
      </div>
        {% if teacher_adventures %}
            <table class="table-auto w-full lg:w-3/4 border-separate space-y-6 border border-black rounded-lg">
            <thead class="bg-gray-200">
              <tr>
                  <th class="px-4 py-2 text-left">{{_('name')}}</th>
                  <th class="px-4 py-2 text-left">{{_('creator')}}</th>
                  <th class="px-4 py-2 text-left">{{_('owner')}}</th>
                  <th class="p-2">{{_('level')}}</th>
                  <th class="p-2 hidden sm:block">{{_('last_update')}}</th>
                  <th class="p-2">{{_('preview')}}</th>
                  <th class="p-2">{{_('remove')}}</th>
              </tr>
            </thead>
            <tbody>
              {% for adventure in teacher_adventures %}
                <tr>
                  <td class="px-4 py-2"><a href="for-teachers/customize-adventure/{{adventure.id}}" class="no-underline" data-cy="edit-link">{{adventure.name|e}}</a></td>
                  <td class="owner_username_cell">{{adventure.author or adventure.creator}}</td>
                  <td class="username_cell">{{adventure.creator}}</td>
                  <td class="text-center p-2">
                    {% if adventure.levels %}
                      {% for level in adventure.levels %}
                          {{level}}{% if loop.index != adventure.levels|length %}, {% endif %}
                      {% endfor %}
                    {% elif adventure.level %}
                      {{adventure.level}}
                    {% else %}
                        -
                    {% endif %}
                  </td>
                  <td class="text-center p-2 hidden sm:block">{{adventure.date}}</td>
                  <td class="text-center p-2"><a class="no-underline cursor-pointer" href="/adventure/{{ adventure.name }}?creator={{ adventure.creator }}">👁</a></td>
                  <td class="text-center p-2"><a class="no-underline cursor-pointer" data-cy="delete-adventure" onclick='hedyApp.delete_adventure("{{adventure.id}}", {{_('delete_adventure_prompt')|default(None)|tojson}})'>🗑️</a></td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}
        <div class="flex gap-4">
          <button id="create_adventure_button" class="green-btn mt-4" 
            hx-trigger="click"
            hx-post="/for-teachers/create-adventure"
            hx-swap="none"
            _="on htmx:afterRequest if detail.xhr.response
            window.open('/for-teachers/customize-adventure/' + detail.xhr.response, '_self')"
            data-cy="edit-link"{% if second_teacher and role == 'viewer' %}disabled{% endif %}>{{_('create_adventure')}}</button>
          <a href="/public-adventures" id="public-adventures-link" class="white-btn mt-4">{{_('public_adventures')}}</a>
        </div>
    </div>
    <div id="slides" class="flex flex-col items-center border-b gap-3">
      <div class="flex flex-row gap-3 items-center">
        <h2 class="m-0"> {{ _('slides') }} </h2>
        <button _="on click toggle .hidden on #slides_info">
          <svg class="fill-current h-4 w-4 text-blue-500 cursor-pointer !m-0 !p-0" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
            <path
              d="M2.93 17.07A10 10 0 1 1 17.07 2.93 10 10 0 0 1 2.93 17.07zm12.73-1.41A8 8 0 1 0 4.34 4.34a8 8 0 0 0 11.32 11.32zM9 11V9h2v6H9v-4zm0-6h2v2H9V5z" />
          </svg>
        </button>
      </div>
      <div class="border border-gray-400 px-4 rounded-lg w-full lg:w-3/4 p-4 text-center hidden" id="slides_info">
        <p>
          {{ _('slides_info') }}
        </p>
      </div>      
    <table class="table-auto w-full lg:w-3/4 border-separate space-y-6 border border-black rounded-lg">
      <thead class="bg-gray-200">
        <tr>
            <th class="px-4 py-2 text-center">{{_('slides')}}</th>
            <th class="p-2">{{_('download')}}</th>
        </tr>
      </thead>
      <tbody>
          {% for level in slides %}
            <tr>
              <td class="text-center p-2">
                  <a class="no-underline cursor-pointer" href="/slides/{{level}}" target="_blank">
                      {% if level == 0 %}
                        Hedy introduction slides
                      {% else %}
                        Slides for level {{level}}
                      {% endif %}
                  </a></td>
              <td class="text-center p-2">
                <iframe class="hidden" id="level-{{level}}-slides" data-src="/slides/{{level}}" src="about:blank"></iframe>
                <button class="green-btn mt-4 fa fa-arrow-down" id="download-slides-{{level}}" onclick="hedyApp.downloadSlides({{level}})"></button>
              </td>
            </tr>
          {% endfor %}
      </tbody>
    </table>
    </div>
{% endblock %}
