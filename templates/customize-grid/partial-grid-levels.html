<div id="adventure_overview">
  {# The header of the table #}
  <div class="sm:grid sm:grid-cols-3 flex flex-row gap-5  mb-4 w-full">
    <div class="dropdown relative ">
      <button class="white-btn px-4 rounded inline-flex items-center gap-2 text-xl" id="dropdown_level_button"
        onclick="$('#level_dropdown').slideToggle('medium');">
        <span>{{ _('level_title') }} {{ adventure_table.level }}</span> <i id="level-arrow" class="fa-solid fa-angle-down"></i>
      </button>
      <div class="w-40">
        <div class="dropdown-menu dropdown-blue !w-40 z-20 ltr:left-0 rtl:right-0" id="level_dropdown"
          style="display: none; padding: 0px !important; margin: 0px; margin-top: 0.25rem;" _="on mutation of @style
                      set arrow to #level-arrow
                      if *display == 'none'
                          remove .rotate-180 from arrow
                      else if not arrow.classList.contains('rotate-180')
                          add .rotate-180 to arrow
                      end">
          {% for dropdown_level in range(1, 19) %}
          <button id="level_button_{{dropdown_level}}" class="flex-row flex justify-between items-center gap-2 px-2 py-2 border-b border-dashed border-blue-500
                          {% if dropdown_level == adventure_table.level %}bg-white{% else %}hover:bg-blue-100 bg-blue-200{% endif %}" {%
            if dropdown_level== adventure_table.level %}disabled{% endif %} style="width: 100%;"
            hx-get="/live_stats/class/{{class_info.id}}/level/{{dropdown_level}}" hx-target="#adventure_overview"
            hx-swap="outerHTML">
            <div class="flex-grow h-min min-w-80" tabindex=0>
              {{ _('level_title') }} {{ dropdown_level }}
            </div>
          </button>
          {% endfor %}
        </div>
      </div>
    </div>
    <h2 class="text-center place-self-center mb-0 mt-0">{{_('review_adventures')}}</h2>
  </div>
  
  {# The actual table that holds the data #}
  <div class="border border-gray-400 py-2 px-4 rounded-lg w-full overflow-x-auto">
    <table class="table-auto text-center w-full pt-5" id="adventure_table">
      <thead>
        <colgroup>
          <col>
          <col span="2">
          <col span="{{adventure_table.adventures|length}}">
        </colgroup>
        <tr>
          <td></td>
          <th class="border-r border-l border-b border-gray-400 p-2" colspan="2" scope="colgroup">Options</th>
          <th colspan="{{ adventure_table.adventures|length }}" class="border-b border-gray-400 p-2" scope="colgroup">Adventures</th>
        </tr>
        <tr>
          <th class="border-r border-b border-gray-400 p-2">Students</th>
          <th class="border-r border-b border-gray-400 p-2">Programs</th>
          <th class="border-r border-b border-gray-400 p-2">Password</th>
          {% for adventure in adventure_table['adventures'] %}
            <th class="border-b border-gray-400 p-2 {%if not loop.last %}border-r{% endif %}">{{ adventure['name'] }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for student in adventure_table['students'] %}
        <tr>
          {% set is_last_student = loop.last %}           
          <td class="border-gray-400 p-2 border-r {% if not is_last_student %}border-b{% endif %}">{{ student }}</td>
          <td class="border-gray-400 p-2 border-r {% if not is_last_student %}border-b{% endif %} text-center"><a href="/programs?user={{student}}"><i class="fa-solid fa-code"></i></a></td>
          <td class="border-gray-400 p-2 border-r {% if not is_last_student %}border-b{% endif %} text-center"><a href="#" class="no-underline" onclick='hedyApp.change_password_student("{{student}}", {{_('enter_password')|default(None)|tojson}}, {{_('password_change_prompt')|default(None)|tojson}})'>✏️</a></td>
          {% for adventure in adventure_table['adventures'] %}
          {% set student_adventure_id = student ~ '-' ~ adventure.id ~ '-' ~ adventure_table.level %}
          {% if student_adventure_id in adventure_table.student_adventures %}
              {% set student_adventure = adventure_table.student_adventures[student_adventure_id] %}
              <td
                class="p-2 border-gray-400
                       {% if not loop.last %}border-r{% endif %}
                       {% if not is_last_student %}border-b{% endif %}"
                >
                <div class="grid grid grid-cols-[repeat(3,_minmax(25px,_1fr))] gap-3">
                  {# Empty div so there's  gap to the middle and then the eye #}
                  <div></div>
                  <div>
                    <input type="checkbox" name="gridCheckBox"
                      class="student_adventure_checkbox min-w-fit place-self-center text-green-700 text-center text-sm cursor-pointer {% if student_adventure.ticked %}fa-solid fa-check{% endif %}"
                      {% if student_adventure.ticked %}checked{% endif %}
                      hx-post="/grid_overview/class/{{ class_info.id }}/level?level={{ adventure_table.level }}&student={{ student }}&adventure={{ adventure.id }}"
                      hx-target="#adventure_overview" hx-swap="outerHTML" hx-trigger="change">
                  </div>
                  <div>
                    <a class="no-underline cursor-pointer text-gray-800 hover:bg-gray-400/50 hover:rounded-full"
                      href='/hedy/{{student_adventure.program}}/view'><i class="fa-regular fa-eye"></i></a>
                  </div>
                </div>
              </td>
              {% else %}
              <td
                class="border-gray-400 p-2 {% if not loop.last %}border-r{% endif %} {% if not is_last_student %}border-b{% endif %}">
                <input type="checkbox"
                  class="student_adventure_checkbox align-middle fa-solid fa-xmark text-center text-sm text-orange-600"
                  name="gridCheckBox" disabled="true">
              </td>
            {% endif %}
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>