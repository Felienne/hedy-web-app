{
  "version": 3,
  "sources": ["index.ts", "modal.ts", "syntaxModesRules.ts", "teachers.ts", "auth.ts", "app.ts", "tabs.ts", "translating.ts"],
  "sourcesContent": ["export * from './modal';\r\nexport * from './app';\r\nexport * from './auth';\r\nimport './syntaxModesRules';\r\nimport './tabs';\r\nimport './translating';\r\nexport * from './teachers';", "/**\r\n * The modal we pop up to have children confirm things\r\n */\r\nclass Modal {\r\n  constructor() {\r\n    // Just one binding, never needs stat\r\n    $('#modal-confirm-button').on('click', () => this.hide());\r\n    $('#modal-no-button').on('click', () => this.hide());\r\n    $('#modal-cancel-button').on('click', () => this.hide());\r\n  }\r\n\r\n  public show() {\r\n    $('#modal-mask').show();\r\n    $('#modal-content').show();\r\n    window.scrollTo(0, 0);\r\n  }\r\n\r\n  public hide() {\r\n    $('#modal-mask').hide();\r\n    $('#modal-content').hide();\r\n    $('#modal-alert').hide();\r\n    $('#modal-prompt').hide();\r\n    $('#modal-confirm').hide();\r\n  }\r\n\r\n  public alert(message: string, timeoutMs?: number) {\r\n    $('#modal-alert-text').text(message);\r\n    this.show();\r\n    $('#modal-alert').show();\r\n    if (timeoutMs) setTimeout(() => this.hide(), timeoutMs);\r\n  }\r\n\r\n  public confirm(message: string, confirmCb: () => void) {\r\n    $('#modal-confirm-text').text(message);\r\n    this.show();\r\n    $('#modal-confirm').show();\r\n\r\n    // Since we need to close over the callback, replace the handler\r\n    $('#modal-yes-button').off('click').on('click', () => {\r\n      this.hide();\r\n      confirmCb();\r\n    });\r\n  }\r\n\r\n  public prompt(message: string, defaultValue: string, confirmCb: (x: string) => void) {\r\n    $('#modal-prompt-text').text(message);\r\n    this.show();\r\n    $('#modal-prompt').show();\r\n    if (defaultValue) $('#modal-prompt-input').val(defaultValue);\r\n\r\n    // Since we need to close over the callback, replace the handler\r\n    $('#modal-ok-button').off('click').on('click', () => {\r\n      this.hide();\r\n\r\n      const value = $('#modal-prompt-input').val();\r\n      if (typeof value === 'string') {\r\n        confirmCb(value);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nlet editor: AceAjax.Editor | undefined;\r\n\r\n/**\r\n * The error that appears underneath the code editor\r\n */\r\nexport const success = {\r\n  setEditor(e: AceAjax.Editor) {\r\n    editor = e;\r\n  },\r\n\r\n  hide() {\r\n    $('#okbox').hide();\r\n    $('#okbox').hide();\r\n    editor?.resize();\r\n  },\r\n\r\n  showWarning(caption: string, message: string) {\r\n    $('#okbox .caption').text(caption);\r\n    $('#okbox .details').text(message);\r\n    $('#okbox').show();\r\n    editor?.resize();\r\n  },\r\n\r\n  show(caption: string) {\r\n    $('#okbox .caption').text(caption);\r\n    $('#okbox').show();\r\n    editor?.resize();\r\n  }\r\n}\r\n\r\nexport const error = {\r\n  setEditor(e: AceAjax.Editor) {\r\n    editor = e;\r\n  },\r\n\r\n  hide() {\r\n    $('#errorbox').hide();\r\n    $('#warningbox').hide();\r\n    editor?.resize();\r\n  },\r\n\r\n  showWarning(caption: string, message: string) {\r\n    $('#warningbox .caption').text(caption);\r\n    $('#warningbox .details').text(message);\r\n    $('#warningbox').show();\r\n    editor?.resize();\r\n  },\r\n\r\n  show(caption: string, message: string) {\r\n    $('#errorbox .caption').text(caption);\r\n    $('#errorbox .details').text(message);\r\n    $('#errorbox').show();\r\n    editor?.resize();\r\n  }\r\n}\r\n\r\nexport const modal = new Modal();\r\n", "interface Rule {\r\n  readonly regex: string;\r\n  readonly token: string | string[];\r\n  readonly next?: string;\r\n}\r\n\r\ntype Rules = Record<string, Rule[]>;\r\n\r\n// Basic highlighter rules we can use in most levels\r\n// - Highlighters always begin in the 'start' state, and see line by line (no newlines!)\r\n// - We try to recognize as many commands and tokens as possible in 'start', only deviating\r\n//   to another state to avoid highlighting something.\r\n// - 'expression_eol' is the state to contain arbitrary values that will always eat the rest of the line\r\n// - 'gobble' is the state that will eat whatever is left in the line and go back to 'start'\r\nfunction baseRules(): Rules {\r\n  return {\r\n    // gobble is a state in which we can read anything (.*), used after print\r\n    gobble: [\r\n      {\r\n        regex: '.*',\r\n        token: 'text',\r\n        next: 'start',\r\n      }\r\n    ],\r\n\r\n    // this function creates two rules, one to recognize strings and at random within a line (staying in the same state)\r\n    // and one where it is recognized at the end of the line (going back to start)\r\n    expression_eol: finishLine([\r\n      {\r\n        regex: \"'[^']*'\",\r\n        token: 'constant.character',\r\n      },\r\n      {\r\n        regex: 'at random',\r\n        token: 'keyword'\r\n      },\r\n      {\r\n        regex: '$', // $ matches with end of line\r\n        token: 'text',\r\n      },\r\n    ]),\r\n  };\r\n}\r\n\r\nconst LEVELS = [\r\n  {\r\n    name: 'level1',\r\n    rules: pipe(baseRules(),\r\n      rule_printSpace('gobble'),\r\n      rule_turtle(),\r\n      recognize('start', {\r\n        regex: keywordWithSpace('echo'),\r\n        token: 'keyword',\r\n        next: 'gobble',\r\n      }),\r\n      recognize('start', {\r\n        regex: keywordWithSpace('ask'),\r\n        token: 'keyword',\r\n        next: 'gobble',\r\n      }),\r\n    ),\r\n  },\r\n  {\r\n    // Adds lists and 'at random'\r\n    name: 'level2',\r\n    rules: pipe(baseRules(),\r\n\r\n      rule_printSpace('expression_eol'),\r\n      rule_isAsk('gobble'),\r\n      rule_is('gobble'),\r\n\r\n      rule_turtle(),\r\n\r\n    ),\r\n  },\r\n  {\r\n    // Adds quoted text\r\n    name: 'level3',\r\n    rules: pipe(baseRules(),\r\n      rule_turtle(),\r\n      rule_printSpace('expression_eol'),\r\n      rule_isAsk(),\r\n      rule_is(),\r\n    ),\r\n  },\r\n  {\r\n    // Adds if/else\r\n    name: 'level4',\r\n    rules: pipe(baseRules(),\r\n      rule_printSpace(),\r\n      rule_isAsk(),\r\n      rule_is(),\r\n      rule_ifElseOneLine(),\r\n      rule_expressions(),\r\n    ),\r\n  },\r\n  {\r\n    // Adds repeat\r\n    name: 'level5',\r\n    rules: pipe(baseRules(),\r\n      rule_printSpace(),\r\n      rule_isAsk(),\r\n      rule_is(),\r\n      rule_ifElseOneLine(),\r\n      rule_expressions(),\r\n      rule_repeat(),\r\n    ),\r\n  },\r\n  {\r\n    // Adds arithmetic\r\n    name: 'level6',\r\n    rules: pipe(baseRules(),\r\n      rule_printSpace(),\r\n      rule_isAsk(),\r\n      rule_is(),\r\n      rule_ifElseOneLine(),\r\n      rule_expressions(),\r\n      rule_repeat(),\r\n      rule_arithmetic(),\r\n    ),\r\n  },\r\n  {\r\n    // Adds indented blocks -- no changes to highlighter necessary\r\n    name: 'level7',\r\n    rules: pipe(baseRules(),\r\n      rule_printSpace(),\r\n      rule_isAsk(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_repeat(),\r\n      rule_arithmetic(),\r\n    ),\r\n  },\r\n  {\r\n    // Replaces 'repeat' with 'for'\r\n    name: 'level8',\r\n    rules: pipe(baseRules(),\r\n      rule_printSpace(),\r\n      rule_isAsk(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_for()\r\n    ),\r\n  },\r\n  {\r\n    // Replaces 'repeat' with 'for'\r\n    name: 'level9and10',\r\n    rules: pipe(baseRules(),\r\n      rule_printSpace(),\r\n      rule_isAsk(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_forRange(),\r\n      rule_for()\r\n    ),\r\n  },\r\n  {\r\n    // Nesting of 'for' loops (no changes necessary)\r\n    name: 'level11',\r\n    rules: pipe(baseRules(),\r\n      rule_printSpace(),\r\n      rule_isAsk(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_forRange(),\r\n    ),\r\n  },\r\n  {\r\n    // Adding fncall parens\r\n    name: 'level12',\r\n    rules: pipe(baseRules(),\r\n      rule_printParen(),\r\n      rule_isInputParen(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_forRangeParen(),\r\n    ),\r\n  },\r\n// ----------------------------------------------------------------\r\n//  Everything below this line hasn't been done yet\r\n// ----------------------------------------------------------------\r\n  {\r\n    name: 'level11',\r\n    rules: pipe(baseRules(),\r\n      rule_printParen(),\r\n      rule_isInputParen(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_forRangeParen(),\r\n    ),\r\n  },\r\n  {\r\n    name: 'level13',\r\n    rules: pipe(baseRules(),\r\n      rule_printParen(),\r\n      rule_isInputParen(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_forRangeParen(),\r\n    ),\r\n  },\r\n  {\r\n    name: 'level14',\r\n    rules: pipe(baseRules(),\r\n      rule_printParen(),\r\n      rule_isInputParen(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_forRangeParen(),\r\n    ),\r\n  },\r\n  {\r\n    name: 'level15',\r\n    rules: pipe(baseRules(),\r\n      rule_printParen(),\r\n      rule_isInputParen(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_forRangeParen(),\r\n    ),\r\n  },\r\n  {\r\n    name: 'level16',\r\n    rules: pipe(baseRules(),\r\n      rule_printParen(),\r\n      rule_isInputParen(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_forRangeParen(),\r\n    ),\r\n  },\r\n  {\r\n    name: 'level17',\r\n    rules: pipe(baseRules(),\r\n      rule_printParen(),\r\n      rule_isInputParen(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_forRangeParen(),\r\n    ),\r\n  },\r\n  {\r\n    name: 'level18and19',\r\n    rules: pipe(baseRules(),\r\n      rule_printParen(),\r\n      rule_isInputParen(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_forRangeParen(),\r\n    ),\r\n  },\r\n  {\r\n    name: 'level20',\r\n    rules: pipe(baseRules(),\r\n      rule_printParen(),\r\n      rule_isInputParen(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_forRangeParen(),\r\n    ),\r\n  },\r\n  {\r\n    name: 'level21',\r\n    rules: pipe(baseRules(),\r\n      rule_printParen(),\r\n      rule_isInputParen(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_forRangeParen(),\r\n    ),\r\n  },\r\n  {\r\n    name: 'level22',\r\n    rules: pipe(baseRules(),\r\n      rule_printParen(),\r\n      rule_isInputParen(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_forRangeParen(),\r\n    ),\r\n  },\r\n  {\r\n    name: 'level23',\r\n    rules: pipe(baseRules(),\r\n      rule_printParen(),\r\n      rule_isInputParen(),\r\n      rule_is(),\r\n      rule_ifElse(),\r\n      rule_expressions(),\r\n      rule_arithmetic(),\r\n      rule_forRangeParen(),\r\n    ),\r\n  },\r\n];\r\n\r\n\r\n/**\r\n * From a list of rules, duplicate all rules\r\n *\r\n * - 1 is the rule that's given\r\n * - 2 is the same rule, adding an '$' which returns to the 'start' state\r\n *\r\n * 2nd one comes first to have the right precedence.\r\n */\r\nfunction finishLine(rules: Rule[]) {\r\n  const ret = [];\r\n  for (const rule of rules) {\r\n    if (rule.regex) {\r\n      ret.push({\r\n        regex: rule.regex + '$',\r\n        token: rule.token,\r\n        next: 'start',\r\n      });\r\n    }\r\n    ret.push(rule);\r\n  }\r\n  return ret;\r\n}\r\n\r\n/**\r\n * Add a single rule, or multiple rules, to a given state, or multiple states\r\n *\r\n * Examples:\r\n *\r\n * - recognize('start', { regex, token, next })\r\n * - recognize(['start', 'expression'], { regex, token, next })\r\n * - recognize('start', [{ ... }, {...}])\r\n */\r\nfunction recognize(stateOrStates: string | string[], ruleOrRules: Rule | Rule[]) {\r\n  return (rules: Rules) => {\r\n    if (!Array.isArray(stateOrStates)) {\r\n      stateOrStates = [stateOrStates];\r\n    }\r\n\r\n    for (const state of stateOrStates) {\r\n      if (!rules[state]) {\r\n        rules[state] = [];\r\n      }\r\n      if (Array.isArray(ruleOrRules)) {\r\n        rules[state].push(...ruleOrRules);\r\n      } else {\r\n        rules[state].push(ruleOrRules);\r\n      }\r\n    }\r\n\r\n    return rules;\r\n  };\r\n}\r\n\r\n/**\r\n * comp(f1, f2, f3, ...)\r\n *\r\n * Returns f1 \u25CB f2 \u25CB f3 \u25CB ...\r\n */\r\nfunction comp(...fns: Array<(x: any) => any>) {\r\n  return (val: any) => {\r\n    for (const fn of fns) {\r\n      val = fn(val);\r\n    }\r\n    return val;\r\n  };\r\n}\r\n\r\n/**\r\n * pipe(X, f1, f2, f3, ...)\r\n *\r\n * Returns ...(f3(f2(f1(X)))\r\n *\r\n * (Same as X |> f1 |> f2 |> f3 |> ...)\r\n */\r\nfunction pipe(val: any, ...fns: Array<(x: any) => any>) {\r\n  return comp(...fns)(val);\r\n}\r\n\r\n/**\r\n * Add a 'print' rule, going to the indicated 'next' state (start if omitted)\r\n */\r\nfunction rule_printSpace(next?: string) {\r\n  return recognize('start', {\r\n    regex: keywordWithSpace('print'),\r\n    token: 'keyword',\r\n    next: next ?? 'start',\r\n  });\r\n}\r\n\r\n/**\r\n * Add an 'is ask' rule, going to the indicated 'next' state (expression_eol if omitted)\r\n */\r\nfunction rule_isAsk(next?: string) {\r\n  return recognize('start', {\r\n    regex: '(\\\\w+)( is ask )',\r\n    token: ['text', 'keyword'],\r\n    next: next ?? 'expression_eol',\r\n  });\r\n}\r\n\r\n/**\r\n * Add an 'is' rule, going to the indicated 'next' state (expression_eol if omitted)\r\n */\r\nfunction rule_is(next?: string) {\r\n  return recognize('start', {\r\n    regex: '(\\\\w+)( is )',\r\n    token: ['text', 'keyword'],\r\n    next: next ?? 'expression_eol',\r\n  });\r\n}\r\n\r\n/**\r\n * Add a 'print' rule with brackets\r\n */\r\nfunction rule_printParen() {\r\n  return recognize('start', {\r\n    regex: '(print)(\\\\()',\r\n    token: ['keyword', 'paren.lparen'],\r\n    next: 'start'\r\n  });\r\n}\r\n\r\nfunction rule_turtle() {\r\n    return comp(\r\n      recognize('start', {\r\n        regex: 'turn (left|right)?',\r\n        token: 'keyword',\r\n        next: 'start',\r\n      }),\r\n      recognize('start', {\r\n        regex: 'forward',\r\n        token: 'keyword',\r\n        next: 'start',\r\n      })\r\n    )\r\n}\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * Add an 'is input' rule with brackets\r\n */\r\nfunction rule_isInputParen() {\r\n  return recognize('start', {\r\n    regex: '(\\\\w+)( is input)(\\\\()',\r\n    token: ['text', 'keyword', 'paren.lparen'],\r\n    next: 'start'\r\n  });\r\n}\r\n\r\n/**\r\n * Recognize expressions as part of the 'start' state\r\n */\r\nfunction rule_expressions() {\r\n  return comp(\r\n    recognize('start', {\r\n      regex: \"'[^']*'\",\r\n      token: 'constant.character',\r\n    }),\r\n    recognize('start', {\r\n      regex: 'at random',\r\n      token: 'keyword'\r\n    }),\r\n    recognize('start', {\r\n      regex: '[, ]+',\r\n      token: 'punctuation.operator',\r\n    }),\r\n  );\r\n}\r\n\r\n\r\n/**\r\n * Add highlighting for if/else, also add a condition\r\n */\r\nfunction rule_ifElseOneLine() {\r\n  return comp(\r\n    recognize('start', {\r\n      regex: keywordWithSpace('if'),\r\n      token: 'keyword',\r\n      next: 'condition',\r\n    }),\r\n    recognize('start', {\r\n      regex: keywordWithSpace('else'),\r\n      token: 'keyword',\r\n    }),\r\n    recognize('condition', {\r\n      regex: keywordWithSpace('is'),\r\n      token: 'keyword',\r\n      next: 'start',\r\n    }),\r\n  );\r\n}\r\n\r\nfunction rule_ifElse() {\r\n  return comp(\r\n    recognize('start', {\r\n      regex: keywordWithSpace('if'),\r\n      token: 'keyword',\r\n      next: 'condition',\r\n    }),\r\n    recognize('start', {\r\n      regex: '\\\\b' + 'else' + '\\\\b',\r\n      token: 'keyword',\r\n    }),\r\n    recognize('condition', {\r\n      regex: keywordWithSpace('((is)|(in))'),\r\n      token: 'keyword',\r\n      next: 'start',\r\n    }),\r\n  );\r\n}\r\n\r\n/**\r\n * Add numbers and arithmetic\r\n */\r\nfunction rule_arithmetic() {\r\n  return recognize(['start', 'expression_eol'], [\r\n    {\r\n      regex: ' \\\\* ',\r\n      token: 'keyword',\r\n    },\r\n    {\r\n      regex: ' \\\\+ ',\r\n      token: 'keyword',\r\n    },\r\n    {\r\n      regex: ' \\\\- ',\r\n      token: 'keyword',\r\n    },\r\n  ]);\r\n}\r\n\r\n/**\r\n * Add highlighting for repeat\r\n */\r\nfunction rule_repeat() {\r\n  return recognize('start', {\r\n    regex: '(repeat)( \\\\w+ )(times)',\r\n    token: ['keyword', 'text', 'keyword'],\r\n  });\r\n}\r\n\r\nfunction rule_for(){\r\n  return recognize('start', {\r\n    regex: '(for )(\\\\w+)( in )(\\\\w+)',\r\n    token: ['keyword', 'text', 'keyword', 'text'],\r\n  });\r\n}\r\n\r\nfunction rule_forRange() {\r\n  return recognize('start', {\r\n    regex: '(for )(\\\\w+)( in range )(\\\\w+)( to )(\\\\w+)',\r\n    token: ['keyword', 'text', 'keyword', 'text', 'keyword', 'text'],\r\n  });\r\n}\r\n\r\nfunction rule_forRangeParen() {\r\n  return recognize('start', {\r\n    regex: '(for )(\\\\w+)( in range)(\\\\()([\\\\s\\\\w]+)(,)([\\\\s\\\\w]+)(\\\\))',\r\n    token: ['keyword', 'text', 'keyword', 'paren.lparen', 'text', 'punctuation.operator', 'text', 'paren.rparen'],\r\n  });\r\n}\r\n\r\n/**\r\n * Modify the given ruleset, replacing literal spaces with \"one or more spaces\"\r\n */\r\nfunction loosenRules(rules: Rules) {\r\n  for (const ruleSets of Object.values(rules)) {\r\n    for (const rule of ruleSets) {\r\n      if (rule.regex && !(rule as any)._loosened) {\r\n        (rule as any).regex = rule.regex.replace(/ /g, ' +');\r\n        (rule as any)._loosened = true;\r\n      }\r\n    }\r\n  }\r\n  return rules;\r\n}\r\n\r\n\r\n\r\n// Only do this work if the 'define' function is actually available at runtime.\r\n// If not, this script got included on a page that didn't include the Ace\r\n// editor. No point in continuing if that is the case.\r\nif ((window as any).define) {\r\n\r\n  // Define the modes based on the level definitions above\r\n  for (const level of LEVELS) {\r\n\r\n    // This is a local definition of the file 'ace/mode/level1.js', etc.\r\n    define('ace/mode/' + level.name, [], function(require, exports, _module) {\r\n      var oop = require('ace/lib/oop');\r\n      var TextMode = require('ace/mode/text').Mode;\r\n      var TextHighlightRules = require('ace/mode/text_highlight_rules').TextHighlightRules;\r\n\r\n      function ThisLevelHighlightRules(this: any) {\r\n        this.$rules = loosenRules(level.rules);\r\n        this.normalizeRules();\r\n      };\r\n      oop.inherits(ThisLevelHighlightRules, TextHighlightRules);\r\n\r\n      function Mode(this: any) {\r\n        this.HighlightRules = ThisLevelHighlightRules;\r\n      };\r\n      oop.inherits(Mode, TextMode);\r\n\r\n      exports.Mode = Mode;\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Wrap a keyword in word-boundary markers for use in the tokenizer regexes\r\n *\r\n * Use this to only recognize a word if it's a complete word by itself (and\r\n * not accidentally a part of a larger word).\r\n *\r\n * The keyword must be followed by space.\r\n */\r\nfunction keywordWithSpace(keyword: string) {\r\n  return '\\\\b' + keyword + ' ';\r\n}\r\n", "import { modal, error } from './modal';\r\nimport { auth } from './auth';\r\n\r\nexport function create_class() {\r\n  modal.prompt (auth.texts['class_name_prompt'], '', function (class_name) {\r\n\r\n    $.ajax({\r\n      type: 'POST',\r\n      url: '/class',\r\n      data: JSON.stringify({\r\n        name: class_name\r\n      }),\r\n      contentType: 'application/json',\r\n      dataType: 'json'\r\n    }).done(function(_response) {\r\n      location.reload ();\r\n    }).fail(function(err) {\r\n      console.error(err);\r\n      error.show(ErrorMessages['Connection_error'], JSON.stringify(err));\r\n    });\r\n  });\r\n}\r\n\r\nexport function rename_class(id: string) {\r\n  modal.prompt (auth.texts['class_name_prompt'], '', function (class_name) {\r\n\r\n    $.ajax({\r\n      type: 'PUT',\r\n      url: '/class/' + id,\r\n      data: JSON.stringify({\r\n        name: class_name\r\n      }),\r\n      contentType: 'application/json',\r\n      dataType: 'json'\r\n    }).done(function(_response) {\r\n      location.reload ();\r\n    }).fail(function(err) {\r\n      console.error(err);\r\n      error.show(ErrorMessages['Connection_error'], JSON.stringify(err));\r\n    });\r\n  });\r\n}\r\n\r\nexport function delete_class(id: string) {\r\n  modal.confirm (auth.texts['delete_class_prompt'], function () {\r\n\r\n    $.ajax({\r\n      type: 'DELETE',\r\n      url: '/class/' + id,\r\n      contentType: 'application/json',\r\n      dataType: 'json'\r\n    }).done(function(_response) {\r\n      window.location.pathname = '/for-teachers';\r\n    }).fail(function(err) {\r\n      console.error(err);\r\n      error.show(ErrorMessages['Connection_error'], JSON.stringify(err));\r\n    });\r\n  });\r\n}\r\n\r\nexport function join_class(link: string, name: string, noRedirect=false) {\r\n  // If there's no session but we want to join the class, we store the program data in localStorage and redirect to /login.\r\n  if (! auth.profile) {\r\n    return modal.confirm (auth.texts['join_prompt'], function () {\r\n      localStorage.setItem ('hedy-join', JSON.stringify ({link: link, name: name}));\r\n      window.location.pathname = '/login';\r\n      return;\r\n    });\r\n  }\r\n\r\n  $.ajax({\r\n    type: 'GET',\r\n    url: link,\r\n  }).done(function(_response) {\r\n    modal.alert (auth.texts['class_join_confirmation'] + ' ' + name);\r\n    if (! noRedirect) window.location.pathname = '/programs';\r\n  }).fail(function(err) {\r\n    console.error(err);\r\n    error.show(ErrorMessages['Connection_error'], JSON.stringify(err));\r\n  });\r\n}\r\n\r\nexport function remove_student(class_id: string, student_id: string) {\r\n  modal.confirm (auth.texts['remove_student_prompt'], function () {\r\n\r\n    $.ajax({\r\n      type: 'DELETE',\r\n      url: '/class/' + class_id + '/student/' + student_id,\r\n      contentType: 'application/json',\r\n      dataType: 'json'\r\n    }).done(function(_response) {\r\n      location.reload ();\r\n    }).fail(function(err) {\r\n      console.error(err);\r\n      error.show(ErrorMessages['Connection_error'], JSON.stringify(err));\r\n    });\r\n  });\r\n}\r\n\r\n", "import { modal } from './modal';\r\nimport { join_class } from './teachers';\r\nimport { saveitP } from './app';\r\n\r\nconst countries: Record<string, string> = {'AF':'Afghanistan','AX':'\u00C5land Islands','AL':'Albania','DZ':'Algeria','AS':'American Samoa','AD':'Andorra','AO':'Angola','AI':'Anguilla','AQ':'Antarctica','AG':'Antigua and Barbuda','AR':'Argentina','AM':'Armenia','AW':'Aruba','AU':'Australia','AT':'Austria','AZ':'Azerbaijan','BS':'Bahamas','BH':'Bahrain','BD':'Bangladesh','BB':'Barbados','BY':'Belarus','BE':'Belgium','BZ':'Belize','BJ':'Benin','BM':'Bermuda','BT':'Bhutan','BO':'Bolivia, Plurinational State of','BQ':'Bonaire, Sint Eustatius and Saba','BA':'Bosnia and Herzegovina','BW':'Botswana','BV':'Bouvet Island','BR':'Brazil','IO':'British Indian Ocean Territory','BN':'Brunei Darussalam','BG':'Bulgaria','BF':'Burkina Faso','BI':'Burundi','KH':'Cambodia','CM':'Cameroon','CA':'Canada','CV':'Cape Verde','KY':'Cayman Islands','CF':'Central African Republic','TD':'Chad','CL':'Chile','CN':'China','CX':'Christmas Island','CC':'Cocos (Keeling) Islands','CO':'Colombia','KM':'Comoros','CG':'Congo','CD':'Congo, the Democratic Republic of the','CK':'Cook Islands','CR':'Costa Rica','CI':'C\u00F4te d\\'Ivoire','HR':'Croatia','CU':'Cuba','CW':'Cura\u00E7ao','CY':'Cyprus','CZ':'Czech Republic','DK':'Denmark','DJ':'Djibouti','DM':'Dominica','DO':'Dominican Republic','EC':'Ecuador','EG':'Egypt','SV':'El Salvador','GQ':'Equatorial Guinea','ER':'Eritrea','EE':'Estonia','ET':'Ethiopia','FK':'Falkland Islands (Malvinas)','FO':'Faroe Islands','FJ':'Fiji','FI':'Finland','FR':'France','GF':'French Guiana','PF':'French Polynesia','TF':'French Southern Territories','GA':'Gabon','GM':'Gambia','GE':'Georgia','DE':'Germany','GH':'Ghana','GI':'Gibraltar','GR':'Greece','GL':'Greenland','GD':'Grenada','GP':'Guadeloupe','GU':'Guam','GT':'Guatemala','GG':'Guernsey','GN':'Guinea','GW':'Guinea-Bissau','GY':'Guyana','HT':'Haiti','HM':'Heard Island and McDonald Islands','VA':'Holy See (Vatican City State)','HN':'Honduras','HK':'Hong Kong','HU':'Hungary','IS':'Iceland','IN':'India','ID':'Indonesia','IR':'Iran, Islamic Republic of','IQ':'Iraq','IE':'Ireland','IM':'Isle of Man','IL':'Israel','IT':'Italy','JM':'Jamaica','JP':'Japan','JE':'Jersey','JO':'Jordan','KZ':'Kazakhstan','KE':'Kenya','KI':'Kiribati','KP':'Korea, Democratic People\\'s Republic of','KR':'Korea, Republic of','KW':'Kuwait','KG':'Kyrgyzstan','LA':'Lao People\\'s Democratic Republic','LV':'Latvia','LB':'Lebanon','LS':'Lesotho','LR':'Liberia','LY':'Libya','LI':'Liechtenstein','LT':'Lithuania','LU':'Luxembourg','MO':'Macao','MK':'Macedonia, the Former Yugoslav Republic of','MG':'Madagascar','MW':'Malawi','MY':'Malaysia','MV':'Maldives','ML':'Mali','MT':'Malta','MH':'Marshall Islands','MQ':'Martinique','MR':'Mauritania','MU':'Mauritius','YT':'Mayotte','MX':'Mexico','FM':'Micronesia, Federated States of','MD':'Moldova, Republic of','MC':'Monaco','MN':'Mongolia','ME':'Montenegro','MS':'Montserrat','MA':'Morocco','MZ':'Mozambique','MM':'Myanmar','NA':'Namibia','NR':'Nauru','NP':'Nepal','NL':'Netherlands','NC':'New Caledonia','NZ':'New Zealand','NI':'Nicaragua','NE':'Niger','NG':'Nigeria','NU':'Niue','NF':'Norfolk Island','MP':'Northern Mariana Islands','NO':'Norway','OM':'Oman','PK':'Pakistan','PW':'Palau','PS':'Palestine, State of','PA':'Panama','PG':'Papua New Guinea','PY':'Paraguay','PE':'Peru','PH':'Philippines','PN':'Pitcairn','PL':'Poland','PT':'Portugal','PR':'Puerto Rico','QA':'Qatar','RE':'R\u00E9union','RO':'Romania','RU':'Russian Federation','RW':'Rwanda','BL':'Saint Barth\u00E9lemy','SH':'Saint Helena, Ascension and Tristan da Cunha','KN':'Saint Kitts and Nevis','LC':'Saint Lucia','MF':'Saint Martin (French part)','PM':'Saint Pierre and Miquelon','VC':'Saint Vincent and the Grenadines','WS':'Samoa','SM':'San Marino','ST':'Sao Tome and Principe','SA':'Saudi Arabia','SN':'Senegal','RS':'Serbia','SC':'Seychelles','SL':'Sierra Leone','SG':'Singapore','SX':'Sint Maarten (Dutch part)','SK':'Slovakia','SI':'Slovenia','SB':'Solomon Islands','SO':'Somalia','ZA':'South Africa','GS':'South Georgia and the South Sandwich Islands','SS':'South Sudan','ES':'Spain','LK':'Sri Lanka','SD':'Sudan','SR':'Suriname','SJ':'Svalbard and Jan Mayen','SZ':'Swaziland','SE':'Sweden','CH':'Switzerland','SY':'Syrian Arab Republic','TW':'Taiwan, Province of China','TJ':'Tajikistan','TZ':'Tanzania, United Republic of','TH':'Thailand','TL':'Timor-Leste','TG':'Togo','TK':'Tokelau','TO':'Tonga','TT':'Trinidad and Tobago','TN':'Tunisia','TR':'Turkey','TM':'Turkmenistan','TC':'Turks and Caicos Islands','TV':'Tuvalu','UG':'Uganda','UA':'Ukraine','AE':'United Arab Emirates','GB':'United Kingdom','US':'United States','UM':'United States Minor Outlying Islands','UY':'Uruguay','UZ':'Uzbekistan','VU':'Vanuatu','VE':'Venezuela, Bolivarian Republic of','VN':'Viet Nam','VG':'Virgin Islands, British','VI':'Virgin Islands, U.S.','WF':'Wallis and Futuna','EH':'Western Sahara','YE':'Yemen','ZM':'Zambia','ZW':'Zimbabwe'};\r\n\r\nexport interface Profile {\r\n  session_expires_at: number;\r\n}\r\n\r\ninterface User {\r\n  username?: string;\r\n  email?: string;\r\n  password?: string;\r\n  birth_year?: number;\r\n  country?: string;\r\n  gender?: string;\r\n  subscribe?: string;\r\n  prog_experience?: 'yes' | 'no';\r\n  experience_languages?: string[];\r\n}\r\n\r\ninterface UserForm {\r\n  username?: string;\r\n  email?: string;\r\n  password?: string;\r\n  birth_year?: string;\r\n  country?: string;\r\n  gender?: string;\r\n  subscribe?: string;\r\n  mail_repeat?: string;\r\n  password_repeat?: string;\r\n  old_password?: string;\r\n}\r\n\r\nexport const auth = {\r\n  texts: AuthMessages,\r\n  profile: undefined as (Profile | undefined),\r\n  reset: undefined as (Record<string, string> | undefined),\r\n  entityify: function (string: string) {\r\n      return string.replace (/&/g, '&amp;').replace (/</g, '&lt;').replace (/>/g, '&gt;').replace (/\"/g, '&quot;').replace (/'/g, '&#39;').replace (/`/g, '&#96;');\r\n   },\r\n  emailRegex: /^(([a-zA-Z0-9_+\\.\\-]+)@([\\da-zA-Z\\.\\-]+)\\.([a-zA-Z\\.]{2,6})\\s*)$/,\r\n  redirect: function (where: string) {\r\n    where = '/' + where;\r\n    window.location.pathname = where;\r\n  },\r\n  logout: function () {\r\n    $.ajax ({type: 'POST', url: '/auth/logout'}).done (function () {\r\n      auth.redirect ('login');\r\n    });\r\n  },\r\n  destroy: function () {\r\n    modal.confirm (auth.texts['are_you_sure'], function () {\r\n      $.ajax ({type: 'POST', url: '/auth/destroy'}).done (function () {\r\n        auth.redirect ('');\r\n      });\r\n    });\r\n  },\r\n  error: function (message: string, element?: string | null, id?: string) {\r\n    $ (id || '#error').html (message);\r\n    $ (id || '#error').css ('display', 'block');\r\n    if (element) $ ('#' + element).css ('border', 'solid 1px red');\r\n  },\r\n  clear_error: function (id?: string) {\r\n    $ (id || '#error').html ('');\r\n    $ (id || '#error').css ('display', 'none');\r\n    $ ('form *').css ('border', '');\r\n  },\r\n  success: function (message: string, id?: string) {\r\n    $ ('#error').css ('display', 'none');\r\n    $ (id || '#success').html (message);\r\n    $ (id || '#success').css ('display', 'block');\r\n  },\r\n  submit: function (op: string) {\r\n    const values: UserForm = {};\r\n    $ ('form.auth *').map (function (_k, el) {\r\n      if (el.id) values[el.id as keyof UserForm] = (el as HTMLInputElement).value;\r\n    });\r\n\r\n    if (op === 'signup') {\r\n      if (! values.username) return auth.error (auth.texts['please_username'], 'username');\r\n      values.username = values.username.trim ();\r\n      if (values.username.length < 3) return auth.error (auth.texts['username_three'], 'username');\r\n      if (values.username.match (/:|@/)) return auth.error (auth.texts['username_special'], 'username');\r\n\r\n      if (! values.email?.match (auth.emailRegex)) return auth.error (auth.texts['valid_email'], 'email');\r\n      if (values.email !== values.mail_repeat) return auth.error (auth.texts['repeat_match_email'],    'mail_repeat');\r\n\r\n      if (! values.password) return auth.error (auth.texts['please_password'], 'password');\r\n      if (values.password.length < 6) return auth.error (auth.texts['password_six'], 'password');\r\n      if (values.password !== values.password_repeat) return auth.error (auth.texts['repeat_match_password'], 'password_repeat');\r\n\r\n      if (values.birth_year) {\r\n        if (!validBirthYearString(values.birth_year)) {\r\n           return auth.error (auth.texts['valid_year'] + new Date ().getFullYear (), 'birth_year');\r\n        }\r\n      }\r\n\r\n      const payload: User = {\r\n        username: values.username,\r\n        email: values.email,\r\n        password: values.password,\r\n        birth_year: values.birth_year ? parseInt(values.birth_year) : undefined,\r\n        country: values.country ? values.country : undefined,\r\n        gender: values.gender ? values.gender : undefined,\r\n        subscribe: $('#subscribe').prop('checked'),\r\n        prog_experience: $('input[name=has_experience]:checked').val() as 'yes'|'no',\r\n        experience_languages: $('#languages').is(':visible')\r\n          ? $('input[name=languages]').filter(':checked').map(() => $(this).val() as string).get()\r\n          : undefined,\r\n      };\r\n\r\n      $.ajax ({type: 'POST', url: '/auth/signup', data: JSON.stringify (payload), contentType: 'application/json; charset=utf-8'}).done (function () {\r\n        auth.success (auth.texts['signup_success']);\r\n\r\n        // We set up a non-falsy profile to let `saveit` know that we're logged in. We put session_expires_at since we need it.\r\n        auth.profile = {session_expires_at: Date.now () + 1000 * 60 * 60 * 24};\r\n\r\n        afterLogin();\r\n      }).fail (function (response) {\r\n        const error = response.responseText || '';\r\n        if (error.match ('email'))         auth.error (auth.texts['exists_email']);\r\n        else if (error.match ('username')) auth.error (auth.texts['exists_username']);\r\n        else                               auth.error (auth.texts['ajax_error']);\r\n      });\r\n    }\r\n\r\n    if (op === 'login') {\r\n      if (! values.username) return auth.error (auth.texts['please_username_email'], 'username');\r\n      if (! values.password) return auth.error (auth.texts['please_password'], 'password');\r\n\r\n      auth.clear_error ();\r\n      $.ajax ({type: 'POST', url: '/auth/login', data: JSON.stringify ({username: values.username, password: values.password}), contentType: 'application/json; charset=utf-8'}).done (function () {\r\n\r\n        // We set up a non-falsy profile to let `saveit` know that we're logged in. We put session_expires_at since we need it.\r\n        auth.profile = {session_expires_at: Date.now () + 1000 * 60 * 60 * 24};\r\n\r\n        afterLogin();\r\n      }).fail (function (response) {\r\n        if (response.status === 403) {\r\n           auth.error (auth.texts['invalid_username_password'] + ' ' + auth.texts['no_account'] + ' &nbsp;<button class=\"green-btn\" onclick=\"auth.redirect (\\'signup\\')\">' + auth.texts['create_account'] + '</button>');\r\n           $ ('#create-account').hide ();\r\n           localStorage.setItem ('hedy-login-username', values.username ?? '');\r\n        }\r\n        else auth.error (auth.texts['ajax_error']);\r\n      });\r\n    }\r\n\r\n    if (op === 'profile') {\r\n      if (! (values.email ?? '').match (auth.emailRegex)) return auth.error (auth.texts['valid_email'], 'email');\r\n\r\n      if (values.birth_year) {\r\n        if (!validBirthYearString(values.birth_year)) {\r\n          return auth.error (auth.texts['valid_year'] + new Date ().getFullYear (), 'birth_year');\r\n        }\r\n      }\r\n\r\n      const payload: User = {\r\n        email: values['email'],\r\n        birth_year: values.birth_year ? parseInt(values['birth_year']) : undefined,\r\n        country: values['country'],\r\n        gender: values['gender'],\r\n        prog_experience: $ ('input[name=has_experience]:checked').val() as 'yes' | 'no',\r\n        experience_languages: $('#languages').is(':visible')\r\n          ? $('input[name=languages]').filter(':checked').map(() => $(this).val() as string).get()\r\n          : undefined,\r\n      };\r\n\r\n      console.log(payload);\r\n\r\n      auth.clear_error ();\r\n      $.ajax ({type: 'POST', url: '/profile', data: JSON.stringify (payload), contentType: 'application/json; charset=utf-8'}).done (function () {\r\n        auth.success (auth.texts['profile_updated']);\r\n      }).fail (function (response) {\r\n        auth.error (auth.texts['ajax_error'] + ' ' + response.responseText);\r\n      });\r\n    }\r\n\r\n    if (op === 'change_password') {\r\n      if (! values.password) return auth.error (auth.texts['please_password'], 'password', '#error-password');\r\n      if (values.password.length < 6) return auth.error (auth.texts['password_six'], 'password', '#error-password');\r\n      if (values.password !== values.password_repeat) return auth.error (auth.texts['repeat_match'], 'password_repeat', '#error-password');\r\n\r\n      const payload = {old_password: values.old_password, new_password: values.password};\r\n\r\n      auth.clear_error ('#error-password');\r\n      $.ajax ({type: 'POST', url: '/auth/change_password', data: JSON.stringify (payload), contentType: 'application/json; charset=utf-8'}).done (function () {\r\n        auth.success (auth.texts['password_updated'], '#success-password');\r\n        $ ('#old_password').val ('');\r\n        $ ('#password').val ('');\r\n        $ ('#password_repeat').val ('');\r\n      }).fail (function (response) {\r\n        if (response.status === 403) auth.error (auth.texts['invalid_password'], null, '#error-password');\r\n        else                         auth.error (auth.texts['ajax_error'], null, '#error-password');\r\n      });\r\n    }\r\n\r\n    if (op === 'recover') {\r\n      if (! values.username) return auth.error (auth.texts['please_username'], 'username');\r\n\r\n      const payload = {username: values.username};\r\n\r\n      auth.clear_error ();\r\n      $.ajax ({type: 'POST', url: '/auth/recover', data: JSON.stringify (payload), contentType: 'application/json; charset=utf-8'}).done (function () {\r\n        auth.success (auth.texts['sent_password_recovery']);\r\n        $ ('#username').val ('');\r\n      }).fail (function (response) {\r\n        if (response.status === 403) auth.error (auth.texts['invalid_username']);\r\n        else                         auth.error (auth.texts['ajax_error']);\r\n      });\r\n    }\r\n\r\n    if (op === 'reset') {\r\n      if (! values.password) return auth.error (auth.texts['please_password'], 'password');\r\n      if (values.password.length < 6) return auth.error(auth.texts['password_six'], 'password');\r\n      if (values.password !== values.password_repeat) return auth.error (auth.texts['repeat_match'], 'password_repeat');\r\n\r\n      const payload = {username: auth.reset?.['username'], token: auth.reset?.['token'], password: values.password};\r\n\r\n      auth.clear_error ();\r\n      $.ajax ({type: 'POST', url: '/auth/reset', data: JSON.stringify (payload), contentType: 'application/json; charset=utf-8'}).done (function () {\r\n        auth.success (auth.texts['password_resetted']);\r\n        $ ('#password').val ('');\r\n        $ ('#password_repeat').val ('');\r\n        delete auth.reset;\r\n        auth.redirect ('login');\r\n      }).fail (function (response) {\r\n        if (response.status === 403) auth.error (auth.texts['invalid_reset_link']);\r\n        else                         auth.error (auth.texts['ajax_error']);\r\n      });\r\n    }\r\n  },\r\n  markAsTeacher: function (username: string, is_teacher: boolean) {\r\n    $.ajax ({type: 'POST', url: '/admin/markAsTeacher', data: JSON.stringify ({username: username, is_teacher: is_teacher}), contentType: 'application/json; charset=utf-8'}).done (function () {\r\n      modal.alert (['User', username, 'successfully', is_teacher ? 'marked' : 'unmarked', 'as teacher'].join (' '), 4000);\r\n      location.reload ();\r\n    }).fail (function (error) {\r\n      console.log (error);\r\n      modal.alert (['Error when', is_teacher ? 'marking' : 'unmarking', 'user', username, 'as teacher'].join (' '));\r\n    });\r\n  },\r\n\r\n  changeUserEmail: function (username: string, email: string) {\r\n    modal.prompt ('Please enter the corrected email', email, function (correctedEmail) {\r\n      if (correctedEmail === email) return;\r\n      if (! correctedEmail.match (auth.emailRegex)) return modal.alert ('Please enter a valid email.');\r\n      $.ajax ({type: 'POST', url: '/admin/changeUserEmail', data: JSON.stringify ({username: username, email: correctedEmail}), contentType: 'application/json; charset=utf-8'}).done (function () {\r\n        modal.alert (['Successfully changed the email for User', username, 'to', correctedEmail].join (' '));\r\n        location.reload ();\r\n      }).fail (function (error) {\r\n        console.log (error);\r\n        modal.alert (['Error when changing the email for User', username].join (' '));\r\n      });\r\n    });\r\n  },\r\n}\r\n\r\n// *** LOADERS ***\r\n\r\nif ($ ('#country')) {\r\n  let html = $('#country').html();\r\n  Object.keys (countries).map (function (code) {\r\n    html += '<option value=\"' + code + '\">' + countries [code] + '</option>';\r\n  });\r\n  $ ('#country').html (html);\r\n}\r\n\r\n$ ('.auth input').get ().map (function (el) {\r\n  // Clear red borders if input was marked from a previous error.\r\n  el.addEventListener ('input', () => auth.clear_error());\r\n});\r\n\r\n// We use GET /profile to see if we're logged in since we use HTTP only cookies and cannot check from javascript.\r\n$.ajax ({type: 'GET', url: '/profile'}).done (function (response) {\r\n  if (['/signup', '/login'].indexOf (window.location.pathname) !== -1) auth.redirect ('my-profile');\r\n\r\n  auth.profile = response;\r\n  if ($ ('#profile').html ()) {\r\n    $ ('#username').html (response.username);\r\n    $ ('#email').val (response.email);\r\n    $ ('#birth_year').val (response.birth_year);\r\n    $ ('#gender').val (response.gender);\r\n    $ ('#country').val (response.country);\r\n    if (response.prog_experience) {\r\n      $ ('input[name=has_experience][value=\"' + response.prog_experience + '\"]').prop ('checked', true);\r\n      if (response.prog_experience === 'yes') $ ('#languages').show ();\r\n    }\r\n    (response.experience_languages || []).map (function (lang: string) {\r\n       $ ('input[name=languages][value=\"' + lang + '\"]').prop ('checked', true);\r\n    });\r\n    $ ('#student_classes ul').html ((response.student_classes || []).map (function (Class: Class) {\r\n       return '<li>' + auth.entityify (Class.name) + '</li>';\r\n    }).join (''));\r\n  }\r\n}).fail (function (_response) {\r\n  if (window.location.pathname.indexOf ('/my-profile') !== -1) auth.redirect ('login');\r\n});\r\n\r\nif (window.location.pathname === '/reset') {\r\n  const query = window.location.search.slice (1).split ('&');\r\n  const params: Record<string, string> = {};\r\n  query.map (function (item) {\r\n    const split = item.split ('=');\r\n    params [split [0]] = decodeURIComponent (split [1]);\r\n  });\r\n  // If we don't receive username and token, the redirect link is invalid. We redirect the user to /recover.\r\n  if (! params['username'] || ! params['token']) auth.redirect ('recover')\r\n  else auth.reset = params;\r\n}\r\n\r\nif (window.location.pathname === '/signup') {\r\n  const login_username = localStorage.getItem ('hedy-login-username');\r\n  if (login_username) {\r\n    localStorage.removeItem ('hedy-login-username');\r\n    if (login_username.match ('@')) $ ('#email').val (login_username);\r\n    else                            $ ('#username').val (login_username);\r\n  }\r\n}\r\n\r\n$ ('#email, #mail_repeat').on ('cut copy paste', function (e) {\r\n   e.preventDefault ();\r\n   return false;\r\n});\r\n\r\ninterface Class {\r\n  name: string;\r\n}\r\n\r\n/**\r\n * After login:\r\n *\r\n * - Check if there's a saved program in localstorage. If so, save it.\r\n * - Check if we were supposed to be joining a class. If so, join it.\r\n * - Otherwise redirect to \"my programs\".\r\n */\r\nasync function afterLogin() {\r\n  const savedProgramString = localStorage.getItem('hedy-first-save');\r\n  const savedProgram = savedProgramString ? JSON.parse(savedProgramString) : undefined;\r\n\r\n  if (savedProgram) {\r\n    await saveitP(savedProgram[0], savedProgram[1], savedProgram[2], savedProgram[3]);\r\n    localStorage.removeItem('hedy-first-save');\r\n\r\n    const redirect = getSavedRedirectPath();\r\n    if (redirect) {\r\n      return auth.redirect(redirect);\r\n    }\r\n  }\r\n\r\n  const joinClassString = localStorage.getItem('hedy-join');\r\n  const joinClass = joinClassString ? JSON.parse(joinClassString) : undefined;\r\n  if (joinClass) {\r\n    localStorage.removeItem('hedy-join');\r\n    return join_class(joinClass.link, joinClass.name);\r\n  }\r\n\r\n  const redirect = getSavedRedirectPath();\r\n  if (redirect) {\r\n    return auth.redirect(redirect);\r\n  }\r\n\r\n  auth.redirect('programs');\r\n}\r\n\r\nfunction getSavedRedirectPath() {\r\n  const redirect = localStorage.getItem('hedy-save-redirect');\r\n  if (redirect) {\r\n    localStorage.removeItem('hedy-save-redirect');\r\n  }\r\n  return redirect;\r\n}\r\n\r\nfunction validBirthYearString(year: string) {\r\n  const birth_year = parseInt (year);\r\n  if (! birth_year || birth_year < 1900 || birth_year > new Date ().getFullYear ()) return false;\r\n  return true;\r\n}\r\n", "// It's important that this file gets loaded first\r\nimport './syntaxModesRules';\r\n\r\nimport { modal, error, success } from './modal';\r\nimport { auth } from './auth';\r\n\r\nexport let theGlobalEditor: AceAjax.Editor;\r\n\r\n(function() {\r\n  // A bunch of code expects a global \"State\" object. Set it here if not\r\n  // set yet.\r\n  if (!window.State) {\r\n    window.State = {};\r\n  }\r\n\r\n  // *** EDITOR SETUP ***\r\n  initializeMainEditor($('#editor'));\r\n\r\n  // Any code blocks we find inside 'turn-pre-into-ace' get turned into\r\n  // read-only editors (for syntax highlighting)\r\n  for (const preview of $('.turn-pre-into-ace pre').get()) {\r\n    $(preview).addClass('text-lg rounded');\r\n    const exampleEditor = turnIntoAceEditor(preview, true)\r\n    // Fits to content size\r\n    exampleEditor.setOptions({ maxLines: Infinity });\r\n    exampleEditor.setOptions({ minLines: 2 });\r\n    // Strip trailing newline, it renders better\r\n    exampleEditor.setValue(exampleEditor.getValue().replace(/\\n+$/, ''), -1);\r\n    // And add an overlay button to the editor, if the no-copy-button attribute isn't there\r\n    if (! $(preview).hasClass('no-copy-button')) {\r\n      const buttonContainer = $('<div>').css({ position: 'absolute', top: 5, right: 5, width: 'auto' }).appendTo(preview);\r\n      $('<button>').attr('title', UiMessages['try_button']).css({ fontFamily: 'sans-serif' }).addClass('green-btn').text('\u21E5').appendTo(buttonContainer).click(function() {\r\n        theGlobalEditor?.setValue(exampleEditor.getValue() + '\\n');\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize the main editor and attach all the required event handlers\r\n   */\r\n  function initializeMainEditor($editor: JQuery) {\r\n    if (!$editor.length) return;\r\n\r\n    // We expose the editor globally so it's available to other functions for resizing\r\n    var editor = turnIntoAceEditor($editor.get(0)!, $editor.data('readonly'));\r\n    theGlobalEditor = editor;\r\n    error.setEditor(editor);\r\n\r\n    window.Range = ace.require('ace/range').Range // get reference to ace/range\r\n\r\n    // Load existing code from session, if it exists\r\n    const storage = window.sessionStorage;\r\n    if (storage) {\r\n      const levelKey = $editor.data('lskey');\r\n      const loadedProgram = $editor.data('loaded-program');\r\n\r\n      // On page load, if we have a saved program and we are not loading a program by id, we load the saved program\r\n      const programFromStorage = storage.getItem(levelKey);\r\n      if (loadedProgram !== 'True' && programFromStorage) {\r\n        editor.setValue(programFromStorage, 1);\r\n      }\r\n\r\n      // When the user exits the editor, save what we have.\r\n      editor.on('blur', function(_e: Event) {\r\n        storage.setItem(levelKey, editor.getValue());\r\n      });\r\n\r\n      // If prompt is shown and user enters text in the editor, hide the prompt.\r\n      editor.on('change', function () {\r\n        if ($('#inline-modal').is (':visible')) $('#inline-modal').hide();\r\n        window.State.disable_run = false;\r\n        $ ('#runit').css('background-color', '');\r\n        window.State.unsaved_changes = true;\r\n\r\n        clearErrors(editor);\r\n      });\r\n    }\r\n\r\n    // *** PROMPT TO SAVE CHANGES ***\r\n\r\n    window.onbeforeunload = () => {\r\n      // The browser doesn't show this message, rather it shows a default message.\r\n      if (window.State.unsaved_changes && !window.State.no_unload_prompt) {\r\n        return auth.texts['unsaved_changes'];\r\n      } else {\r\n        return undefined;\r\n      }\r\n    };\r\n\r\n    // *** KEYBOARD SHORTCUTS ***\r\n\r\n    let altPressed: boolean | undefined;\r\n\r\n    // alt is 18, enter is 13\r\n    window.addEventListener ('keydown', function (ev) {\r\n      const keyCode = ev.keyCode;\r\n      if (keyCode === 18) {\r\n        altPressed = true;\r\n        return;\r\n      }\r\n      if (keyCode === 13 && altPressed) {\r\n        if (!window.State.level || !window.State.lang) {\r\n          throw new Error('Oh no');\r\n        }\r\n        runit (window.State.level, window.State.lang, function () {\r\n          $ ('#output').focus ();\r\n        });\r\n      }\r\n      // We don't use jquery because it doesn't return true for this equality check.\r\n      if (keyCode === 37 && document.activeElement === document.getElementById ('output')) {\r\n        editor.focus ();\r\n        editor.navigateFileEnd ();\r\n      }\r\n    });\r\n    window.addEventListener ('keyup', function (ev) {\r\n      const keyCode = ev.keyCode;\r\n      if (keyCode === 18) {\r\n        altPressed = false;\r\n        return;\r\n      }\r\n    });\r\n    return editor;\r\n  }\r\n\r\n  /**\r\n   * Turn an HTML element into an Ace editor\r\n   */\r\n  function turnIntoAceEditor(element: HTMLElement, isReadOnly: boolean): AceAjax.Editor {\r\n    const editor = ace.edit(element);\r\n    editor.setTheme(\"ace/theme/monokai\");\r\n    if (isReadOnly) {\r\n      editor.setOptions({\r\n        readOnly: true,\r\n        showGutter: false,\r\n        showPrintMargin: false,\r\n        highlightActiveLine: false\r\n      });\r\n    }\r\n\r\n    // a variable which turns on(1) highlighter or turns it off(0)\r\n    var highlighter = 1;\r\n\r\n    if (highlighter == 1) {\r\n      // Everything turns into 'ace/mode/levelX', except what's in\r\n      // this table. Yes the numbers are strings. That's just JavaScript for you.\r\n      const modeExceptions: Record<string, string> = {\r\n        '9': 'ace/mode/level9and10',\r\n        '10': 'ace/mode/level9and10',\r\n        '18': 'ace/mode/level18and19',\r\n        '19': 'ace/mode/level18and19',\r\n      };\r\n\r\n      if (window.State.level) {\r\n        const mode = modeExceptions[window.State.level] || `ace/mode/level${window.State.level}`;\r\n        editor.session.setMode(mode);\r\n      }\r\n    }\r\n\r\n    return editor;\r\n  }\r\n})();\r\n\r\nfunction reloadOnExpiredSession () {\r\n   // If user is not logged in or session is not expired, return false.\r\n   if (! auth.profile || auth.profile.session_expires_at > Date.now ()) return false;\r\n   // Otherwise, reload the page to update the top bar.\r\n   location.reload ();\r\n   return true;\r\n}\r\n\r\nfunction clearErrors(editor: AceAjax.Editor) {\r\n  editor.session.clearAnnotations();\r\n  for (const marker in editor.session.getMarkers(false)) {\r\n    editor.session.removeMarker(marker as any);\r\n  }\r\n}\r\n\r\nexport function runit(level: string, lang: string, cb: () => void) {\r\n  if (window.State.disable_run) return modal.alert (auth.texts['answer_question']);\r\n\r\n  if (reloadOnExpiredSession ()) return;\r\n\r\n  error.hide();\r\n  success.hide();\r\n  try {\r\n    level = level.toString();\r\n    var editor = theGlobalEditor;\r\n    var code = get_trimmed_code();\r\n\r\n    clearErrors(editor);\r\n\r\n    console.log('Original program:\\n', code);\r\n    $.ajax({\r\n      type: 'POST',\r\n      url: '/parse',\r\n      data: JSON.stringify({\r\n        level: level,\r\n        code: code,\r\n        lang: lang,\r\n        read_aloud : !!$('#speak_dropdown').val(),\r\n        adventure_name: window.State.adventure_name\r\n      }),\r\n      contentType: 'application/json',\r\n      dataType: 'json'\r\n    }).done(function(response) {\r\n      console.log('Response', response);\r\n      if (response.Warning) {\r\n        error.showWarning(ErrorMessages['Transpile_warning'], response.Warning);\r\n      }\r\n      if (response.Error) {\r\n        error.show(ErrorMessages['Transpile_error'], response.Error);\r\n        if (response.Location && response.Location[0] != \"?\") {\r\n          editor.session.setAnnotations([\r\n            {\r\n              row: response.Location[0] - 1,\r\n              column: response.Location[1] - 1,\r\n              text: \"\",\r\n              type: \"error\",\r\n            }\r\n          ]);\r\n          // FIXME change this to apply only to the error span once errors have an end location.\r\n          editor.session.addMarker(\r\n            new ace.Range(\r\n                response.Location[0] - 1,\r\n                response.Location[1] - 1,\r\n                response.Location[0] - 1,\r\n                response.Location[1],\r\n            ),\r\n            \"editor-error\", \"fullLine\", false\r\n          );\r\n        }\r\n        return;\r\n      }\r\n      if (response.Code){\r\n        console.log(\"success!\");\r\n        success.show(ErrorMessages['Transpile_success']);\r\n      }\r\n      runPythonProgram(response.Code, response.has_turtle, cb).catch(function(err) {\r\n        console.log(err)\r\n        error.show(ErrorMessages['Execute_error'], err.message);\r\n        reportClientError(level, code, err.message);\r\n      });\r\n    }).fail(function(xhr) {\r\n      console.error(xhr);\r\n      // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState\r\n      if (xhr.readyState < 4) {\r\n        error.show(ErrorMessages['Connection_error'], ErrorMessages['CheckInternet']);\r\n      } else {\r\n        error.show(ErrorMessages['Other_error'], ErrorMessages['ServerError']);\r\n      }\r\n    });\r\n\r\n  } catch (e: any) {\r\n    console.error(e);\r\n    error.show(ErrorMessages['Other_error'], e.message);\r\n  }\r\n}\r\n\r\n/**\r\n * Called when the user clicks the \"Try\" button in one of the palette buttons\r\n */\r\nexport function tryPaletteCode(exampleCode: string) {\r\n  var editor = ace.edit(\"editor\");\r\n\r\n  var MOVE_CURSOR_TO_END = 1;\r\n  editor.setValue(exampleCode + '\\n', MOVE_CURSOR_TO_END);\r\n  window.State.unsaved_changes = false;\r\n}\r\n\r\nexport function saveit(level: number | [number, string], lang: string, name: string, code: string, cb?: (err: any, resp?: any) => void) {\r\n  error.hide();\r\n  success.hide();\r\n\r\n  if (reloadOnExpiredSession ()) return;\r\n\r\n  try {\r\n    // If there's no session but we want to save the program, we store the program data in localStorage and redirect to /login.\r\n    if (! auth.profile) {\r\n       return modal.confirm (auth.texts['save_prompt'], function () {\r\n         // If there's an adventure_name, we store it together with the level, because it won't be available otherwise after signup/login.\r\n         if (window.State && window.State.adventure_name && !Array.isArray(level)) level = [level, window.State.adventure_name];\r\n         localStorage.setItem ('hedy-first-save', JSON.stringify ([level, lang, name, code]));\r\n         window.location.pathname = '/login';\r\n       });\r\n    }\r\n\r\n    window.State.unsaved_changes = false;\r\n\r\n    var adventure_name = window.State.adventure_name;\r\n    // If saving a program for an adventure after a signup/login, level is an array of the form [level, adventure_name]. In that case, we unpack it.\r\n    if (Array.isArray(level)) {\r\n       adventure_name = level [1];\r\n       level = level [0];\r\n    }\r\n\r\n    $.ajax({\r\n      type: 'POST',\r\n      url: '/programs',\r\n      data: JSON.stringify({\r\n        level: level,\r\n        lang:  lang,\r\n        name:  name,\r\n        code:  code,\r\n        adventure_name: adventure_name\r\n      }),\r\n      contentType: 'application/json',\r\n      dataType: 'json'\r\n    }).done(function(response) {\r\n      // The auth functions use this callback function.\r\n      if (cb) return response.Error ? cb (response) : cb (null, response);\r\n      if (response.Warning) {\r\n        error.showWarning(ErrorMessages['Transpile_warning'], response.Warning);\r\n      }\r\n      if (response.Error) {\r\n        error.show(ErrorMessages['Transpile_error'], response.Error);\r\n        return;\r\n      }\r\n      modal.alert (auth.texts['save_success_detail'], 4000);\r\n      // If we succeed, we need to update the default program name & program for the currently selected tab.\r\n      // To avoid this, we'd have to perform a page refresh to retrieve the info from the server again, which would be more cumbersome.\r\n      // The name of the program might have been changed by the server, so we use the name stated by the server.\r\n      $ ('#program_name').val (response.name);\r\n      window.State.adventures?.map (function (adventure) {\r\n        if (adventure.short_name === (adventure_name || 'level')) {\r\n          adventure.loaded_program = {name: response.name, code: code};\r\n        }\r\n      });\r\n    }).fail(function(err) {\r\n      console.error(err);\r\n      error.show(ErrorMessages['Connection_error'], JSON.stringify(err));\r\n      if (err.status === 403) {\r\n         localStorage.setItem ('hedy-first-save', JSON.stringify ([adventure_name ? [level, adventure_name] : level, lang, name, code]));\r\n         localStorage.setItem ('hedy-save-redirect', 'hedy');\r\n         window.location.pathname = '/login';\r\n      }\r\n    });\r\n  } catch (e: any) {\r\n    console.error(e);\r\n    error.show(ErrorMessages['Other_error'], e.message);\r\n  }\r\n}\r\n\r\n/**\r\n * The 'saveit' function, as an async function\r\n */\r\nexport function saveitP(level: number | [number, string], lang: string, name: string, code: string) {\r\n  return new Promise<any>((ok, ko) => {\r\n    saveit(level, lang, name, code, (err, response) => {\r\n      if (err) {\r\n        ko(err);\r\n      } else {\r\n        ok(response);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nexport function viewProgramLink(programId: string) {\r\n  return window.location.origin + '/hedy/' + programId + '/view';\r\n}\r\n\r\nexport function share_program (level: number, lang: string, id: string | true, Public: boolean, reload?: boolean) {\r\n  if (! auth.profile) return modal.alert (auth.texts['must_be_logged']);\r\n\r\n  var share = function (id: string) {\r\n    $.ajax({\r\n      type: 'POST',\r\n      url: '/programs/share',\r\n      data: JSON.stringify({\r\n        id: id,\r\n        public: Public\r\n      }),\r\n      contentType: 'application/json',\r\n      dataType: 'json'\r\n    }).done(function(_response) {\r\n      // If we're sharing the program, copy the link to the clipboard.\r\n      if (Public) copy_to_clipboard (viewProgramLink(id), true);\r\n      modal.alert (Public ? auth.texts['share_success_detail'] : auth.texts['unshare_success_detail'], 4000);\r\n      if (reload) setTimeout (function () {location.reload ()}, 1000);\r\n    }).fail(function(err) {\r\n      console.error(err);\r\n      error.show(ErrorMessages['Connection_error'], JSON.stringify(err));\r\n    });\r\n  }\r\n\r\n  // If id is not true, the request comes from the programs page. In that case, we merely call the share function.\r\n  if (id !== true) return share (id);\r\n\r\n  // Otherwise, we save the program and then share it.\r\n  // Saving the program makes things way simpler for many reasons: it covers the cases where:\r\n  // 1) there's no saved program; 2) there's no saved program for that user; 3) the program has unsaved changes.\r\n  const name = `${$('#program_name').val()}`;\r\n  const code = get_trimmed_code();\r\n  return saveit(level, lang, name, code, (err: any, resp: any) => {\r\n      if (err && err.Warning)\r\n        return error.showWarning(ErrorMessages['Transpile_warning'], err.Warning);\r\n      if (err && err.Error)\r\n        return error.show(ErrorMessages['Transpile_error'], err.Error);\r\n      share(resp.id);\r\n    });\r\n\r\n}\r\n\r\nexport function copy_to_clipboard (string: string, noAlert: boolean) {\r\n  // https://hackernoon.com/copying-text-to-clipboard-with-javascript-df4d4988697f\r\n  var el = document.createElement ('textarea');\r\n  el.value = string;\r\n  el.setAttribute ('readonly', '');\r\n  el.style.position = 'absolute';\r\n  el.style.left = '-9999px';\r\n  document.body.appendChild (el);\r\n\r\n  const selection = document.getSelection();\r\n  const originalSelection = selection && selection.rangeCount > 0 ? selection.getRangeAt(0) : undefined;\r\n\r\n  el.select ();\r\n  document.execCommand ('copy');\r\n  document.body.removeChild (el);\r\n  if (originalSelection) {\r\n     document.getSelection()?.removeAllRanges ();\r\n     document.getSelection()?.addRange (originalSelection);\r\n  }\r\n  if (! noAlert) modal.alert (auth.texts['copy_clipboard'], 4000);\r\n}\r\n\r\n/**\r\n * Do a POST with the error to the server so we can log it\r\n */\r\nfunction reportClientError(level: string, code: string, client_error: string) {\r\n  $.ajax({\r\n    type: 'POST',\r\n    url: '/report_error',\r\n    data: JSON.stringify({\r\n      level: level,\r\n      code: code,\r\n      page: window.location.href,\r\n      client_error: client_error,\r\n    }),\r\n    contentType: 'application/json',\r\n    dataType: 'json'\r\n  });\r\n}\r\n\r\nwindow.onerror = function reportClientException(message, source, line_number, column_number, error) {\r\n\r\n  $.ajax({\r\n    type: 'POST',\r\n    url: '/client_exception',\r\n    data: JSON.stringify({\r\n      message: message,\r\n      source: source,\r\n      line_number: line_number,\r\n      column_number: column_number,\r\n      error: error,\r\n      url: window.location.href,\r\n      user_agent: navigator.userAgent,\r\n    }),\r\n    contentType: 'application/json',\r\n    dataType: 'json'\r\n  });\r\n}\r\n\r\nfunction runPythonProgram(code: string, hasTurtle: boolean, cb: () => void) {\r\n\r\n  // We keep track of how many programs are being run at the same time to avoid prints from multiple simultaneous programs.\r\n  // Please see note at the top of the `outf` function.\r\n  if (! window.State.programsInExecution) window.State.programsInExecution = 0;\r\n  window.State.programsInExecution++;\r\n\r\n  const outputDiv = $('#output');\r\n  outputDiv.empty();\r\n\r\n  Sk.pre = \"output\";\r\n  const turtleConfig = (Sk.TurtleGraphics || (Sk.TurtleGraphics = {}));\r\n  turtleConfig.target = 'turtlecanvas';\r\n  turtleConfig.width = 400;\r\n  turtleConfig.height = 300;\r\n  turtleConfig.worldWidth = 400;\r\n  turtleConfig.worldHeight = 300;\r\n\r\n  if (!hasTurtle) {\r\n    // There might still be a visible turtle panel. If the new program does not use the Turtle,\r\n    // remove it (by clearing the '#turtlecanvas' div)\r\n    $('#turtlecanvas').empty();\r\n  }\r\n\r\n  Sk.configure({\r\n    output: outf,\r\n    read: builtinRead,\r\n    inputfun: inputFromInlineModal,\r\n    inputfunTakesPrompt: true,\r\n    __future__: Sk.python3,\r\n    timeoutMsg: function () {return ErrorMessages ['Program_too_long']},\r\n    // Give up after three seconds of execution, there might be an infinite loop.\r\n    // This function can be customized later to yield different timeouts for different levels.\r\n    execLimit: (function () {\r\n      // const level = window.State.level;\r\n      return ((hasTurtle) ? 20000 : 3000);\r\n    }) ()\r\n  });\r\n\r\n  return Sk.misceval.asyncToPromise(function () {\r\n    return Sk.importMainWithBody(\"<stdin>\", false, code, true);\r\n  }).then(function(_mod) {\r\n    console.log('Program executed');\r\n    // Check if the program was correct but the output window is empty: Return a warning\r\n    if (window.State.programsInExecution === 1 && $('#output').is(':empty') && $('#turtlecanvas').is(':empty')) {\r\n      error.showWarning(ErrorMessages['Transpile_warning'], ErrorMessages['Empty_output']);\r\n    }\r\n    window.State.programsInExecution--;\r\n    if (cb) cb ();\r\n  }).catch(function(err) {\r\n    // Extract error message from error\r\n    console.log(err);\r\n    const errorMessage = errorMessageFromSkulptError(err) || JSON.stringify(err);\r\n    throw new Error(errorMessage);\r\n  });\r\n\r\n  /**\r\n   * Get the error messages from a Skulpt error\r\n   *\r\n   * They look like this:\r\n   *\r\n   * {\"args\":{\"v\":[{\"v\":\"name 'name' is not defined\"}]},\"traceback\":[{\"lineno\":3,\"colno\":0,\"filename\":\"<stdin>.py\"}]}\r\n   *\r\n   * Don't know why, so let's be defensive about it.\r\n   */\r\n  function errorMessageFromSkulptError(err: any) {\r\n    const message = err.args && err.args.v && err.args.v[0] && err.args.v[0].v;\r\n    return message;\r\n  }\r\n\r\n  function addToOutput(text: string, color: string) {\r\n    $('<span>').text(text).css({ color }).appendTo(outputDiv);\r\n  }\r\n\r\n\r\n  // output functions are configurable.  This one just appends some text\r\n  // to a pre element.\r\n  function outf(text: string) {\r\n    // If there's more than one program being executed at a time, we ignore it.\r\n    // This happens when a program requiring user input is suspended when the user changes the code.\r\n    if (window.State.programsInExecution > 1) return;\r\n    addToOutput(text, 'white');\r\n    speak(text)\r\n  }\r\n\r\n  function builtinRead(x: string) {\r\n    if (Sk.builtinFiles === undefined || Sk.builtinFiles[\"files\"][x] === undefined)\r\n        throw \"File not found: '\" + x + \"'\";\r\n    return Sk.builtinFiles[\"files\"][x];\r\n  }\r\n\r\n  // This method draws the prompt for asking for user input.\r\n  function inputFromInlineModal(prompt: string) {\r\n    // We give the user time to give input.\r\n    Sk.execStart = new Date (new Date ().getTime () + 1000 * 60 * 60 * 24 * 365);\r\n    $('#turtlecanvas').empty();\r\n    return new Promise(function(ok) {\r\n\r\n      window.State.disable_run = true;\r\n      $ ('#runit').css('background-color', 'gray');\r\n\r\n      const input = $('#inline-modal input[type=\"text\"]');\r\n      $('#inline-modal .caption').text(prompt);\r\n      input.val('');\r\n      input.attr('placeholder', prompt);\r\n      speak(prompt)\r\n\r\n      setTimeout(function() {\r\n        input.focus();\r\n      }, 0);\r\n      $('#inline-modal form').one('submit', function(event) {\r\n\r\n        window.State.disable_run = false;\r\n        $ ('#runit').css('background-color', '');\r\n\r\n        event.preventDefault();\r\n        $('#inline-modal').hide();\r\n        // We reset the timer to the present moment.\r\n        Sk.execStart = new Date ();\r\n        // We set a timeout for sending back the input, so that the input box is hidden before processing the program.\r\n        // Since processing the program might take some time, this timeout increases the responsiveness of the UI after\r\n        // replying to a query.\r\n        setTimeout (function () {\r\n           ok(input.val());\r\n           $ ('#output').focus ();\r\n        }, 0);\r\n\r\n        return false;\r\n      });\r\n      $('#inline-modal').show();\r\n    });\r\n  }\r\n}\r\n\r\nfunction speak(text: string) {\r\n  var selectedURI = $('#speak_dropdown').val();\r\n  if (!selectedURI) { return; }\r\n  var voice = window.speechSynthesis.getVoices().filter(v => v.voiceURI === selectedURI)[0];\r\n\r\n  if (voice) {\r\n    let utterance = new SpeechSynthesisUtterance(text);\r\n    utterance.voice = voice;\r\n    utterance.rate = 0.9;\r\n    speechSynthesis.speak(utterance);\r\n  }\r\n}\r\n\r\n(() => {\r\n  if (!window.speechSynthesis) { return; /* No point in even trying */ }\r\n  if (!window.State.lang) { return; /* Not on a code page */ }\r\n\r\n  /**\r\n   * Show the \"speak\" checkbox if we find that we have speech support for the\r\n   * current language (showing an initially hidden element is a better experience\r\n   * than hiding an initially shown element... arguably... ?)\r\n   *\r\n   * Also, for funzies: the speechSynthesis.getVoices() array is asynchronously\r\n   * populated *some time* after the page loads... and we won't know when. Keep\r\n   * on testing periodically until we got it or it's taken too long to finish.\r\n   */\r\n  let attempts = 0;\r\n  const timer = setInterval(function() {\r\n    attempts += 1;\r\n\r\n    const voices = findVoices(window.State.lang ?? '');\r\n\r\n    if (voices.length > 0) {\r\n      for (const voice of voices) {\r\n        $('#speak_dropdown').append($('<option>').attr('value', voice.voiceURI).text('\uD83D\uDCE3 ' + voice.name));\r\n      }\r\n\r\n      $('#speak_container').show();\r\n\r\n      clearInterval(timer);\r\n    }\r\n    if (attempts >= 20) {  // ~2 seconds\r\n      // Give up\r\n      clearInterval(timer);\r\n    }\r\n  }, 100);\r\n\r\n  function findVoices(lang: string) {\r\n    // Our own \"lang\" is *typically* just the language code, but we also have \"pt_BR\".\r\n    const m = lang.match(/^([a-z]+)/i);\r\n    if (!m) { return []; }\r\n    const simpleLang = m[1];\r\n\r\n    // If the feature doesn't exist in the browser, return null\r\n    if (!window.speechSynthesis) { return []; }\r\n    return window.speechSynthesis.getVoices().filter(voice => voice.lang.startsWith(simpleLang));\r\n  }\r\n})();\r\n\r\nexport function prompt_unsaved(cb: () => void) {\r\n  if (! window.State.unsaved_changes) return cb ();\r\n  // This variable avoids showing the generic native `onbeforeunload` prompt\r\n  window.State.no_unload_prompt = true;\r\n  modal.confirm(auth.texts['unsaved_changes'], cb);\r\n}\r\n\r\nexport function load_quiz(level: string) {\r\n  $('*[data-tabtarget=\"end\"]').html ('<iframe id=\"quiz-iframe\" class=\"w-full\" title=\"Quiz\" src=\"/quiz/start/' + level + '\"></iframe>');\r\n}\r\n\r\nexport function get_trimmed_code() {\r\n  try {\r\n    // This module may or may not exist, so let's be extra careful here.\r\n    const whitespace = ace.require(\"ace/ext/whitespace\");\r\n    whitespace.trimTrailingSpace(theGlobalEditor.session, true);\r\n  } catch (e) {\r\n    console.error(e);\r\n  }\r\n  return theGlobalEditor?.getValue();\r\n}\r\n\r\nexport function confetti_cannon(){\r\n  let canvas = document.getElementById('confetti');\r\n  canvas?.classList.remove('hidden');\r\n  // ignore this error, the function comes from CDN for now\r\n  const jsConfetti = new JSConfetti({canvas})\r\n  // timeout for the confetti to fall down\r\n  setTimeout(function(){canvas?.classList.add('hidden')}, 3000);\r\n  jsConfetti.addConfetti();\r\n  document.getElementById('confetti-button').style.visibility='hidden';\r\n}\r\n", "import { modal } from './modal';\r\nimport { auth } from './auth';\r\nimport { theGlobalEditor } from './app';\r\n\r\n/**\r\n * Activate tabs\r\n *\r\n * Protocol:\r\n *\r\n * - Tabs consist of a TAB (the sticky-outy bit) and a TARGET\r\n *   (the pane that gets shown and hidden).\r\n *\r\n * - TABS should have: <... data-tab=\"SOME-ID\">\r\n *\r\n * - TARGETS should have: <... data-tabtarget=\"SOME-ID\">\r\n *\r\n * When a TAB is clicked, the TARGET with the matching id is shown\r\n * (and all other TARGETS in the same containing HTML element are hidden).\r\n *\r\n * The active TAB is indicated by the  '.tab-selected' class, the active\r\n * TARGET by the *absence* of the '.hidden' class.\r\n */\r\n$(function() {\r\n  function resetWindow() {\r\n    $ ('#warningbox').hide ();\r\n    $ ('#errorbox').hide ();\r\n    $ ('#output').empty ();\r\n    $ ('#turtlecanvas').empty ();\r\n    window.State.unsaved_changes = false;\r\n  }\r\n\r\n  function switchToTab(tabName: string) {\r\n    // Find the tab that leads to this selection, and its siblings\r\n    const tab = $('*[data-tab=\"' + tabName + '\"]');\r\n    const allTabs = tab.siblings('*[data-tab]');\r\n\r\n    // Fidn the target associated with this selection, and its siblings\r\n    const target = $('*[data-tabtarget=\"' + tabName + '\"]');\r\n    const allTargets = target.siblings('*[data-tabtarget]');\r\n\r\n    // Fix classes\r\n    allTabs.removeClass('tab-selected');\r\n    tab.addClass('tab-selected');\r\n\r\n    allTargets.addClass('hidden');\r\n    target.removeClass('hidden');\r\n\r\n    const adventures: Record<string, Adventure> = {};\r\n    window.State.adventures?.map (function(adventure: Adventure) {\r\n      adventures [adventure.short_name] = adventure;\r\n    });\r\n\r\n    resetWindow();\r\n\r\n    if (tabName === 'end') {\r\n      $ ('#adventures-tab').css('max-height', '100%')\r\n      $ ('#level-header input').hide ();\r\n      $ ('#editor-area').hide ();\r\n      return;\r\n    }\r\n    $ ('#adventures-tab').css('max-height', '20em')\r\n    $ ('#level-header input').show ();\r\n    $ ('#editor-area').show ();\r\n\r\n\r\n    // If the loaded program (directly requested by link with id) matches the currently selected tab, use that, overriding the loaded program that came in the adventure or level.\r\n    if (window.State.loaded_program && (window.State.adventure_name_onload || 'level') === tabName) {\r\n      $ ('#program_name').val (window.State.loaded_program.name);\r\n      theGlobalEditor?.setValue (window.State.loaded_program.code);\r\n    }\r\n    // If there's a loaded program for the adventure or level now selected, use it.\r\n    else if (adventures[tabName]?.loaded_program) {\r\n      $ ('#program_name').val (adventures[tabName].loaded_program!.name);\r\n      theGlobalEditor?.setValue (adventures[tabName].loaded_program!.code);\r\n    }\r\n    // If there's no loaded program (either requested by id or associated to the adventure/level), load defaults.\r\n    else if (tabName === 'level' && window.State.default_program_name && window.State.default_program) {\r\n      $ ('#program_name').val(window.State.default_program_name);\r\n      theGlobalEditor?.setValue(window.State.default_program);\r\n    }\r\n    else {\r\n      $ ('#program_name').val (adventures [tabName].default_save_name + ' - ' + window.State.level_title + ' ' + window.State.level);\r\n      theGlobalEditor?.setValue (adventures [tabName].start_code);\r\n    }\r\n\r\n    window.State.adventure_name = tabName === 'level' ? undefined : tabName;\r\n    theGlobalEditor?.clearSelection();\r\n    // If user wants to override the unsaved program, reset unsaved_changes\r\n    window.State.unsaved_changes = false;\r\n  }\r\n\r\n  $('*[data-tab]').click(function (e) {\r\n    const tab = $(e.target);\r\n    const tabName = tab.data('tab');\r\n\r\n    e.preventDefault ();\r\n\r\n    // If there are unsaved changes, we warn the user before changing tabs.\r\n    if (window.State.unsaved_changes) modal.confirm(auth.texts['unsaved_changes'], () => switchToTab(tabName));\r\n    else switchToTab(tabName);\r\n\r\n    // Do a 'replaceState' to add a '#anchor' to the URL\r\n    const hashFragment = tabName !== 'level' ? tabName : '';\r\n    if (window.history) { window.history.replaceState(null, '', '#' + hashFragment); }\r\n  });\r\n\r\n  // If we're opening an adventure from the beginning (either through a link to /hedy/adventures or through a saved program for an adventure), we click on the relevant tab.\r\n  // We click on `level` to load a program associated with level, if any.\r\n  if (window.State && window.State.adventure_name) {\r\n    switchToTab(window.State.adventure_name);\r\n  }\r\n  else if (window.location.hash) {\r\n    // If we have an '#anchor' in the URL, switch to that tab\r\n    const hashFragment = window.location.hash.replace(/^#/, '');\r\n    if (hashFragment) {\r\n      switchToTab(hashFragment);\r\n    }\r\n  }\r\n});", "/**\r\n * Count newlines and also estimate how the text will be line wrapped\r\n */\r\nfunction estimateLineCount(s: string) {\r\n  var ESTIMATED_LINE_LENGTH = 80;\r\n\r\n  var lines = s.split('\\n');\r\n  var wrappedLines = lines.map(x => Math.floor(x.length / ESTIMATED_LINE_LENGTH));\r\n\r\n  return sum(wrappedLines) + lines.length;\r\n}\r\n\r\nfunction sum(xs: number[]) {\r\n  let ret = 0;\r\n  for (const x of xs) {\r\n    ret += x;\r\n  }\r\n  return ret;\r\n}\r\n\r\n\r\nfunction resizeArea(el: JQuery | HTMLElement) {\r\n  var lines = Math.max(1, estimateLineCount($(el).val() as string));\r\n  var targetHeight = lines * 25 + 4;\r\n\r\n  // Allow for the case where the user made it bigger themselves\r\n  if ($(el).height() as number < targetHeight) {\r\n    $(el).css({ height: `${targetHeight}px` });\r\n  }\r\n}\r\n\r\n$('textarea').each((_i, el) => resizeArea(el)).on('input', e => {\r\n  const target = $(e.target);\r\n  if (!target.hasClass('touched')) {\r\n    target.addClass('touched');\r\n\r\n    // Change the 'data-name=\"xxx\"' attribute into an actual 'name=\"xxx\"' attribute\r\n    // so that the value is actually submitted via the form.\r\n    target.attr('name', target.data('name'));\r\n\r\n    recordChangeToForm(target.closest('form'));\r\n  }\r\n\r\n  resizeArea(target);\r\n});\r\n\r\n\r\nvar FORM_MAP = new Map();\r\n\r\nfunction recordChangeToForm(form: JQuery) {\r\n  var fileName = form.data('file');\r\n  var formData = FORM_MAP.get(fileName);\r\n\r\n  if (!formData) {\r\n    var button = $('button[data-file=\"' + fileName + '\"]');\r\n    formData = {\r\n      button: button,\r\n      changes: 0,\r\n    }\r\n\r\n    FORM_MAP.set(fileName, formData);\r\n  }\r\n\r\n  formData.changes += 1;\r\n  formData.button.text(`${fileName} (${formData.changes})`);\r\n}\r\n\r\n$('button[data-file]').click(e => {\r\n  var fileName = $(e.target).data('file');\r\n  var form = $('form[data-file=\"' + fileName + '\"]');\r\n  form.submit();\r\n});\r\n"],
  "mappings": "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",
  "sources": ["../../__tmp__/modal.js", "../../__tmp__/syntaxModesRules.js", "../../__tmp__/teachers.js", "../../__tmp__/auth.js", "../../__tmp__/app.js", "../../__tmp__/tabs.js", "../../__tmp__/translating.js", "../../__tmp__/index.js"],
  "sourcesContent": ["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.modal = exports.error = void 0;\n/**\n * The modal we pop up to have children confirm things\n */\nvar Modal = /** @class */ (function () {\n    function Modal() {\n        var _this = this;\n        // Just one binding, never needs stat\n        $('#modal-confirm-button').on('click', function () { return _this.hide(); });\n        $('#modal-no-button').on('click', function () { return _this.hide(); });\n        $('#modal-cancel-button').on('click', function () { return _this.hide(); });\n    }\n    Modal.prototype.show = function () {\n        $('#modal-mask').show();\n        $('#modal-content').show();\n        window.scrollTo(0, 0);\n    };\n    Modal.prototype.hide = function () {\n        $('#modal-mask').hide();\n        $('#modal-content').hide();\n        $('#modal-alert').hide();\n        $('#modal-prompt').hide();\n        $('#modal-confirm').hide();\n    };\n    Modal.prototype.alert = function (message, timeoutMs) {\n        var _this = this;\n        $('#modal-alert-text').text(message);\n        this.show();\n        $('#modal-alert').show();\n        if (timeoutMs)\n            setTimeout(function () { return _this.hide(); }, timeoutMs);\n    };\n    Modal.prototype.confirm = function (message, confirmCb) {\n        var _this = this;\n        $('#modal-confirm-text').text(message);\n        this.show();\n        $('#modal-confirm').show();\n        // Since we need to close over the callback, replace the handler\n        $('#modal-yes-button').off('click').on('click', function () {\n            _this.hide();\n            confirmCb();\n        });\n    };\n    Modal.prototype.prompt = function (message, defaultValue, confirmCb) {\n        var _this = this;\n        $('#modal-prompt-text').text(message);\n        this.show();\n        $('#modal-prompt').show();\n        if (defaultValue)\n            $('#modal-prompt-input').val(defaultValue);\n        // Since we need to close over the callback, replace the handler\n        $('#modal-ok-button').off('click').on('click', function () {\n            _this.hide();\n            var value = $('#modal-prompt-input').val();\n            if (typeof value === 'string') {\n                confirmCb(value);\n            }\n        });\n    };\n    return Modal;\n}());\nvar editor;\n/**\n * The error that appears underneath the code editor\n */\nexports.error = {\n    setEditor: function (e) {\n        editor = e;\n    },\n    hide: function () {\n        $('#errorbox').hide();\n        $('#warningbox').hide();\n        editor === null || editor === void 0 ? void 0 : editor.resize();\n    },\n    showWarning: function (caption, message) {\n        $('#warningbox .caption').text(caption);\n        $('#warningbox .details').text(message);\n        $('#warningbox').show();\n        editor === null || editor === void 0 ? void 0 : editor.resize();\n    },\n    show: function (caption, message) {\n        $('#errorbox .caption').text(caption);\n        $('#errorbox .details').html(message);\n        $('#errorbox').show();\n        editor === null || editor === void 0 ? void 0 : editor.resize();\n    }\n};\nexports.modal = new Modal();\n", "\"use strict\";\n// Basic highlighter rules we can use in most levels\n// - Highlighters always begin in the 'start' state, and see line by line (no newlines!)\n// - We try to recognize as many commands and tokens as possible in 'start', only deviating\n//   to another state to avoid highlighting something.\n// - 'expression_eol' is the state to contain arbitrary values that will always eat the rest of the line\n// - 'gobble' is the state that will eat whatever is left in the line and go back to 'start'\nfunction baseRules() {\n    return {\n        // gobble is a state in which we can read anything (.*), used after print\n        gobble: [\n            {\n                regex: '.*',\n                token: 'text',\n                next: 'start',\n            }\n        ],\n        // this function creates two rules, one to recognize strings and at random within a line (staying in the same state)\n        // and one where it is recognized at the end of the line (going back to start)\n        expression_eol: finishLine([\n            {\n                regex: \"'[^']*'\",\n                token: 'constant.character',\n            },\n            {\n                regex: 'at random',\n                token: 'keyword'\n            },\n            {\n                regex: '$',\n                token: 'text',\n            },\n        ]),\n    };\n}\nvar LEVELS = [\n    {\n        name: 'level1',\n        rules: pipe(baseRules(), rule_printSpace('gobble'), rule_turtle(), recognize('start', {\n            regex: keywordWithSpace('echo'),\n            token: 'keyword',\n            next: 'gobble',\n        }), recognize('start', {\n            regex: keywordWithSpace('ask'),\n            token: 'keyword',\n            next: 'gobble',\n        })),\n    },\n    {\n        // Adds lists and 'at random'\n        name: 'level2',\n        rules: pipe(baseRules(), rule_printSpace('expression_eol'), rule_isAsk('gobble'), rule_is('gobble'), rule_turtle()),\n    },\n    {\n        // Adds quoted text\n        name: 'level3',\n        rules: pipe(baseRules(), rule_turtle(), rule_printSpace('expression_eol'), rule_isAsk(), rule_is()),\n    },\n    {\n        // Adds if/else\n        name: 'level4',\n        rules: pipe(baseRules(), rule_printSpace(), rule_isAsk(), rule_is(), rule_ifElseOneLine(), rule_expressions()),\n    },\n    {\n        // Adds repeat\n        name: 'level5',\n        rules: pipe(baseRules(), rule_printSpace(), rule_isAsk(), rule_is(), rule_ifElseOneLine(), rule_expressions(), rule_repeat()),\n    },\n    {\n        // Adds arithmetic\n        name: 'level6',\n        rules: pipe(baseRules(), rule_printSpace(), rule_isAsk(), rule_is(), rule_ifElseOneLine(), rule_expressions(), rule_repeat(), rule_arithmetic()),\n    },\n    {\n        // Adds indented blocks -- no changes to highlighter necessary\n        name: 'level7',\n        rules: pipe(baseRules(), rule_printSpace(), rule_isAsk(), rule_is(), rule_ifElse(), rule_expressions(), rule_repeat(), rule_arithmetic()),\n    },\n    {\n        // Replaces 'repeat' with 'for'\n        name: 'level8',\n        rules: pipe(baseRules(), rule_printSpace(), rule_isAsk(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_for()),\n    },\n    {\n        // Replaces 'repeat' with 'for'\n        name: 'level9and10',\n        rules: pipe(baseRules(), rule_printSpace(), rule_isAsk(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_forRange(), rule_for()),\n    },\n    {\n        // Nesting of 'for' loops (no changes necessary)\n        name: 'level11',\n        rules: pipe(baseRules(), rule_printSpace(), rule_isAsk(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_forRange()),\n    },\n    {\n        // Adding fncall parens\n        name: 'level12',\n        rules: pipe(baseRules(), rule_printParen(), rule_isInputParen(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_forRangeParen()),\n    },\n    // ----------------------------------------------------------------\n    //  Everything below this line hasn't been done yet\n    // ----------------------------------------------------------------\n    {\n        name: 'level11',\n        rules: pipe(baseRules(), rule_printParen(), rule_isInputParen(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_forRangeParen()),\n    },\n    {\n        name: 'level13',\n        rules: pipe(baseRules(), rule_printParen(), rule_isInputParen(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_forRangeParen()),\n    },\n    {\n        name: 'level14',\n        rules: pipe(baseRules(), rule_printParen(), rule_isInputParen(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_forRangeParen()),\n    },\n    {\n        name: 'level15',\n        rules: pipe(baseRules(), rule_printParen(), rule_isInputParen(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_forRangeParen()),\n    },\n    {\n        name: 'level16',\n        rules: pipe(baseRules(), rule_printParen(), rule_isInputParen(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_forRangeParen()),\n    },\n    {\n        name: 'level17',\n        rules: pipe(baseRules(), rule_printParen(), rule_isInputParen(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_forRangeParen()),\n    },\n    {\n        name: 'level18and19',\n        rules: pipe(baseRules(), rule_printParen(), rule_isInputParen(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_forRangeParen()),\n    },\n    {\n        name: 'level20',\n        rules: pipe(baseRules(), rule_printParen(), rule_isInputParen(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_forRangeParen()),\n    },\n    {\n        name: 'level21',\n        rules: pipe(baseRules(), rule_printParen(), rule_isInputParen(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_forRangeParen()),\n    },\n    {\n        name: 'level22',\n        rules: pipe(baseRules(), rule_printParen(), rule_isInputParen(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_forRangeParen()),\n    },\n    {\n        name: 'level23',\n        rules: pipe(baseRules(), rule_printParen(), rule_isInputParen(), rule_is(), rule_ifElse(), rule_expressions(), rule_arithmetic(), rule_forRangeParen()),\n    },\n];\n/**\n * From a list of rules, duplicate all rules\n *\n * - 1 is the rule that's given\n * - 2 is the same rule, adding an '$' which returns to the 'start' state\n *\n * 2nd one comes first to have the right precedence.\n */\nfunction finishLine(rules) {\n    var ret = [];\n    for (var _i = 0, rules_1 = rules; _i < rules_1.length; _i++) {\n        var rule = rules_1[_i];\n        if (rule.regex) {\n            ret.push({\n                regex: rule.regex + '$',\n                token: rule.token,\n                next: 'start',\n            });\n        }\n        ret.push(rule);\n    }\n    return ret;\n}\n/**\n * Add a single rule, or multiple rules, to a given state, or multiple states\n *\n * Examples:\n *\n * - recognize('start', { regex, token, next })\n * - recognize(['start', 'expression'], { regex, token, next })\n * - recognize('start', [{ ... }, {...}])\n */\nfunction recognize(stateOrStates, ruleOrRules) {\n    return function (rules) {\n        var _a;\n        if (!Array.isArray(stateOrStates)) {\n            stateOrStates = [stateOrStates];\n        }\n        for (var _i = 0, stateOrStates_1 = stateOrStates; _i < stateOrStates_1.length; _i++) {\n            var state = stateOrStates_1[_i];\n            if (!rules[state]) {\n                rules[state] = [];\n            }\n            if (Array.isArray(ruleOrRules)) {\n                (_a = rules[state]).push.apply(_a, ruleOrRules);\n            }\n            else {\n                rules[state].push(ruleOrRules);\n            }\n        }\n        return rules;\n    };\n}\n/**\n * comp(f1, f2, f3, ...)\n *\n * Returns f1 \u25CB f2 \u25CB f3 \u25CB ...\n */\nfunction comp() {\n    var fns = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        fns[_i] = arguments[_i];\n    }\n    return function (val) {\n        for (var _i = 0, fns_1 = fns; _i < fns_1.length; _i++) {\n            var fn = fns_1[_i];\n            val = fn(val);\n        }\n        return val;\n    };\n}\n/**\n * pipe(X, f1, f2, f3, ...)\n *\n * Returns ...(f3(f2(f1(X)))\n *\n * (Same as X |> f1 |> f2 |> f3 |> ...)\n */\nfunction pipe(val) {\n    var fns = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        fns[_i - 1] = arguments[_i];\n    }\n    return comp.apply(void 0, fns)(val);\n}\n/**\n * Add a 'print' rule, going to the indicated 'next' state (start if omitted)\n */\nfunction rule_printSpace(next) {\n    return recognize('start', {\n        regex: keywordWithSpace('print'),\n        token: 'keyword',\n        next: next !== null && next !== void 0 ? next : 'start',\n    });\n}\n/**\n * Add an 'is ask' rule, going to the indicated 'next' state (expression_eol if omitted)\n */\nfunction rule_isAsk(next) {\n    return recognize('start', {\n        regex: '(\\\\w+)( is ask )',\n        token: ['text', 'keyword'],\n        next: next !== null && next !== void 0 ? next : 'expression_eol',\n    });\n}\n/**\n * Add an 'is' rule, going to the indicated 'next' state (expression_eol if omitted)\n */\nfunction rule_is(next) {\n    return recognize('start', {\n        regex: '(\\\\w+)( is )',\n        token: ['text', 'keyword'],\n        next: next !== null && next !== void 0 ? next : 'expression_eol',\n    });\n}\n/**\n * Add a 'print' rule with brackets\n */\nfunction rule_printParen() {\n    return recognize('start', {\n        regex: '(print)(\\\\()',\n        token: ['keyword', 'paren.lparen'],\n        next: 'start'\n    });\n}\nfunction rule_turtle() {\n    return comp(recognize('start', {\n        regex: 'turn (left|right)?',\n        token: 'keyword',\n        next: 'start',\n    }), recognize('start', {\n        regex: 'forward',\n        token: 'keyword',\n        next: 'start',\n    }));\n}\n/**\n * Add an 'is input' rule with brackets\n */\nfunction rule_isInputParen() {\n    return recognize('start', {\n        regex: '(\\\\w+)( is input)(\\\\()',\n        token: ['text', 'keyword', 'paren.lparen'],\n        next: 'start'\n    });\n}\n/**\n * Recognize expressions as part of the 'start' state\n */\nfunction rule_expressions() {\n    return comp(recognize('start', {\n        regex: \"'[^']*'\",\n        token: 'constant.character',\n    }), recognize('start', {\n        regex: 'at random',\n        token: 'keyword'\n    }), recognize('start', {\n        regex: '[, ]+',\n        token: 'punctuation.operator',\n    }));\n}\n/**\n * Add highlighting for if/else, also add a condition\n */\nfunction rule_ifElseOneLine() {\n    return comp(recognize('start', {\n        regex: keywordWithSpace('if'),\n        token: 'keyword',\n        next: 'condition',\n    }), recognize('start', {\n        regex: keywordWithSpace('else'),\n        token: 'keyword',\n    }), recognize('condition', {\n        regex: keywordWithSpace('is'),\n        token: 'keyword',\n        next: 'start',\n    }));\n}\nfunction rule_ifElse() {\n    return comp(recognize('start', {\n        regex: keywordWithSpace('if'),\n        token: 'keyword',\n        next: 'condition',\n    }), recognize('start', {\n        regex: '\\\\b' + 'else' + '\\\\b',\n        token: 'keyword',\n    }), recognize('condition', {\n        regex: keywordWithSpace('((is)|(in))'),\n        token: 'keyword',\n        next: 'start',\n    }));\n}\n/**\n * Add numbers and arithmetic\n */\nfunction rule_arithmetic() {\n    return recognize(['start', 'expression_eol'], [\n        {\n            regex: ' \\\\* ',\n            token: 'keyword',\n        },\n        {\n            regex: ' \\\\+ ',\n            token: 'keyword',\n        },\n        {\n            regex: ' \\\\- ',\n            token: 'keyword',\n        },\n    ]);\n}\n/**\n * Add highlighting for repeat\n */\nfunction rule_repeat() {\n    return recognize('start', {\n        regex: '(repeat)( \\\\w+ )(times)',\n        token: ['keyword', 'text', 'keyword'],\n    });\n}\nfunction rule_for() {\n    return recognize('start', {\n        regex: '(for )(\\\\w+)( in )(\\\\w+)',\n        token: ['keyword', 'text', 'keyword', 'text'],\n    });\n}\nfunction rule_forRange() {\n    return recognize('start', {\n        regex: '(for )(\\\\w+)( in range )(\\\\w+)( to )(\\\\w+)',\n        token: ['keyword', 'text', 'keyword', 'text', 'keyword', 'text'],\n    });\n}\nfunction rule_forRangeParen() {\n    return recognize('start', {\n        regex: '(for )(\\\\w+)( in range)(\\\\()([\\\\s\\\\w]+)(,)([\\\\s\\\\w]+)(\\\\))',\n        token: ['keyword', 'text', 'keyword', 'paren.lparen', 'text', 'punctuation.operator', 'text', 'paren.rparen'],\n    });\n}\n/**\n * Modify the given ruleset, replacing literal spaces with \"one or more spaces\"\n */\nfunction loosenRules(rules) {\n    for (var _i = 0, _a = Object.values(rules); _i < _a.length; _i++) {\n        var ruleSets = _a[_i];\n        for (var _b = 0, ruleSets_1 = ruleSets; _b < ruleSets_1.length; _b++) {\n            var rule = ruleSets_1[_b];\n            if (rule.regex && !rule._loosened) {\n                rule.regex = rule.regex.replace(/ /g, ' +');\n                rule._loosened = true;\n            }\n        }\n    }\n    return rules;\n}\n// Only do this work if the 'define' function is actually available at runtime.\n// If not, this script got included on a page that didn't include the Ace\n// editor. No point in continuing if that is the case.\nif (window.define) {\n    var _loop_1 = function (level) {\n        // This is a local definition of the file 'ace/mode/level1.js', etc.\n        define('ace/mode/' + level.name, [], function (require, exports, _module) {\n            var oop = require('ace/lib/oop');\n            var TextMode = require('ace/mode/text').Mode;\n            var TextHighlightRules = require('ace/mode/text_highlight_rules').TextHighlightRules;\n            function ThisLevelHighlightRules() {\n                this.$rules = loosenRules(level.rules);\n                this.normalizeRules();\n            }\n            ;\n            oop.inherits(ThisLevelHighlightRules, TextHighlightRules);\n            function Mode() {\n                this.HighlightRules = ThisLevelHighlightRules;\n            }\n            ;\n            oop.inherits(Mode, TextMode);\n            exports.Mode = Mode;\n        });\n    };\n    // Define the modes based on the level definitions above\n    for (var _i = 0, LEVELS_1 = LEVELS; _i < LEVELS_1.length; _i++) {\n        var level = LEVELS_1[_i];\n        _loop_1(level);\n    }\n}\n/**\n * Wrap a keyword in word-boundary markers for use in the tokenizer regexes\n *\n * Use this to only recognize a word if it's a complete word by itself (and\n * not accidentally a part of a larger word).\n *\n * The keyword must be followed by space.\n */\nfunction keywordWithSpace(keyword) {\n    return '\\\\b' + keyword + ' ';\n}\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.remove_student = exports.join_class = exports.delete_class = exports.rename_class = exports.create_class = void 0;\nvar modal_1 = require(\"./modal\");\nvar auth_1 = require(\"./auth\");\nfunction create_class() {\n    modal_1.modal.prompt(auth_1.auth.texts['class_name_prompt'], '', function (class_name) {\n        $.ajax({\n            type: 'POST',\n            url: '/class',\n            data: JSON.stringify({\n                name: class_name\n            }),\n            contentType: 'application/json',\n            dataType: 'json'\n        }).done(function (_response) {\n            location.reload();\n        }).fail(function (err) {\n            console.error(err);\n            modal_1.error.show(ErrorMessages['Connection_error'], JSON.stringify(err));\n        });\n    });\n}\nexports.create_class = create_class;\nfunction rename_class(id) {\n    modal_1.modal.prompt(auth_1.auth.texts['class_name_prompt'], '', function (class_name) {\n        $.ajax({\n            type: 'PUT',\n            url: '/class/' + id,\n            data: JSON.stringify({\n                name: class_name\n            }),\n            contentType: 'application/json',\n            dataType: 'json'\n        }).done(function (_response) {\n            location.reload();\n        }).fail(function (err) {\n            console.error(err);\n            modal_1.error.show(ErrorMessages['Connection_error'], JSON.stringify(err));\n        });\n    });\n}\nexports.rename_class = rename_class;\nfunction delete_class(id) {\n    modal_1.modal.confirm(auth_1.auth.texts['delete_class_prompt'], function () {\n        $.ajax({\n            type: 'DELETE',\n            url: '/class/' + id,\n            contentType: 'application/json',\n            dataType: 'json'\n        }).done(function (_response) {\n            window.location.pathname = '/for-teachers';\n        }).fail(function (err) {\n            console.error(err);\n            modal_1.error.show(ErrorMessages['Connection_error'], JSON.stringify(err));\n        });\n    });\n}\nexports.delete_class = delete_class;\nfunction join_class(link, name, noRedirect) {\n    if (noRedirect === void 0) { noRedirect = false; }\n    // If there's no session but we want to join the class, we store the program data in localStorage and redirect to /login.\n    if (!auth_1.auth.profile) {\n        return modal_1.modal.confirm(auth_1.auth.texts['join_prompt'], function () {\n            localStorage.setItem('hedy-join', JSON.stringify({ link: link, name: name }));\n            window.location.pathname = '/login';\n            return;\n        });\n    }\n    $.ajax({\n        type: 'GET',\n        url: link,\n    }).done(function (_response) {\n        modal_1.modal.alert(auth_1.auth.texts['class_join_confirmation'] + ' ' + name);\n        if (!noRedirect)\n            window.location.pathname = '/programs';\n    }).fail(function (err) {\n        console.error(err);\n        modal_1.error.show(ErrorMessages['Connection_error'], JSON.stringify(err));\n    });\n}\nexports.join_class = join_class;\nfunction remove_student(class_id, student_id) {\n    modal_1.modal.confirm(auth_1.auth.texts['remove_student_prompt'], function () {\n        $.ajax({\n            type: 'DELETE',\n            url: '/class/' + class_id + '/student/' + student_id,\n            contentType: 'application/json',\n            dataType: 'json'\n        }).done(function (_response) {\n            location.reload();\n        }).fail(function (err) {\n            console.error(err);\n            modal_1.error.show(ErrorMessages['Connection_error'], JSON.stringify(err));\n        });\n    });\n}\nexports.remove_student = remove_student;\n", "\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.auth = void 0;\nvar modal_1 = require(\"./modal\");\nvar teachers_1 = require(\"./teachers\");\nvar app_1 = require(\"./app\");\nvar countries = { 'AF': 'Afghanistan', 'AX': '\u00C5land Islands', 'AL': 'Albania', 'DZ': 'Algeria', 'AS': 'American Samoa', 'AD': 'Andorra', 'AO': 'Angola', 'AI': 'Anguilla', 'AQ': 'Antarctica', 'AG': 'Antigua and Barbuda', 'AR': 'Argentina', 'AM': 'Armenia', 'AW': 'Aruba', 'AU': 'Australia', 'AT': 'Austria', 'AZ': 'Azerbaijan', 'BS': 'Bahamas', 'BH': 'Bahrain', 'BD': 'Bangladesh', 'BB': 'Barbados', 'BY': 'Belarus', 'BE': 'Belgium', 'BZ': 'Belize', 'BJ': 'Benin', 'BM': 'Bermuda', 'BT': 'Bhutan', 'BO': 'Bolivia, Plurinational State of', 'BQ': 'Bonaire, Sint Eustatius and Saba', 'BA': 'Bosnia and Herzegovina', 'BW': 'Botswana', 'BV': 'Bouvet Island', 'BR': 'Brazil', 'IO': 'British Indian Ocean Territory', 'BN': 'Brunei Darussalam', 'BG': 'Bulgaria', 'BF': 'Burkina Faso', 'BI': 'Burundi', 'KH': 'Cambodia', 'CM': 'Cameroon', 'CA': 'Canada', 'CV': 'Cape Verde', 'KY': 'Cayman Islands', 'CF': 'Central African Republic', 'TD': 'Chad', 'CL': 'Chile', 'CN': 'China', 'CX': 'Christmas Island', 'CC': 'Cocos (Keeling) Islands', 'CO': 'Colombia', 'KM': 'Comoros', 'CG': 'Congo', 'CD': 'Congo, the Democratic Republic of the', 'CK': 'Cook Islands', 'CR': 'Costa Rica', 'CI': 'C\u00F4te d\\'Ivoire', 'HR': 'Croatia', 'CU': 'Cuba', 'CW': 'Cura\u00E7ao', 'CY': 'Cyprus', 'CZ': 'Czech Republic', 'DK': 'Denmark', 'DJ': 'Djibouti', 'DM': 'Dominica', 'DO': 'Dominican Republic', 'EC': 'Ecuador', 'EG': 'Egypt', 'SV': 'El Salvador', 'GQ': 'Equatorial Guinea', 'ER': 'Eritrea', 'EE': 'Estonia', 'ET': 'Ethiopia', 'FK': 'Falkland Islands (Malvinas)', 'FO': 'Faroe Islands', 'FJ': 'Fiji', 'FI': 'Finland', 'FR': 'France', 'GF': 'French Guiana', 'PF': 'French Polynesia', 'TF': 'French Southern Territories', 'GA': 'Gabon', 'GM': 'Gambia', 'GE': 'Georgia', 'DE': 'Germany', 'GH': 'Ghana', 'GI': 'Gibraltar', 'GR': 'Greece', 'GL': 'Greenland', 'GD': 'Grenada', 'GP': 'Guadeloupe', 'GU': 'Guam', 'GT': 'Guatemala', 'GG': 'Guernsey', 'GN': 'Guinea', 'GW': 'Guinea-Bissau', 'GY': 'Guyana', 'HT': 'Haiti', 'HM': 'Heard Island and McDonald Islands', 'VA': 'Holy See (Vatican City State)', 'HN': 'Honduras', 'HK': 'Hong Kong', 'HU': 'Hungary', 'IS': 'Iceland', 'IN': 'India', 'ID': 'Indonesia', 'IR': 'Iran, Islamic Republic of', 'IQ': 'Iraq', 'IE': 'Ireland', 'IM': 'Isle of Man', 'IL': 'Israel', 'IT': 'Italy', 'JM': 'Jamaica', 'JP': 'Japan', 'JE': 'Jersey', 'JO': 'Jordan', 'KZ': 'Kazakhstan', 'KE': 'Kenya', 'KI': 'Kiribati', 'KP': 'Korea, Democratic People\\'s Republic of', 'KR': 'Korea, Republic of', 'KW': 'Kuwait', 'KG': 'Kyrgyzstan', 'LA': 'Lao People\\'s Democratic Republic', 'LV': 'Latvia', 'LB': 'Lebanon', 'LS': 'Lesotho', 'LR': 'Liberia', 'LY': 'Libya', 'LI': 'Liechtenstein', 'LT': 'Lithuania', 'LU': 'Luxembourg', 'MO': 'Macao', 'MK': 'Macedonia, the Former Yugoslav Republic of', 'MG': 'Madagascar', 'MW': 'Malawi', 'MY': 'Malaysia', 'MV': 'Maldives', 'ML': 'Mali', 'MT': 'Malta', 'MH': 'Marshall Islands', 'MQ': 'Martinique', 'MR': 'Mauritania', 'MU': 'Mauritius', 'YT': 'Mayotte', 'MX': 'Mexico', 'FM': 'Micronesia, Federated States of', 'MD': 'Moldova, Republic of', 'MC': 'Monaco', 'MN': 'Mongolia', 'ME': 'Montenegro', 'MS': 'Montserrat', 'MA': 'Morocco', 'MZ': 'Mozambique', 'MM': 'Myanmar', 'NA': 'Namibia', 'NR': 'Nauru', 'NP': 'Nepal', 'NL': 'Netherlands', 'NC': 'New Caledonia', 'NZ': 'New Zealand', 'NI': 'Nicaragua', 'NE': 'Niger', 'NG': 'Nigeria', 'NU': 'Niue', 'NF': 'Norfolk Island', 'MP': 'Northern Mariana Islands', 'NO': 'Norway', 'OM': 'Oman', 'PK': 'Pakistan', 'PW': 'Palau', 'PS': 'Palestine, State of', 'PA': 'Panama', 'PG': 'Papua New Guinea', 'PY': 'Paraguay', 'PE': 'Peru', 'PH': 'Philippines', 'PN': 'Pitcairn', 'PL': 'Poland', 'PT': 'Portugal', 'PR': 'Puerto Rico', 'QA': 'Qatar', 'RE': 'R\u00E9union', 'RO': 'Romania', 'RU': 'Russian Federation', 'RW': 'Rwanda', 'BL': 'Saint Barth\u00E9lemy', 'SH': 'Saint Helena, Ascension and Tristan da Cunha', 'KN': 'Saint Kitts and Nevis', 'LC': 'Saint Lucia', 'MF': 'Saint Martin (French part)', 'PM': 'Saint Pierre and Miquelon', 'VC': 'Saint Vincent and the Grenadines', 'WS': 'Samoa', 'SM': 'San Marino', 'ST': 'Sao Tome and Principe', 'SA': 'Saudi Arabia', 'SN': 'Senegal', 'RS': 'Serbia', 'SC': 'Seychelles', 'SL': 'Sierra Leone', 'SG': 'Singapore', 'SX': 'Sint Maarten (Dutch part)', 'SK': 'Slovakia', 'SI': 'Slovenia', 'SB': 'Solomon Islands', 'SO': 'Somalia', 'ZA': 'South Africa', 'GS': 'South Georgia and the South Sandwich Islands', 'SS': 'South Sudan', 'ES': 'Spain', 'LK': 'Sri Lanka', 'SD': 'Sudan', 'SR': 'Suriname', 'SJ': 'Svalbard and Jan Mayen', 'SZ': 'Swaziland', 'SE': 'Sweden', 'CH': 'Switzerland', 'SY': 'Syrian Arab Republic', 'TW': 'Taiwan, Province of China', 'TJ': 'Tajikistan', 'TZ': 'Tanzania, United Republic of', 'TH': 'Thailand', 'TL': 'Timor-Leste', 'TG': 'Togo', 'TK': 'Tokelau', 'TO': 'Tonga', 'TT': 'Trinidad and Tobago', 'TN': 'Tunisia', 'TR': 'Turkey', 'TM': 'Turkmenistan', 'TC': 'Turks and Caicos Islands', 'TV': 'Tuvalu', 'UG': 'Uganda', 'UA': 'Ukraine', 'AE': 'United Arab Emirates', 'GB': 'United Kingdom', 'US': 'United States', 'UM': 'United States Minor Outlying Islands', 'UY': 'Uruguay', 'UZ': 'Uzbekistan', 'VU': 'Vanuatu', 'VE': 'Venezuela, Bolivarian Republic of', 'VN': 'Viet Nam', 'VG': 'Virgin Islands, British', 'VI': 'Virgin Islands, U.S.', 'WF': 'Wallis and Futuna', 'EH': 'Western Sahara', 'YE': 'Yemen', 'ZM': 'Zambia', 'ZW': 'Zimbabwe' };\nif (!window.AuthMessages) {\n    throw new Error('On a page where you load this JavaScript, you must also load the \"client_messages.js\" script');\n}\nexports.auth = {\n    texts: AuthMessages,\n    profile: undefined,\n    reset: undefined,\n    entityify: function (string) {\n        return string.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&#39;').replace(/`/g, '&#96;');\n    },\n    emailRegex: /^(([a-zA-Z0-9_+\\.\\-]+)@([\\da-zA-Z\\.\\-]+)\\.([a-zA-Z\\.]{2,6})\\s*)$/,\n    redirect: function (where) {\n        where = '/' + where;\n        window.location.pathname = where;\n    },\n    logout: function () {\n        $.ajax({ type: 'POST', url: '/auth/logout' }).done(function () {\n            exports.auth.redirect('login');\n        });\n    },\n    destroy: function () {\n        modal_1.modal.confirm(exports.auth.texts['are_you_sure'], function () {\n            $.ajax({ type: 'POST', url: '/auth/destroy' }).done(function () {\n                exports.auth.redirect('');\n            });\n        });\n    },\n    error: function (message, element, id) {\n        $(id || '#error').html(message);\n        $(id || '#error').css('display', 'block');\n        if (element)\n            $('#' + element).css('border', 'solid 1px red');\n    },\n    clear_error: function (id) {\n        $(id || '#error').html('');\n        $(id || '#error').css('display', 'none');\n        $('form *').css('border', '');\n    },\n    success: function (message, id) {\n        $('#error').css('display', 'none');\n        $(id || '#success').html(message);\n        $(id || '#success').css('display', 'block');\n    },\n    submit: function (op) {\n        var _a, _b, _c, _d;\n        var values = {};\n        $('form.auth *').map(function (_k, el) {\n            if (el.id)\n                values[el.id] = el.value;\n        });\n        if (op === 'signup') {\n            if (!values.username)\n                return exports.auth.error(exports.auth.texts['please_username'], 'username');\n            values.username = values.username.trim();\n            if (values.username.length < 3)\n                return exports.auth.error(exports.auth.texts['username_three'], 'username');\n            if (values.username.match(/:|@/))\n                return exports.auth.error(exports.auth.texts['username_special'], 'username');\n            if (!((_a = values.email) === null || _a === void 0 ? void 0 : _a.match(exports.auth.emailRegex)))\n                return exports.auth.error(exports.auth.texts['valid_email'], 'email');\n            if (values.email !== values.mail_repeat)\n                return exports.auth.error(exports.auth.texts['repeat_match_email'], 'mail_repeat');\n            if (!values.password)\n                return exports.auth.error(exports.auth.texts['please_password'], 'password');\n            if (values.password.length < 6)\n                return exports.auth.error(exports.auth.texts['password_six'], 'password');\n            if (values.password !== values.password_repeat)\n                return exports.auth.error(exports.auth.texts['repeat_match_password'], 'password_repeat');\n            if (values.birth_year) {\n                if (!validBirthYearString(values.birth_year)) {\n                    return exports.auth.error(exports.auth.texts['valid_year'] + new Date().getFullYear(), 'birth_year');\n                }\n            }\n            var payload = {\n                username: values.username,\n                email: values.email,\n                password: values.password,\n                birth_year: values.birth_year ? parseInt(values.birth_year) : undefined,\n                country: values.country ? values.country : undefined,\n                gender: values.gender ? values.gender : undefined,\n                subscribe: $('#subscribe').prop('checked'),\n                prog_experience: $('input[name=has_experience]:checked').val(),\n                experience_languages: $('#languages').is(':visible')\n                    ? $('input[name=languages]').filter(':checked').map(function (_, box) { return $(box).val(); }).get()\n                    : undefined,\n            };\n            $.ajax({ type: 'POST', url: '/auth/signup', data: JSON.stringify(payload), contentType: 'application/json; charset=utf-8' }).done(function () {\n                exports.auth.success(exports.auth.texts['signup_success']);\n                // We set up a non-falsy profile to let `saveit` know that we're logged in. We put session_expires_at since we need it.\n                exports.auth.profile = { session_expires_at: Date.now() + 1000 * 60 * 60 * 24 };\n                afterLogin();\n            }).fail(function (response) {\n                var error = response.responseText || '';\n                if (error.match('email'))\n                    exports.auth.error(exports.auth.texts['exists_email']);\n                else if (error.match('username'))\n                    exports.auth.error(exports.auth.texts['exists_username']);\n                else\n                    exports.auth.error(exports.auth.texts['ajax_error']);\n            });\n        }\n        if (op === 'login') {\n            if (!values.username)\n                return exports.auth.error(exports.auth.texts['please_username_email'], 'username');\n            if (!values.password)\n                return exports.auth.error(exports.auth.texts['please_password'], 'password');\n            exports.auth.clear_error();\n            $.ajax({ type: 'POST', url: '/auth/login', data: JSON.stringify({ username: values.username, password: values.password }), contentType: 'application/json; charset=utf-8' }).done(function () {\n                // We set up a non-falsy profile to let `saveit` know that we're logged in. We put session_expires_at since we need it.\n                exports.auth.profile = { session_expires_at: Date.now() + 1000 * 60 * 60 * 24 };\n                afterLogin();\n            }).fail(function (response) {\n                var _a;\n                if (response.status === 403) {\n                    exports.auth.error(exports.auth.texts['invalid_username_password'] + ' ' + exports.auth.texts['no_account'] + ' &nbsp;<button class=\"green-btn\" onclick=\"auth.redirect (\\'signup\\')\">' + exports.auth.texts['create_account'] + '</button>');\n                    $('#create-account').hide();\n                    localStorage.setItem('hedy-login-username', (_a = values.username) !== null && _a !== void 0 ? _a : '');\n                }\n                else\n                    exports.auth.error(exports.auth.texts['ajax_error']);\n            });\n        }\n        if (op === 'profile') {\n            if (!((_b = values.email) !== null && _b !== void 0 ? _b : '').match(exports.auth.emailRegex))\n                return exports.auth.error(exports.auth.texts['valid_email'], 'email');\n            if (values.birth_year) {\n                if (!validBirthYearString(values.birth_year)) {\n                    return exports.auth.error(exports.auth.texts['valid_year'] + new Date().getFullYear(), 'birth_year');\n                }\n            }\n            var payload = {\n                email: values['email'],\n                birth_year: values.birth_year ? parseInt(values['birth_year']) : undefined,\n                country: values['country'],\n                gender: values['gender'],\n                prog_experience: $('input[name=has_experience]:checked').val(),\n                experience_languages: $('#languages').is(':visible')\n                    ? $('input[name=languages]').filter(':checked').map(function (_, box) { return $(box).val(); }).get()\n                    : undefined,\n            };\n            console.log(payload);\n            exports.auth.clear_error();\n            $.ajax({ type: 'POST', url: '/profile', data: JSON.stringify(payload), contentType: 'application/json; charset=utf-8' }).done(function () {\n                exports.auth.success(exports.auth.texts['profile_updated']);\n            }).fail(function (response) {\n                exports.auth.error(exports.auth.texts['ajax_error'] + ' ' + response.responseText);\n            });\n        }\n        if (op === 'change_password') {\n            if (!values.password)\n                return exports.auth.error(exports.auth.texts['please_password'], 'password', '#error-password');\n            if (values.password.length < 6)\n                return exports.auth.error(exports.auth.texts['password_six'], 'password', '#error-password');\n            if (values.password !== values.password_repeat)\n                return exports.auth.error(exports.auth.texts['repeat_match'], 'password_repeat', '#error-password');\n            var payload = { old_password: values.old_password, new_password: values.password };\n            exports.auth.clear_error('#error-password');\n            $.ajax({ type: 'POST', url: '/auth/change_password', data: JSON.stringify(payload), contentType: 'application/json; charset=utf-8' }).done(function () {\n                exports.auth.success(exports.auth.texts['password_updated'], '#success-password');\n                $('#old_password').val('');\n                $('#password').val('');\n                $('#password_repeat').val('');\n            }).fail(function (response) {\n                if (response.status === 403)\n                    exports.auth.error(exports.auth.texts['invalid_password'], null, '#error-password');\n                else\n                    exports.auth.error(exports.auth.texts['ajax_error'], null, '#error-password');\n            });\n        }\n        if (op === 'recover') {\n            if (!values.username)\n                return exports.auth.error(exports.auth.texts['please_username'], 'username');\n            var payload = { username: values.username };\n            exports.auth.clear_error();\n            $.ajax({ type: 'POST', url: '/auth/recover', data: JSON.stringify(payload), contentType: 'application/json; charset=utf-8' }).done(function () {\n                exports.auth.success(exports.auth.texts['sent_password_recovery']);\n                $('#username').val('');\n            }).fail(function (response) {\n                if (response.status === 403)\n                    exports.auth.error(exports.auth.texts['invalid_username']);\n                else\n                    exports.auth.error(exports.auth.texts['ajax_error']);\n            });\n        }\n        if (op === 'reset') {\n            if (!values.password)\n                return exports.auth.error(exports.auth.texts['please_password'], 'password');\n            if (values.password.length < 6)\n                return exports.auth.error(exports.auth.texts['password_six'], 'password');\n            if (values.password !== values.password_repeat)\n                return exports.auth.error(exports.auth.texts['repeat_match'], 'password_repeat');\n            var payload = { username: (_c = exports.auth.reset) === null || _c === void 0 ? void 0 : _c['username'], token: (_d = exports.auth.reset) === null || _d === void 0 ? void 0 : _d['token'], password: values.password };\n            exports.auth.clear_error();\n            $.ajax({ type: 'POST', url: '/auth/reset', data: JSON.stringify(payload), contentType: 'application/json; charset=utf-8' }).done(function () {\n                exports.auth.success(exports.auth.texts['password_resetted']);\n                $('#password').val('');\n                $('#password_repeat').val('');\n                delete exports.auth.reset;\n                exports.auth.redirect('login');\n            }).fail(function (response) {\n                if (response.status === 403)\n                    exports.auth.error(exports.auth.texts['invalid_reset_link']);\n                else\n                    exports.auth.error(exports.auth.texts['ajax_error']);\n            });\n        }\n    },\n    markAsTeacher: function (username, is_teacher) {\n        $.ajax({ type: 'POST', url: '/admin/markAsTeacher', data: JSON.stringify({ username: username, is_teacher: is_teacher }), contentType: 'application/json; charset=utf-8' }).done(function () {\n            modal_1.modal.alert(['User', username, 'successfully', is_teacher ? 'marked' : 'unmarked', 'as teacher'].join(' '), 4000);\n            location.reload();\n        }).fail(function (error) {\n            console.log(error);\n            modal_1.modal.alert(['Error when', is_teacher ? 'marking' : 'unmarking', 'user', username, 'as teacher'].join(' '));\n        });\n    },\n    changeUserEmail: function (username, email) {\n        modal_1.modal.prompt('Please enter the corrected email', email, function (correctedEmail) {\n            if (correctedEmail === email)\n                return;\n            if (!correctedEmail.match(exports.auth.emailRegex))\n                return modal_1.modal.alert('Please enter a valid email.');\n            $.ajax({ type: 'POST', url: '/admin/changeUserEmail', data: JSON.stringify({ username: username, email: correctedEmail }), contentType: 'application/json; charset=utf-8' }).done(function () {\n                modal_1.modal.alert(['Successfully changed the email for User', username, 'to', correctedEmail].join(' '));\n                location.reload();\n            }).fail(function (error) {\n                console.log(error);\n                modal_1.modal.alert(['Error when changing the email for User', username].join(' '));\n            });\n        });\n    },\n};\n// *** LOADERS ***\nif ($('#country')) {\n    var html_1 = $('#country').html();\n    Object.keys(countries).map(function (code) {\n        html_1 += '<option value=\"' + code + '\">' + countries[code] + '</option>';\n    });\n    $('#country').html(html_1);\n}\n$('.auth input').get().map(function (el) {\n    // Clear red borders if input was marked from a previous error.\n    el.addEventListener('input', function () { return exports.auth.clear_error(); });\n});\n// We use GET /profile to see if we're logged in since we use HTTP only cookies and cannot check from javascript.\n$.ajax({ type: 'GET', url: '/profile' }).done(function (response) {\n    if (['/signup', '/login'].indexOf(window.location.pathname) !== -1)\n        exports.auth.redirect('my-profile');\n    exports.auth.profile = response;\n    if ($('#profile').html()) {\n        $('#username').html(response.username);\n        $('#email').val(response.email);\n        $('#birth_year').val(response.birth_year);\n        $('#gender').val(response.gender);\n        $('#country').val(response.country);\n        if (response.prog_experience) {\n            $('input[name=has_experience][value=\"' + response.prog_experience + '\"]').prop('checked', true);\n            if (response.prog_experience === 'yes')\n                $('#languages').show();\n        }\n        (response.experience_languages || []).map(function (lang) {\n            $('input[name=languages][value=\"' + lang + '\"]').prop('checked', true);\n        });\n        if (!jQuery.isEmptyObject(response.student_classes)) {\n            $('#student_classes ul').html((response.student_classes || []).map(function (Class) {\n                return '<li>' + exports.auth.entityify(Class.name) + '</li>';\n            }).join(''));\n        }\n        else {\n            $('#student_classes').hide();\n        }\n    }\n}).fail(function (_response) {\n    if (window.location.pathname.indexOf('/my-profile') !== -1)\n        exports.auth.redirect('login');\n});\nif (window.location.pathname === '/reset') {\n    var query = window.location.search.slice(1).split('&');\n    var params_1 = {};\n    query.map(function (item) {\n        var split = item.split('=');\n        params_1[split[0]] = decodeURIComponent(split[1]);\n    });\n    // If we don't receive username and token, the redirect link is invalid. We redirect the user to /recover.\n    if (!params_1['username'] || !params_1['token'])\n        exports.auth.redirect('recover');\n    else\n        exports.auth.reset = params_1;\n}\nif (window.location.pathname === '/signup') {\n    var login_username = localStorage.getItem('hedy-login-username');\n    if (login_username) {\n        localStorage.removeItem('hedy-login-username');\n        if (login_username.match('@'))\n            $('#email').val(login_username);\n        else\n            $('#username').val(login_username);\n    }\n}\n$('#email, #mail_repeat').on('cut copy paste', function (e) {\n    e.preventDefault();\n    return false;\n});\n/**\n * After login:\n *\n * - Check if there's a saved program in localstorage. If so, save it.\n * - Check if we were supposed to be joining a class. If so, join it.\n * - Otherwise redirect to \"my programs\".\n */\nfunction afterLogin() {\n    return __awaiter(this, void 0, void 0, function () {\n        var savedProgramString, savedProgram, redirect_1, joinClassString, joinClass, redirect;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    savedProgramString = localStorage.getItem('hedy-first-save');\n                    savedProgram = savedProgramString ? JSON.parse(savedProgramString) : undefined;\n                    if (!savedProgram) return [3 /*break*/, 2];\n                    return [4 /*yield*/, (0, app_1.saveitP)(savedProgram[0], savedProgram[1], savedProgram[2], savedProgram[3])];\n                case 1:\n                    _a.sent();\n                    localStorage.removeItem('hedy-first-save');\n                    redirect_1 = getSavedRedirectPath();\n                    if (redirect_1) {\n                        return [2 /*return*/, exports.auth.redirect(redirect_1)];\n                    }\n                    _a.label = 2;\n                case 2:\n                    joinClassString = localStorage.getItem('hedy-join');\n                    joinClass = joinClassString ? JSON.parse(joinClassString) : undefined;\n                    if (joinClass) {\n                        localStorage.removeItem('hedy-join');\n                        return [2 /*return*/, (0, teachers_1.join_class)(joinClass.link, joinClass.name)];\n                    }\n                    redirect = getSavedRedirectPath();\n                    if (redirect) {\n                        return [2 /*return*/, exports.auth.redirect(redirect)];\n                    }\n                    exports.auth.redirect('programs');\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nfunction getSavedRedirectPath() {\n    var redirect = localStorage.getItem('hedy-save-redirect');\n    if (redirect) {\n        localStorage.removeItem('hedy-save-redirect');\n    }\n    return redirect;\n}\nfunction validBirthYearString(year) {\n    var birth_year = parseInt(year);\n    if (!birth_year || birth_year < 1900 || birth_year > new Date().getFullYear())\n        return false;\n    return true;\n}\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.get_trimmed_code = exports.load_quiz = exports.prompt_unsaved = exports.copy_to_clipboard = exports.share_program = exports.viewProgramLink = exports.saveitP = exports.saveit = exports.tryPaletteCode = exports.runit = exports.theGlobalEditor = void 0;\n// It's important that this file gets loaded first\nrequire(\"./syntaxModesRules\");\nvar modal_1 = require(\"./modal\");\nvar auth_1 = require(\"./auth\");\n(function () {\n    // A bunch of code expects a global \"State\" object. Set it here if not\n    // set yet.\n    if (!window.State) {\n        window.State = {};\n    }\n    // *** EDITOR SETUP ***\n    initializeMainEditor($('#editor'));\n    var _loop_1 = function (preview) {\n        $(preview).addClass('text-lg rounded');\n        var exampleEditor = turnIntoAceEditor(preview, true);\n        // Fits to content size\n        exampleEditor.setOptions({ maxLines: Infinity });\n        exampleEditor.setOptions({ minLines: 2 });\n        // Strip trailing newline, it renders better\n        exampleEditor.setValue(exampleEditor.getValue().replace(/\\n+$/, ''), -1);\n        // And add an overlay button to the editor, if the no-copy-button attribute isn't there\n        if (!$(preview).hasClass('no-copy-button')) {\n            var buttonContainer = $('<div>').css({ position: 'absolute', top: 5, right: 5, width: 'auto' }).appendTo(preview);\n            $('<button>').attr('title', UiMessages['try_button']).css({ fontFamily: 'sans-serif' }).addClass('green-btn').text('\u21E5').appendTo(buttonContainer).click(function () {\n                exports.theGlobalEditor === null || exports.theGlobalEditor === void 0 ? void 0 : exports.theGlobalEditor.setValue(exampleEditor.getValue() + '\\n');\n            });\n        }\n        else {\n            if ($(preview).attr('id')) {\n                // @ts-ignore\n                var level = String($(preview).attr('id'));\n                var mode = getHighlighter(parseInt(level));\n                exampleEditor.session.setMode(mode);\n            }\n        }\n    };\n    // Any code blocks we find inside 'turn-pre-into-ace' get turned into\n    // read-only editors (for syntax highlighting)\n    for (var _i = 0, _a = $('.turn-pre-into-ace pre').get(); _i < _a.length; _i++) {\n        var preview = _a[_i];\n        _loop_1(preview);\n    }\n    /**\n     * Initialize the main editor and attach all the required event handlers\n     */\n    function initializeMainEditor($editor) {\n        if (!$editor.length)\n            return;\n        // We expose the editor globally so it's available to other functions for resizing\n        var editor = turnIntoAceEditor($editor.get(0), $editor.data('readonly'));\n        exports.theGlobalEditor = editor;\n        modal_1.error.setEditor(editor);\n        window.Range = ace.require('ace/range').Range; // get reference to ace/range\n        // Load existing code from session, if it exists\n        var storage = window.sessionStorage;\n        if (storage) {\n            var levelKey_1 = $editor.data('lskey');\n            var loadedProgram = $editor.data('loaded-program');\n            // On page load, if we have a saved program and we are not loading a program by id, we load the saved program\n            var programFromStorage = storage.getItem(levelKey_1);\n            if (loadedProgram !== 'True' && programFromStorage) {\n                editor.setValue(programFromStorage, 1);\n            }\n            // When the user exits the editor, save what we have.\n            editor.on('blur', function (_e) {\n                storage.setItem(levelKey_1, editor.getValue());\n            });\n            // If prompt is shown and user enters text in the editor, hide the prompt.\n            editor.on('change', function () {\n                if ($('#inline-modal').is(':visible'))\n                    $('#inline-modal').hide();\n                window.State.disable_run = false;\n                $('#runit').css('background-color', '');\n                window.State.unsaved_changes = true;\n                clearErrors(editor);\n            });\n        }\n        // *** PROMPT TO SAVE CHANGES ***\n        window.onbeforeunload = function () {\n            // The browser doesn't show this message, rather it shows a default message.\n            if (window.State.unsaved_changes && !window.State.no_unload_prompt) {\n                return auth_1.auth.texts['unsaved_changes'];\n            }\n            else {\n                return undefined;\n            }\n        };\n        // *** KEYBOARD SHORTCUTS ***\n        var altPressed;\n        // alt is 18, enter is 13\n        window.addEventListener('keydown', function (ev) {\n            var keyCode = ev.keyCode;\n            if (keyCode === 18) {\n                altPressed = true;\n                return;\n            }\n            if (keyCode === 13 && altPressed) {\n                if (!window.State.level || !window.State.lang) {\n                    throw new Error('Oh no');\n                }\n                runit(window.State.level, window.State.lang, function () {\n                    $('#output').focus();\n                });\n            }\n            // We don't use jquery because it doesn't return true for this equality check.\n            if (keyCode === 37 && document.activeElement === document.getElementById('output')) {\n                editor.focus();\n                editor.navigateFileEnd();\n            }\n        });\n        window.addEventListener('keyup', function (ev) {\n            var keyCode = ev.keyCode;\n            if (keyCode === 18) {\n                altPressed = false;\n                return;\n            }\n        });\n        return editor;\n    }\n    /**\n     * Turn an HTML element into an Ace editor\n     */\n    function turnIntoAceEditor(element, isReadOnly) {\n        var editor = ace.edit(element);\n        editor.setTheme(\"ace/theme/monokai\");\n        if (isReadOnly) {\n            editor.setOptions({\n                readOnly: true,\n                showGutter: false,\n                showPrintMargin: false,\n                highlightActiveLine: false\n            });\n        }\n        // a variable which turns on(1) highlighter or turns it off(0)\n        var highlighter = 1;\n        if (highlighter == 1) {\n            // Everything turns into 'ace/mode/levelX', except what's in\n            // this table. Yes the numbers are strings. That's just JavaScript for you.\n            if (window.State.level) {\n                var mode = getHighlighter(parseInt(window.State.level));\n                editor.session.setMode(mode);\n            }\n        }\n        return editor;\n    }\n})();\nfunction getHighlighter(level) {\n    var modeExceptions = {\n        '9': 'ace/mode/level9and10',\n        '10': 'ace/mode/level9and10',\n        '18': 'ace/mode/level18and19',\n        '19': 'ace/mode/level18and19',\n    };\n    return modeExceptions[level] || \"ace/mode/level\" + level;\n}\nfunction reloadOnExpiredSession() {\n    // If user is not logged in or session is not expired, return false.\n    if (!auth_1.auth.profile || auth_1.auth.profile.session_expires_at > Date.now())\n        return false;\n    // Otherwise, reload the page to update the top bar.\n    location.reload();\n    return true;\n}\nfunction clearErrors(editor) {\n    editor.session.clearAnnotations();\n    for (var marker in editor.session.getMarkers(false)) {\n        editor.session.removeMarker(marker);\n    }\n}\nfunction runit(level, lang, cb) {\n    if (window.State.disable_run)\n        return modal_1.modal.alert(auth_1.auth.texts['answer_question']);\n    if (reloadOnExpiredSession())\n        return;\n    modal_1.error.hide();\n    try {\n        level = level.toString();\n        var editor = exports.theGlobalEditor;\n        var code = get_trimmed_code();\n        clearErrors(editor);\n        console.log('Original program:\\n', code);\n        $.ajax({\n            type: 'POST',\n            url: '/parse',\n            data: JSON.stringify({\n                level: level,\n                code: code,\n                lang: lang,\n                read_aloud: !!$('#speak_dropdown').val(),\n                adventure_name: window.State.adventure_name\n            }),\n            contentType: 'application/json',\n            dataType: 'json'\n        }).done(function (response) {\n            console.log('Response', response);\n            if (response.Warning) {\n                modal_1.error.showWarning(ErrorMessages['Transpile_warning'], response.Warning);\n            }\n            if (response.Error) {\n                modal_1.error.show(ErrorMessages['Transpile_error'], response.Error);\n                if (response.Location && response.Location[0] != \"?\") {\n                    editor.session.setAnnotations([\n                        {\n                            row: response.Location[0] - 1,\n                            column: response.Location[1] - 1,\n                            text: \"\",\n                            type: \"error\",\n                        }\n                    ]);\n                    // FIXME change this to apply only to the error span once errors have an end location.\n                    editor.session.addMarker(new ace.Range(response.Location[0] - 1, response.Location[1] - 1, response.Location[0] - 1, response.Location[1]), \"editor-error\", \"fullLine\", false);\n                }\n                return;\n            }\n            runPythonProgram(response.Code, response.has_turtle, cb).catch(function (err) {\n                console.log(err);\n                modal_1.error.show(ErrorMessages['Execute_error'], err.message);\n                reportClientError(level, code, err.message);\n            });\n        }).fail(function (xhr) {\n            console.error(xhr);\n            // https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/readyState\n            if (xhr.readyState < 4) {\n                modal_1.error.show(ErrorMessages['Connection_error'], ErrorMessages['CheckInternet']);\n            }\n            else {\n                modal_1.error.show(ErrorMessages['Other_error'], ErrorMessages['ServerError']);\n            }\n        });\n    }\n    catch (e) {\n        console.error(e);\n        modal_1.error.show(ErrorMessages['Other_error'], e.message);\n    }\n}\nexports.runit = runit;\n/**\n * Called when the user clicks the \"Try\" button in one of the palette buttons\n */\nfunction tryPaletteCode(exampleCode) {\n    var editor = ace.edit(\"editor\");\n    var MOVE_CURSOR_TO_END = 1;\n    editor.setValue(exampleCode + '\\n', MOVE_CURSOR_TO_END);\n    window.State.unsaved_changes = false;\n}\nexports.tryPaletteCode = tryPaletteCode;\nfunction saveit(level, lang, name, code, cb) {\n    modal_1.error.hide();\n    if (reloadOnExpiredSession())\n        return;\n    try {\n        // If there's no session but we want to save the program, we store the program data in localStorage and redirect to /login.\n        if (!auth_1.auth.profile) {\n            return modal_1.modal.confirm(auth_1.auth.texts['save_prompt'], function () {\n                // If there's an adventure_name, we store it together with the level, because it won't be available otherwise after signup/login.\n                if (window.State && window.State.adventure_name && !Array.isArray(level))\n                    level = [level, window.State.adventure_name];\n                localStorage.setItem('hedy-first-save', JSON.stringify([level, lang, name, code]));\n                window.location.pathname = '/login';\n            });\n        }\n        window.State.unsaved_changes = false;\n        var adventure_name = window.State.adventure_name;\n        // If saving a program for an adventure after a signup/login, level is an array of the form [level, adventure_name]. In that case, we unpack it.\n        if (Array.isArray(level)) {\n            adventure_name = level[1];\n            level = level[0];\n        }\n        $.ajax({\n            type: 'POST',\n            url: '/programs',\n            data: JSON.stringify({\n                level: level,\n                lang: lang,\n                name: name,\n                code: code,\n                adventure_name: adventure_name\n            }),\n            contentType: 'application/json',\n            dataType: 'json'\n        }).done(function (response) {\n            var _a;\n            // The auth functions use this callback function.\n            if (cb)\n                return response.Error ? cb(response) : cb(null, response);\n            if (response.Warning) {\n                modal_1.error.showWarning(ErrorMessages['Transpile_warning'], response.Warning);\n            }\n            if (response.Error) {\n                modal_1.error.show(ErrorMessages['Transpile_error'], response.Error);\n                return;\n            }\n            modal_1.modal.alert(auth_1.auth.texts['save_success_detail'], 4000);\n            // If we succeed, we need to update the default program name & program for the currently selected tab.\n            // To avoid this, we'd have to perform a page refresh to retrieve the info from the server again, which would be more cumbersome.\n            // The name of the program might have been changed by the server, so we use the name stated by the server.\n            $('#program_name').val(response.name);\n            (_a = window.State.adventures) === null || _a === void 0 ? void 0 : _a.map(function (adventure) {\n                if (adventure.short_name === (adventure_name || 'level')) {\n                    adventure.loaded_program = { name: response.name, code: code };\n                }\n            });\n        }).fail(function (err) {\n            console.error(err);\n            modal_1.error.show(ErrorMessages['Connection_error'], JSON.stringify(err));\n            if (err.status === 403) {\n                localStorage.setItem('hedy-first-save', JSON.stringify([adventure_name ? [level, adventure_name] : level, lang, name, code]));\n                localStorage.setItem('hedy-save-redirect', 'hedy');\n                window.location.pathname = '/login';\n            }\n        });\n    }\n    catch (e) {\n        console.error(e);\n        modal_1.error.show(ErrorMessages['Other_error'], e.message);\n    }\n}\nexports.saveit = saveit;\n/**\n * The 'saveit' function, as an async function\n */\nfunction saveitP(level, lang, name, code) {\n    return new Promise(function (ok, ko) {\n        saveit(level, lang, name, code, function (err, response) {\n            if (err) {\n                ko(err);\n            }\n            else {\n                ok(response);\n            }\n        });\n    });\n}\nexports.saveitP = saveitP;\nfunction viewProgramLink(programId) {\n    return window.location.origin + '/hedy/' + programId + '/view';\n}\nexports.viewProgramLink = viewProgramLink;\nfunction share_program(level, lang, id, Public, reload) {\n    if (!auth_1.auth.profile)\n        return modal_1.modal.alert(auth_1.auth.texts['must_be_logged']);\n    var share = function (id) {\n        $.ajax({\n            type: 'POST',\n            url: '/programs/share',\n            data: JSON.stringify({\n                id: id,\n                public: Public\n            }),\n            contentType: 'application/json',\n            dataType: 'json'\n        }).done(function (_response) {\n            // If we're sharing the program, copy the link to the clipboard.\n            if (Public)\n                copy_to_clipboard(viewProgramLink(id), true);\n            modal_1.modal.alert(Public ? auth_1.auth.texts['share_success_detail'] : auth_1.auth.texts['unshare_success_detail'], 4000);\n            if (reload)\n                setTimeout(function () { location.reload(); }, 1000);\n        }).fail(function (err) {\n            console.error(err);\n            modal_1.error.show(ErrorMessages['Connection_error'], JSON.stringify(err));\n        });\n    };\n    // If id is not true, the request comes from the programs page. In that case, we merely call the share function.\n    if (id !== true)\n        return share(id);\n    // Otherwise, we save the program and then share it.\n    // Saving the program makes things way simpler for many reasons: it covers the cases where:\n    // 1) there's no saved program; 2) there's no saved program for that user; 3) the program has unsaved changes.\n    var name = \"\" + $('#program_name').val();\n    var code = get_trimmed_code();\n    return saveit(level, lang, name, code, function (err, resp) {\n        if (err && err.Warning)\n            return modal_1.error.showWarning(ErrorMessages['Transpile_warning'], err.Warning);\n        if (err && err.Error)\n            return modal_1.error.show(ErrorMessages['Transpile_error'], err.Error);\n        share(resp.id);\n    });\n}\nexports.share_program = share_program;\nfunction copy_to_clipboard(string, noAlert) {\n    var _a, _b;\n    // https://hackernoon.com/copying-text-to-clipboard-with-javascript-df4d4988697f\n    var el = document.createElement('textarea');\n    el.value = string;\n    el.setAttribute('readonly', '');\n    el.style.position = 'absolute';\n    el.style.left = '-9999px';\n    document.body.appendChild(el);\n    var selection = document.getSelection();\n    var originalSelection = selection && selection.rangeCount > 0 ? selection.getRangeAt(0) : undefined;\n    el.select();\n    document.execCommand('copy');\n    document.body.removeChild(el);\n    if (originalSelection) {\n        (_a = document.getSelection()) === null || _a === void 0 ? void 0 : _a.removeAllRanges();\n        (_b = document.getSelection()) === null || _b === void 0 ? void 0 : _b.addRange(originalSelection);\n    }\n    if (!noAlert)\n        modal_1.modal.alert(auth_1.auth.texts['copy_clipboard'], 4000);\n}\nexports.copy_to_clipboard = copy_to_clipboard;\n/**\n * Do a POST with the error to the server so we can log it\n */\nfunction reportClientError(level, code, client_error) {\n    $.ajax({\n        type: 'POST',\n        url: '/report_error',\n        data: JSON.stringify({\n            level: level,\n            code: code,\n            page: window.location.href,\n            client_error: client_error,\n        }),\n        contentType: 'application/json',\n        dataType: 'json'\n    });\n}\nwindow.onerror = function reportClientException(message, source, line_number, column_number, error) {\n    $.ajax({\n        type: 'POST',\n        url: '/client_exception',\n        data: JSON.stringify({\n            message: message,\n            source: source,\n            line_number: line_number,\n            column_number: column_number,\n            error: error,\n            url: window.location.href,\n            user_agent: navigator.userAgent,\n        }),\n        contentType: 'application/json',\n        dataType: 'json'\n    });\n};\nfunction runPythonProgram(code, hasTurtle, cb) {\n    // We keep track of how many programs are being run at the same time to avoid prints from multiple simultaneous programs.\n    // Please see note at the top of the `outf` function.\n    if (!window.State.programsInExecution)\n        window.State.programsInExecution = 0;\n    window.State.programsInExecution++;\n    var outputDiv = $('#output');\n    outputDiv.empty();\n    Sk.pre = \"output\";\n    var turtleConfig = (Sk.TurtleGraphics || (Sk.TurtleGraphics = {}));\n    turtleConfig.target = 'turtlecanvas';\n    turtleConfig.width = 400;\n    turtleConfig.height = 300;\n    turtleConfig.worldWidth = 400;\n    turtleConfig.worldHeight = 300;\n    if (!hasTurtle) {\n        // There might still be a visible turtle panel. If the new program does not use the Turtle,\n        // remove it (by clearing the '#turtlecanvas' div)\n        $('#turtlecanvas').empty();\n    }\n    Sk.configure({\n        output: outf,\n        read: builtinRead,\n        inputfun: inputFromInlineModal,\n        inputfunTakesPrompt: true,\n        __future__: Sk.python3,\n        timeoutMsg: function () { return ErrorMessages['Program_too_long']; },\n        // Give up after three seconds of execution, there might be an infinite loop.\n        // This function can be customized later to yield different timeouts for different levels.\n        execLimit: (function () {\n            // const level = window.State.level;\n            return ((hasTurtle) ? 20000 : 3000);\n        })()\n    });\n    return Sk.misceval.asyncToPromise(function () {\n        return Sk.importMainWithBody(\"<stdin>\", false, code, true);\n    }).then(function (_mod) {\n        console.log('Program executed');\n        // Check if the program was correct but the output window is empty: Return a warning\n        if (window.State.programsInExecution === 1 && $('#output').is(':empty') && $('#turtlecanvas').is(':empty')) {\n            modal_1.error.showWarning(ErrorMessages['Transpile_warning'], ErrorMessages['Empty_output']);\n        }\n        window.State.programsInExecution--;\n        if (cb)\n            cb();\n    }).catch(function (err) {\n        // Extract error message from error\n        console.log(err);\n        var errorMessage = errorMessageFromSkulptError(err) || JSON.stringify(err);\n        throw new Error(errorMessage);\n    });\n    /**\n     * Get the error messages from a Skulpt error\n     *\n     * They look like this:\n     *\n     * {\"args\":{\"v\":[{\"v\":\"name 'name' is not defined\"}]},\"traceback\":[{\"lineno\":3,\"colno\":0,\"filename\":\"<stdin>.py\"}]}\n     *\n     * Don't know why, so let's be defensive about it.\n     */\n    function errorMessageFromSkulptError(err) {\n        var message = err.args && err.args.v && err.args.v[0] && err.args.v[0].v;\n        return message;\n    }\n    function addToOutput(text, color) {\n        $('<span>').text(text).css({ color: color }).appendTo(outputDiv);\n    }\n    // output functions are configurable.  This one just appends some text\n    // to a pre element.\n    function outf(text) {\n        // If there's more than one program being executed at a time, we ignore it.\n        // This happens when a program requiring user input is suspended when the user changes the code.\n        if (window.State.programsInExecution > 1)\n            return;\n        addToOutput(text, 'white');\n        speak(text);\n    }\n    function builtinRead(x) {\n        if (Sk.builtinFiles === undefined || Sk.builtinFiles[\"files\"][x] === undefined)\n            throw \"File not found: '\" + x + \"'\";\n        return Sk.builtinFiles[\"files\"][x];\n    }\n    // This method draws the prompt for asking for user input.\n    function inputFromInlineModal(prompt) {\n        // We give the user time to give input.\n        Sk.execStart = new Date(new Date().getTime() + 1000 * 60 * 60 * 24 * 365);\n        $('#turtlecanvas').empty();\n        return new Promise(function (ok) {\n            window.State.disable_run = true;\n            $('#runit').css('background-color', 'gray');\n            var input = $('#inline-modal input[type=\"text\"]');\n            $('#inline-modal .caption').text(prompt);\n            input.val('');\n            input.attr('placeholder', prompt);\n            speak(prompt);\n            setTimeout(function () {\n                input.focus();\n            }, 0);\n            $('#inline-modal form').one('submit', function (event) {\n                window.State.disable_run = false;\n                $('#runit').css('background-color', '');\n                event.preventDefault();\n                $('#inline-modal').hide();\n                // We reset the timer to the present moment.\n                Sk.execStart = new Date();\n                // We set a timeout for sending back the input, so that the input box is hidden before processing the program.\n                // Since processing the program might take some time, this timeout increases the responsiveness of the UI after\n                // replying to a query.\n                setTimeout(function () {\n                    ok(input.val());\n                    $('#output').focus();\n                }, 0);\n                return false;\n            });\n            $('#inline-modal').show();\n        });\n    }\n}\nfunction speak(text) {\n    var selectedURI = $('#speak_dropdown').val();\n    if (!selectedURI) {\n        return;\n    }\n    var voice = window.speechSynthesis.getVoices().filter(function (v) { return v.voiceURI === selectedURI; })[0];\n    if (voice) {\n        var utterance = new SpeechSynthesisUtterance(text);\n        utterance.voice = voice;\n        utterance.rate = 0.9;\n        speechSynthesis.speak(utterance);\n    }\n}\n(function () {\n    if (!window.speechSynthesis) {\n        return; /* No point in even trying */\n    }\n    if (!window.State.lang) {\n        return; /* Not on a code page */\n    }\n    /**\n     * Show the \"speak\" checkbox if we find that we have speech support for the\n     * current language (showing an initially hidden element is a better experience\n     * than hiding an initially shown element... arguably... ?)\n     *\n     * Also, for funzies: the speechSynthesis.getVoices() array is asynchronously\n     * populated *some time* after the page loads... and we won't know when. Keep\n     * on testing periodically until we got it or it's taken too long to finish.\n     */\n    var attempts = 0;\n    var timer = setInterval(function () {\n        var _a;\n        attempts += 1;\n        var voices = findVoices((_a = window.State.lang) !== null && _a !== void 0 ? _a : '');\n        if (voices.length > 0) {\n            for (var _i = 0, voices_1 = voices; _i < voices_1.length; _i++) {\n                var voice = voices_1[_i];\n                $('#speak_dropdown').append($('<option>').attr('value', voice.voiceURI).text('\uD83D\uDCE3 ' + voice.name));\n            }\n            $('#speak_container').show();\n            clearInterval(timer);\n        }\n        if (attempts >= 20) { // ~2 seconds\n            // Give up\n            clearInterval(timer);\n        }\n    }, 100);\n    function findVoices(lang) {\n        // Our own \"lang\" is *typically* just the language code, but we also have \"pt_BR\".\n        var m = lang.match(/^([a-z]+)/i);\n        if (!m) {\n            return [];\n        }\n        var simpleLang = m[1];\n        // If the feature doesn't exist in the browser, return null\n        if (!window.speechSynthesis) {\n            return [];\n        }\n        return window.speechSynthesis.getVoices().filter(function (voice) { return voice.lang.startsWith(simpleLang); });\n    }\n})();\nfunction prompt_unsaved(cb) {\n    if (!window.State.unsaved_changes)\n        return cb();\n    // This variable avoids showing the generic native `onbeforeunload` prompt\n    window.State.no_unload_prompt = true;\n    modal_1.modal.confirm(auth_1.auth.texts['unsaved_changes'], cb);\n}\nexports.prompt_unsaved = prompt_unsaved;\nfunction load_quiz(level) {\n    $('*[data-tabtarget=\"end\"]').html('<iframe id=\"quiz-iframe\" class=\"w-full\" title=\"Quiz\" src=\"/quiz/start/' + level + '\"></iframe>');\n}\nexports.load_quiz = load_quiz;\nfunction get_trimmed_code() {\n    try {\n        // This module may or may not exist, so let's be extra careful here.\n        var whitespace = ace.require(\"ace/ext/whitespace\");\n        whitespace.trimTrailingSpace(exports.theGlobalEditor.session, true);\n    }\n    catch (e) {\n        console.error(e);\n    }\n    return exports.theGlobalEditor === null || exports.theGlobalEditor === void 0 ? void 0 : exports.theGlobalEditor.getValue();\n}\nexports.get_trimmed_code = get_trimmed_code;\n", "\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar modal_1 = require(\"./modal\");\nvar auth_1 = require(\"./auth\");\nvar app_1 = require(\"./app\");\n/**\n * Activate tabs\n *\n * Protocol:\n *\n * - Tabs consist of a TAB (the sticky-outy bit) and a TARGET\n *   (the pane that gets shown and hidden).\n *\n * - TABS should have: <... data-tab=\"SOME-ID\">\n *\n * - TARGETS should have: <... data-tabtarget=\"SOME-ID\">\n *\n * When a TAB is clicked, the TARGET with the matching id is shown\n * (and all other TARGETS in the same containing HTML element are hidden).\n *\n * The active TAB is indicated by the  '.tab-selected' class, the active\n * TARGET by the *absence* of the '.hidden' class.\n */\n$(function () {\n    function resetWindow() {\n        $('#warningbox').hide();\n        $('#errorbox').hide();\n        $('#output').empty();\n        $('#turtlecanvas').empty();\n        window.State.unsaved_changes = false;\n    }\n    function switchToTab(tabName) {\n        var _a, _b;\n        // Find the tab that leads to this selection, and its siblings\n        var tab = $('*[data-tab=\"' + tabName + '\"]');\n        var allTabs = tab.siblings('*[data-tab]');\n        // Fidn the target associated with this selection, and its siblings\n        var target = $('*[data-tabtarget=\"' + tabName + '\"]');\n        var allTargets = target.siblings('*[data-tabtarget]');\n        // Fix classes\n        allTabs.removeClass('tab-selected');\n        tab.addClass('tab-selected');\n        allTargets.addClass('hidden');\n        target.removeClass('hidden');\n        var adventures = {};\n        (_a = window.State.adventures) === null || _a === void 0 ? void 0 : _a.map(function (adventure) {\n            adventures[adventure.short_name] = adventure;\n        });\n        resetWindow();\n        if (tabName === 'end') {\n            $('#adventures-tab').css('max-height', '100%');\n            $('#level-header input').hide();\n            $('#editor-area').hide();\n            return;\n        }\n        $('#adventures-tab').css('max-height', '20em');\n        $('#level-header input').show();\n        $('#editor-area').show();\n        // If the loaded program (directly requested by link with id) matches the currently selected tab, use that, overriding the loaded program that came in the adventure or level.\n        if (window.State.loaded_program && (window.State.adventure_name_onload || 'level') === tabName) {\n            $('#program_name').val(window.State.loaded_program.name);\n            app_1.theGlobalEditor === null || app_1.theGlobalEditor === void 0 ? void 0 : app_1.theGlobalEditor.setValue(window.State.loaded_program.code);\n        }\n        // If there's a loaded program for the adventure or level now selected, use it.\n        else if ((_b = adventures[tabName]) === null || _b === void 0 ? void 0 : _b.loaded_program) {\n            $('#program_name').val(adventures[tabName].loaded_program.name);\n            app_1.theGlobalEditor === null || app_1.theGlobalEditor === void 0 ? void 0 : app_1.theGlobalEditor.setValue(adventures[tabName].loaded_program.code);\n        }\n        // If there's no loaded program (either requested by id or associated to the adventure/level), load defaults.\n        else if (tabName === 'level' && window.State.default_program_name && window.State.default_program) {\n            $('#program_name').val(window.State.default_program_name);\n            app_1.theGlobalEditor === null || app_1.theGlobalEditor === void 0 ? void 0 : app_1.theGlobalEditor.setValue(window.State.default_program);\n        }\n        else {\n            $('#program_name').val(adventures[tabName].default_save_name + ' - ' + window.State.level_title + ' ' + window.State.level);\n            app_1.theGlobalEditor === null || app_1.theGlobalEditor === void 0 ? void 0 : app_1.theGlobalEditor.setValue(adventures[tabName].start_code);\n        }\n        window.State.adventure_name = tabName === 'level' ? undefined : tabName;\n        app_1.theGlobalEditor === null || app_1.theGlobalEditor === void 0 ? void 0 : app_1.theGlobalEditor.clearSelection();\n        // If user wants to override the unsaved program, reset unsaved_changes\n        window.State.unsaved_changes = false;\n    }\n    $('*[data-tab]').click(function (e) {\n        var tab = $(e.target);\n        var tabName = tab.data('tab');\n        e.preventDefault();\n        // If there are unsaved changes, we warn the user before changing tabs.\n        if (window.State.unsaved_changes)\n            modal_1.modal.confirm(auth_1.auth.texts['unsaved_changes'], function () { return switchToTab(tabName); });\n        else\n            switchToTab(tabName);\n        // Do a 'replaceState' to add a '#anchor' to the URL\n        var hashFragment = tabName !== 'level' ? tabName : '';\n        if (window.history) {\n            window.history.replaceState(null, '', '#' + hashFragment);\n        }\n    });\n    // If we're opening an adventure from the beginning (either through a link to /hedy/adventures or through a saved program for an adventure), we click on the relevant tab.\n    // We click on `level` to load a program associated with level, if any.\n    if (window.State && window.State.adventure_name) {\n        switchToTab(window.State.adventure_name);\n    }\n    else if (window.location.hash) {\n        // If we have an '#anchor' in the URL, switch to that tab\n        var hashFragment = window.location.hash.replace(/^#/, '');\n        if (hashFragment) {\n            switchToTab(hashFragment);\n        }\n    }\n});\n", "\"use strict\";\n/**\n * Count newlines and also estimate how the text will be line wrapped\n */\nfunction estimateLineCount(s) {\n    var ESTIMATED_LINE_LENGTH = 80;\n    var lines = s.split('\\n');\n    var wrappedLines = lines.map(function (x) { return Math.floor(x.length / ESTIMATED_LINE_LENGTH); });\n    return sum(wrappedLines) + lines.length;\n}\nfunction sum(xs) {\n    var ret = 0;\n    for (var _a = 0, xs_1 = xs; _a < xs_1.length; _a++) {\n        var x = xs_1[_a];\n        ret += x;\n    }\n    return ret;\n}\nfunction resizeArea(el) {\n    var lines = Math.max(1, estimateLineCount($(el).val()));\n    var targetHeight = lines * 25 + 4;\n    // Allow for the case where the user made it bigger themselves\n    if ($(el).height() < targetHeight) {\n        $(el).css({ height: targetHeight + \"px\" });\n    }\n}\n$('textarea').each(function (_i, el) { return resizeArea(el); }).on('input', function (e) {\n    var target = $(e.target);\n    if (!target.hasClass('touched')) {\n        target.addClass('touched');\n        // Change the 'data-name=\"xxx\"' attribute into an actual 'name=\"xxx\"' attribute\n        // so that the value is actually submitted via the form.\n        target.attr('name', target.data('name'));\n        recordChangeToForm(target.closest('form'));\n    }\n    resizeArea(target);\n});\nvar FORM_MAP = new Map();\nfunction recordChangeToForm(form) {\n    var fileName = form.data('file');\n    var formData = FORM_MAP.get(fileName);\n    if (!formData) {\n        var button = $('button[data-file=\"' + fileName + '\"]');\n        formData = {\n            button: button,\n            changes: 0,\n        };\n        FORM_MAP.set(fileName, formData);\n    }\n    formData.changes += 1;\n    formData.button.text(fileName + \" (\" + formData.changes + \")\");\n}\n$('button[data-file]').click(function (e) {\n    var fileName = $(e.target).data('file');\n    var form = $('form[data-file=\"' + fileName + '\"]');\n    form.submit();\n});\n", "\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__exportStar(require(\"./modal\"), exports);\n__exportStar(require(\"./app\"), exports);\n__exportStar(require(\"./auth\"), exports);\nrequire(\"./syntaxModesRules\");\nrequire(\"./tabs\");\nrequire(\"./translating\");\n__exportStar(require(\"./teachers\"), exports);\n"],
  "mappings": "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",
  "names": []
}
