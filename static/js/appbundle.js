var hedyApp=(()=>{var X=Object.defineProperty;var Se=t=>X(t,"__esModule",{value:!0});var be=(t,e)=>{Se(t);for(var n in e)X(t,n,{get:e[n],enumerable:!0})};var it={};be(it,{ScrollOutputToBottom:()=>We,auth:()=>r,change_language:()=>tt,confetti_cannon:()=>Ke,copy_to_clipboard:()=>he,create_class:()=>Me,delete_class:()=>Oe,delete_program:()=>De,error:()=>f,fix_code:()=>Z,get_trimmed_code:()=>G,join_class:()=>H,load_profile:()=>et,load_quiz:()=>Ve,modal:()=>d,modalStepOne:()=>we,prompt_unsaved:()=>He,pushAchievement:()=>L,remove_student:()=>Re,rename_class:()=>Ae,reset_level_preferences:()=>Le,runit:()=>W,save_level_settings:()=>Ne,saveit:()=>Y,saveitP:()=>V,select_profile_image:()=>nt,share_program:()=>Ge,showAchievements:()=>T,show_doc_section:()=>Ce,submit_program:()=>Be,success:()=>P,theGlobalEditor:()=>b,theModalEditor:()=>ue,toggle_developers_mode:()=>Xe,tryPaletteCode:()=>Fe,viewProgramLink:()=>me});var ee=class{constructor(){$("#modal-confirm-button").on("click",()=>this.hide()),$("#modal-no-button").on("click",()=>this.hide()),$("#modal-cancel-button").on("click",()=>this.hide())}show(){$("#modal-mask").show(),$("#modal-content").show(),window.scrollTo(0,0)}hide(){$("#modal-mask").hide(),$("#modal-content").hide(),$("#modal-alert").hide(),$("#modal-prompt").hide(),$("#modal-confirm").hide()}alert(e,n,a=""){a!=""?($("#modal-alert-title").html(a),$("#modal-alert-title").removeClass("hidden")):($("#modal-alert-title").html(""),$("#modal-alert-title").addClass("hidden")),$("#modal-alert-text").html(e),this.show(),$("#modal-alert").show(),n&&setTimeout(()=>this.hide(),n)}confirm(e,n){$("#modal-confirm-text").text(e),this.show(),$("#modal-confirm").show(),$("#modal-yes-button").off("click").on("click",()=>{this.hide(),n()})}prompt(e,n,a){$("#modal-prompt-text").text(e),this.show(),$("#modal-prompt").show(),n&&$("#modal-prompt-input").val(n),$("#modal-ok-button").off("click").on("click",()=>{this.hide();let i=$("#modal-prompt-input").val();typeof i=="string"&&a(i)})}},m,P={setEditor(t){m=t},hide:function(){$("#okbox").hide(),m==null||m.resize()},showWarning(t,e){$("#okbox .caption").text(t),$("#okbox .details").text(e),$("#okbox").show(),m==null||m.resize()},show(t){$("#okbox .caption").text(t),$("#okbox").show(),m==null||m.resize(),setTimeout(function(){$("#okbox").hide(),m==null||m.resize()},3e3)}},f={setEditor(t){m=t},hide(){$("#errorbox").hide(),$("#warningbox").hide(),m==null||m.resize()},showWarning(t,e){$("#warningbox .caption").text(t),$("#warningbox .details").text(e),$("#warningbox").show(),m==null||m.resize()},show(t,e){$("#errorbox .caption").text(t),$("#errorbox .details").html(e),$("#errorbox").show(),m==null||m.resize()}},d=new ee;var D={_PRINT:"print",_ASK:"ask",_ECHO:"echo",_FORWARD:"forward",_TURN:"turn",_IS:"is",_SLEEP:"sleep",_ADD_LIST:"add",_TO_LIST:"to",_REMOVE:"remove",_FROM:"from",_AT:"at",_RANDOM:"random",_IN:"in",_IF:"if",_ELSE:"else",_AND:"and",_REPEAT:"repeat",_TIMES:"times",_FOR:"for",_RANGE:"range",_TO:"to",_STEP:"step",_ELIF:"elif",_INPUT:"input",_OR:"or",_WHILE:"while",_LENGTH:"length"};var te={_PRINT:"(?:imprimir|print)",_ASK:"(?:preguntar|ask)",_ECHO:"(?:eco|echo)",_FORWARD:"(?:adelante|forward)",_TURN:"(?:girar|turn)",_IS:"(?:es|is)",_SLEEP:"(?:dormir|sleep)",_ADD_LIST:"(?:a\xF1adir|add)",_TO_LIST:"(?:a|to)",_REMOVE:"(?:borrar|remove)",_FROM:"(?:de|from)",_AT:"(?:en|at)",_RANDOM:"(?:aleatorio|random)",_IN:"(?:en|in)",_IF:"(?:si|if)",_ELSE:"(?:sino|else)",_AND:"(?:y|and)",_REPEAT:"(?:repetir|repeat)",_TIMES:"(?:veces|times)",_FOR:"(?:para|for)",_RANGE:"(?:rango|range)",_TO:"(?:a|to)",_STEP:"(?:paso|step)",_ELIF:"(?:sinosi|elif)",_INPUT:"(?:entrada|input)",_OR:"(?:o|or)",_WHILE:"(?:mientrasw|while)",_LENGTH:"(?:longitud|length)"};var ne={_PRINT:"(?:print|print)",_ASK:"(?:vraag|ask)",_ECHO:"(?:echo|echo)",_FORWARD:"(?:vooruit|forward)",_TURN:"(?:draai|turn)",_IS:"(?:is|is)",_SLEEP:"(?:slaap|sleep)",_ADD_LIST:"(?:voeg|add)",_TO_LIST:"(?:toe aan|to)",_REMOVE:"(?:verwijder|remove)",_FROM:"(?:uit|from)",_AT:"(?:op|at)",_RANDOM:"(?:willekeurig|random)",_IN:"(?:in|in)",_IF:"(?:als|if)",_ELSE:"(?:anders|else)",_AND:"(?:en|and)",_REPEAT:"(?:herhaal|repeat)",_TIMES:"(?:keer|times)",_FOR:"(?:voor|for)",_RANGE:"(?:bereik|range)",_TO:"(?:tot|to)",_STEP:"(?:stap|step)",_ELIF:"(?:alsanders|elif)",_INPUT:"(?:invoer|input)",_OR:"(?:of|or)",_WHILE:"(?:zolang|while)",_LENGTH:"(?:lengte|length)"};window.State||(window.State={});var $e=!1,u;if($e)switch(window.State.lang){case"nl":u=ne;break;case"es":u=te;break;default:u=D;break}else u=D;function h(){return{gobble:[{regex:".*",token:"text",next:"start"}],expression_eol:Ee([{regex:"'[^']*'",token:"constant.character"},{regex:u._AT+" "+u._RANDOM,token:"keyword"},{regex:"$",token:"text"}])}}var Te=[{name:"level1",rules:_(h(),M("gobble"),B(),g("start",{regex:C(u._ECHO),token:"keyword",next:"gobble"}),g("start",{regex:C(u._ASK),token:"keyword",next:"gobble"}))},{name:"level2",rules:_(h(),M("expression_eol"),O("gobble"),w("gobble"),B(),ke())},{name:"level3",rules:_(h(),B(),M("expression_eol"),O(),w())},{name:"level4",rules:_(h(),M(),O(),w(),J(),y())},{name:"level5",rules:_(h(),M(),O(),w(),J(),y(),U())},{name:"level6",rules:_(h(),M(),O(),w(),J(),y(),U(),v())},{name:"level7",rules:_(h(),M(),O(),w(),S(),y(),U(),v())},{name:"level8",rules:_(h(),M(),O(),w(),S(),y(),v(),re())},{name:"level9and10",rules:_(h(),M(),O(),w(),S(),y(),v(),ae(),re())},{name:"level11",rules:_(h(),M(),O(),w(),S(),y(),v(),ae())},{name:"level12",rules:_(h(),E(),k(),w(),S(),y(),v(),I())},{name:"level11",rules:_(h(),E(),k(),w(),S(),y(),v(),I())},{name:"level13",rules:_(h(),E(),k(),w(),S(),y(),v(),I())},{name:"level14",rules:_(h(),E(),k(),w(),S(),y(),v(),I())},{name:"level15",rules:_(h(),E(),k(),w(),S(),y(),v(),I())},{name:"level16",rules:_(h(),E(),k(),w(),S(),y(),v(),I())},{name:"level17",rules:_(h(),E(),k(),w(),S(),y(),v(),I())},{name:"level18and19",rules:_(h(),E(),k(),w(),S(),y(),v(),I())},{name:"level20",rules:_(h(),E(),k(),w(),S(),y(),v(),I())},{name:"level21",rules:_(h(),E(),k(),w(),S(),y(),v(),I())},{name:"level22",rules:_(h(),E(),k(),w(),S(),y(),v(),I())},{name:"level23",rules:_(h(),E(),k(),w(),S(),y(),v(),I())}];function Ee(t){let e=[];for(let n of t)n.regex&&e.push({regex:n.regex+"$",token:n.token,next:"start"}),e.push(n);return e}function g(t,e){return n=>{Array.isArray(t)||(t=[t]);for(let a of t)n[a]||(n[a]=[]),Array.isArray(e)?n[a].push(...e):n[a].push(e);return n}}function j(...t){return e=>{for(let n of t)e=n(e);return e}}function _(t,...e){return j(...e)(t)}function M(t){return g("start",{regex:C(u._PRINT),token:"keyword",next:t!=null?t:"start"})}function O(t){return g("start",{regex:"(\\w+)( "+u._IS+" "+u._ASK+")",token:["text","keyword"],next:t!=null?t:"expression_eol"})}function w(t){return g("start",{regex:"(\\w+)( "+u._IS+" )",token:["text","keyword"],next:t!=null?t:"expression_eol"})}function E(){return g("start",{regex:"("+u._PRINT+")(\\()",token:["keyword","paren.lparen"],next:"start"})}function B(){return j(g("start",{regex:u._TURN+" (left|right)?",token:"keyword",next:"start"}),g("start",{regex:u._FORWARD,token:"keyword",next:"start"}))}function ke(){return g("start",{regex:u._SLEEP,token:"keyword",next:"start"})}function k(){return g("start",{regex:"(\\w+)( "+u._IS+" "+u._INPUT+")(\\()",token:["text","keyword","paren.lparen"],next:"start"})}function y(){return j(g("start",{regex:"'[^']*'",token:"constant.character"}),g("start",{regex:u._AT+u._RANDOM,token:"keyword"}),g("start",{regex:"[, ]+",token:"punctuation.operator"}))}function J(){return j(g("start",{regex:C(u._IF),token:"keyword",next:"condition"}),g("start",{regex:C(u._ELSE),token:"keyword"}),g("condition",{regex:C("(("+u._IS+")|("+u._IN+"))"),token:"keyword",next:"start"}))}function S(){return j(g("start",{regex:C(u._IF),token:"keyword",next:"condition"}),g("start",{regex:"\\b"+u._ELSE+"\\b",token:"keyword"}),g("condition",{regex:C("(("+u._IS+")|("+u._IN+"))"),token:"keyword",next:"start"}))}function v(){return g(["start","expression_eol"],[{regex:" \\* ",token:"keyword"},{regex:" \\+ ",token:"keyword"},{regex:" \\- ",token:"keyword"}])}function U(){return g("start",{regex:"("+u._REPEAT+")( \\w+ )("+u._TIMES+")",token:["keyword","text","keyword"]})}function re(){return g("start",{regex:"("+u._FOR+" )(\\w+)( "+u._IN+" )(\\w+)",token:["keyword","text","keyword","text"]})}function ae(){return g("start",{regex:"("+u._FOR+" )(\\w+)( "+u._IN+" "+u._RANGE+" )(\\w+)( to )(\\w+)",token:["keyword","text","keyword","text","keyword","text"]})}function I(){return g("start",{regex:"("+u._FOR+" )(\\w+)( "+u._IN+" "+u._RANGE+")(\\()([\\s\\w]+)(,)([\\s\\w]+)(\\))",token:["keyword","text","keyword","paren.lparen","text","punctuation.operator","text","paren.rparen"]})}function C(t){return"\\b"+t+" "}function Ie(t){for(let e of Object.values(t))for(let n of e)n.regex&&!n._loosened&&(n.regex=n.regex.replace(/ /g," +"),n._loosened=!0);return t}if(window.define)for(let t of Te)define("ace/mode/"+t.name,[],function(e,n,a){var i=e("ace/lib/oop"),l=e("ace/mode/text").Mode,o=e("ace/mode/text_highlight_rules").TextHighlightRules;function s(){this.$rules=Ie(t.rules),this.normalizeRules()}i.inherits(s,o);function c(){this.HighlightRules=s}i.inherits(c,l),n.Mode=c});function Me(){d.prompt(r.texts.class_name_prompt,"",function(t){if(!t){d.alert(r.texts.class_name_empty);return}$.ajax({type:"POST",url:"/class",data:JSON.stringify({name:t}),contentType:"application/json",dataType:"json"}).done(function(e){e.achievement?T(e.achievement,!1,"/for-teachers/customize-class/"+e.id):window.location.pathname="/for-teachers/customize-class/"+e.id}).fail(function(e){if(e.responseText=="duplicate"){d.alert(r.texts.class_name_duplicate);return}console.error(e),f.show(ErrorMessages.Connection_error,JSON.stringify(e))})})}function Ae(t){d.prompt(r.texts.class_name_prompt,"",function(e){if(!e){d.alert(r.texts.class_name_empty);return}$.ajax({type:"PUT",url:"/class/"+t,data:JSON.stringify({name:e}),contentType:"application/json",dataType:"json"}).done(function(n){n.achievement?T(n.achievement,!0,""):location.reload()}).fail(function(n){if(n.responseText=="duplicate"){d.alert(r.texts.class_name_duplicate);return}console.error(n),f.show(ErrorMessages.Connection_error,JSON.stringify(n))})})}function Oe(t){d.confirm(r.texts.delete_class_prompt,function(){$.ajax({type:"DELETE",url:"/class/"+t,contentType:"application/json",dataType:"json"}).done(function(e){e.achievement?T(e.achievement,!1,"/for-teachers"):window.location.pathname="/for-teachers"}).fail(function(e){console.error(e),f.show(ErrorMessages.Connection_error,JSON.stringify(e))})})}function H(t,e){if(!r.profile)return d.confirm(r.texts.join_prompt,function(){localStorage.setItem("hedy-join",JSON.stringify({id:t,name:e})),window.location.pathname="/login"});$.ajax({type:"POST",url:"/class/join",contentType:"application/json",data:JSON.stringify({id:t,name:e}),dataType:"json"}).done(function(n){n.achievement?T(n.achievement,!1,"/programs"):window.location.pathname="/programs"}).fail(function(n){console.error(n),f.show(ErrorMessages.Connection_error,JSON.stringify(n))})}function Re(t,e,n){let a;n?a=r.texts.self_removal_prompt:a=r.texts.remove_student_prompt,d.confirm(a,function(){$.ajax({type:"DELETE",url:"/class/"+t+"/student/"+e,contentType:"application/json",dataType:"json"}).done(function(i){i.achievement?T(i.achievement,!0,""):location.reload()}).fail(function(i){console.error(i),f.show(ErrorMessages.Connection_error,JSON.stringify(i))})})}function Ce(t){$(".section-button").each(function(){$(this).hasClass("blue-btn")&&($(this).removeClass("blue-btn"),$(this).addClass("green-btn"))}),$("#section-"+t).is(":visible")?($("#button-"+t).removeClass("blue-btn"),$("#button-"+t).addClass("green-btn"),$(".section").hide()):($("#button-"+t).removeClass("green-btn"),$("#button-"+t).addClass("blue-btn"),$(".section").hide(),$("#section-"+t).toggle())}function Ne(t,e){let n=[];$("#adventures_overview li").each(function(){$(this).is(":visible")&&$(this).find(":input").prop("checked")&&n.push(this.getAttribute("id"))});let a=!!$(`#hide_level${e}`).prop("checked"),i=!!$(`#hide_level${e-1}`).prop("checked"),l=!!$(`#example_programs${e}`).prop("checked"),o=!!$(`#hide_level${e-1}`).prop("checked");$.ajax({type:"PUT",url:"/customize-class/"+t,data:JSON.stringify({adventures:n,example_programs:l,hide_level:a,hide_prev_level:o,hide_next_level:i,level:e}),contentType:"application/json",dataType:"json"}).done(function(s){s.achievement?T(s.achievement,!0,""):location.reload()}).fail(function(s){console.error(s),f.show(ErrorMessages.Connection_error,JSON.stringify(s))})}function Le(t){$("#adventures_overview li").each(function(){$(this).is(":visible")&&$(this).find(":input").prop("checked",!0)}),$("#example_programs"+t).prop("checked",!0),$("#hide_level"+t).prop("checked",!1)}var oe={AF:"Afghanistan",AX:"\xC5land Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia, Plurinational State of",BQ:"Bonaire, Sint Eustatius and Saba",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo",CD:"Congo, the Democratic Republic of the",CK:"Cook Islands",CR:"Costa Rica",CI:"C\xF4te d'Ivoire",HR:"Croatia",CU:"Cuba",CW:"Cura\xE7ao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Territories",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and McDonald Islands",VA:"Holy See (Vatican City State)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic of",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People's Democratic Republic",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia, the Former Yugoslav Republic of",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, Federated States of",MD:"Moldova, Republic of",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestine, State of",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"R\xE9union",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint Barth\xE9lemy",SH:"Saint Helena, Ascension and Tristan da Cunha",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",MF:"Saint Martin (French part)",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Sint Maarten (Dutch part)",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and the South Sandwich Islands",SS:"South Sudan",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard and Jan Mayen",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan, Province of China",TJ:"Tajikistan",TZ:"Tanzania, United Republic of",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Minor Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela, Bolivarian Republic of",VN:"Viet Nam",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"};if(!window.AuthMessages)throw new Error('On a page where you load this JavaScript, you must also load the "client_messages.js" script');var r={texts:AuthMessages,profile:void 0,reset:void 0,entityify:function(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},emailRegex:/^(([a-zA-Z0-9_+\.\-]+)@([\da-zA-Z\.\-]+)\.([a-zA-Z\.]{2,6})\s*)$/,redirect:function(t){t="/"+t,window.location.pathname=t},logout:function(){$.ajax({type:"POST",url:"/auth/logout"}).done(function(){r.redirect("login")})},destroy:function(){d.confirm(r.texts.are_you_sure,function(){$.ajax({type:"POST",url:"/auth/destroy"}).done(function(){r.redirect("")})})},error:function(t,e,n){$(n||"#error").html(t),$(n||"#error").css("display","block"),e&&$("#"+e).css("border","solid 1px red")},clear_error:function(t){$(t||"#error").html(""),$(t||"#error").css("display","none"),$("form *").css("border","")},success:function(t,e){$("#error").css("display","none"),$(e||"#success").html(t),$(e||"#success").css("display","block")},submit:function(t){var n,a,i,l;let e={};if($("form.js-validated-form *").map(function(o,s){s.id&&(e[s.id]=s.value)}),t==="signup"){if(!e.username)return r.error(r.texts.please_username,"username");if(e.username=e.username.trim(),e.username.length<3)return r.error(r.texts.username_three,"username");if(e.username.match(/:|@/))return r.error(r.texts.username_special,"username");if(!((n=e.email)==null?void 0:n.match(r.emailRegex)))return r.error(r.texts.valid_email,"email");if(e.email!==e.mail_repeat)return r.error(r.texts.repeat_match_email,"mail_repeat");if(!e.language)return r.error(r.texts.please_language,"language");if(!e.password)return r.error(r.texts.please_password,"password");if(e.password.length<6)return r.error(r.texts.password_six,"password");if(e.password!==e.password_repeat)return r.error(r.texts.repeat_match_password,"password_repeat");if(e.birth_year&&!le(e.birth_year))return r.error(r.texts.valid_year+new Date().getFullYear(),"birth_year");let o={username:e.username,email:e.email,password:e.password,language:e.language,birth_year:e.birth_year?parseInt(e.birth_year):void 0,country:e.country?e.country:void 0,gender:e.gender?e.gender:void 0,subscribe:$("#subscribe").prop("checked"),is_teacher:$("#is_teacher").prop("checked"),prog_experience:$("input[name=has_experience]:checked").val(),experience_languages:$("#languages").is(":visible")?$("input[name=languages]").filter(":checked").map((s,c)=>$(c).val()).get():void 0};$.ajax({type:"POST",url:"/auth/signup",data:JSON.stringify(o),contentType:"application/json; charset=utf-8"}).done(function(){r.success(r.texts.signup_success),r.profile={session_expires_at:Date.now()+1e3*60*60*24},ie()}).fail(function(s){if(s.status>=500)return r.error(r.texts.server_error);let c=s.responseText||"";c.match("email")?r.error(r.texts.exists_email):c.match("username")?r.error(r.texts.exists_username):r.error(r.texts.ajax_error)})}if(t==="login"){if(!e.username)return r.error(r.texts.please_username_email,"username");if(!e.password)return r.error(r.texts.please_password,"password");r.clear_error(),$.ajax({type:"POST",url:"/auth/login",data:JSON.stringify({username:e.username,password:e.password}),contentType:"application/json; charset=utf-8"}).done(function(){r.profile={session_expires_at:Date.now()+1e3*60*60*24},ie()}).fail(function(o){var s;if(o.status>=500)return r.error(r.texts.server_error);o.status===403?(r.error(r.texts.invalid_username_password+" "+r.texts.no_account+` &nbsp;<button class="green-btn" onclick="auth.redirect ('signup')">`+r.texts.create_account+"</button>"),$("#create-account").hide(),localStorage.setItem("hedy-login-username",(s=e.username)!=null?s:"")):r.error(r.texts.ajax_error)})}if(t==="profile"){if(!((a=e.email)!=null?a:"").match(r.emailRegex))return r.error(r.texts.valid_email,"email");if(e.birth_year&&!le(e.birth_year))return r.error(r.texts.valid_year+new Date().getFullYear(),"birth_year");let o={email:e.email,birth_year:e.birth_year?parseInt(e.birth_year):void 0,country:e.country?e.country:void 0,gender:e.gender?e.gender:void 0,language:e.language,prog_experience:$("input[name=has_experience]:checked").val(),experience_languages:$("#languages").is(":visible")?$("input[name=languages]").filter(":checked").map((s,c)=>$(c).val()).get():void 0};console.log(o),r.clear_error(),$.ajax({type:"POST",url:"/profile",data:JSON.stringify(o),contentType:"application/json; charset=utf-8"}).done(function(){r.success(r.texts.profile_updated),setTimeout(function(){location.reload()},500)}).fail(function(s){if(s.status>=500)return r.error(r.texts.server_error);r.error(r.texts.ajax_error+" "+s.responseText)})}if(t==="change_password"){if(!e.password)return r.error(r.texts.please_password,"password","#error-password");if(e.password.length<6)return r.error(r.texts.password_six,"password","#error-password");if(e.password!==e.password_repeat)return r.error(r.texts.repeat_match,"password_repeat","#error-password");let o={old_password:e.old_password,new_password:e.password};r.clear_error("#error-password"),$.ajax({type:"POST",url:"/auth/change_password",data:JSON.stringify(o),contentType:"application/json; charset=utf-8"}).done(function(){r.success(r.texts.password_updated,"#success-password"),$("#old_password").val(""),$("#password").val(""),$("#password_repeat").val("")}).fail(function(s){if(s.status>=500)return r.error(r.texts.server_error);s.status===403?r.error(r.texts.invalid_password,null,"#error-password"):r.error(r.texts.ajax_error,null,"#error-password")})}if(t==="recover"){if(!e.username)return r.error(r.texts.please_username,"username");let o={username:e.username};r.clear_error(),$.ajax({type:"POST",url:"/auth/recover",data:JSON.stringify(o),contentType:"application/json; charset=utf-8"}).done(function(){r.success(r.texts.sent_password_recovery),$("#username").val("")}).fail(function(s){if(s.status>=500)return r.error(r.texts.server_error);s.status===403?r.error(r.texts.invalid_username):r.error(r.texts.ajax_error)})}if(t==="reset"){if(!e.password)return r.error(r.texts.please_password,"password");if(e.password.length<6)return r.error(r.texts.password_six,"password");if(e.password!==e.password_repeat)return r.error(r.texts.repeat_match,"password_repeat");let o={username:(i=r.reset)==null?void 0:i.username,token:(l=r.reset)==null?void 0:l.token,password:e.password};r.clear_error(),$.ajax({type:"POST",url:"/auth/reset",data:JSON.stringify(o),contentType:"application/json; charset=utf-8"}).done(function(){r.success(r.texts.password_resetted),$("#password").val(""),$("#password_repeat").val(""),delete r.reset,r.redirect("login")}).fail(function(s){if(s.status>=500)return r.error(r.texts.server_error);s.status===403?r.error(r.texts.invalid_reset_link):r.error(r.texts.ajax_error)})}if(t==="public_profile"){let o={image:$("#profile_picture").val(),personal_text:$("#personal_text").val(),favourite_program:$("#favourite_program").val()};console.log(o),$.ajax({type:"POST",url:"/auth/public_profile",data:JSON.stringify(o),contentType:"application/json; charset=utf-8"}).done(function(){r.success(r.texts.profile_updated),setTimeout(function(){location.reload()},500)}).fail(function(s){console.log(s)})}},markAsTeacher:function(t,e){$.ajax({type:"POST",url:"/admin/markAsTeacher",data:JSON.stringify({username:t,is_teacher:e}),contentType:"application/json; charset=utf-8"}).done(function(){d.alert(["User",t,"successfully",e?"marked":"unmarked","as teacher"].join(" "),4e3),location.reload()}).fail(function(n){console.log(n),d.alert(["Error when",e?"marking":"unmarking","user",t,"as teacher"].join(" "))})},changeUserEmail:function(t,e){d.prompt("Please enter the corrected email",e,function(n){if(n!==e){if(!n.match(r.emailRegex))return d.alert("Please enter a valid email.");$.ajax({type:"POST",url:"/admin/changeUserEmail",data:JSON.stringify({username:t,email:n}),contentType:"application/json; charset=utf-8"}).done(function(){d.alert(["Successfully changed the email for User",t,"to",n].join(" ")),location.reload()}).fail(function(a){console.log(a),d.alert(["Error when changing the email for User",t].join(" "))})}})}};if($("#country")){let t=$("#country").html();Object.keys(oe).map(function(e){t+='<option value="'+e+'">'+oe[e]+"</option>"}),$("#country").html(t)}$(".auth input").get().map(function(t){t.addEventListener("input",()=>r.clear_error())});$.ajax({type:"GET",url:"/profile"}).done(function(t){["/signup","/login"].indexOf(window.location.pathname)!==-1&&r.redirect("my-profile"),r.profile=t});if(window.location.pathname==="/reset"){let t=window.location.search.slice(1).split("&"),e={};t.map(function(n){let a=n.split("=");e[a[0]]=decodeURIComponent(a[1])}),!e.username||!e.token?r.redirect("recover"):r.reset=e}if(window.location.pathname==="/signup"){let t=localStorage.getItem("hedy-login-username");t&&(localStorage.removeItem("hedy-login-username"),t.match("@")?$("#email").val(t):$("#username").val(t));let e=localStorage.getItem("hedy-save-redirect");e&&e.includes("invite")&&$("#is_teacher_div").hide()}$("#email, #mail_repeat").on("cut copy paste",function(t){return t.preventDefault(),!1});async function ie(){let t=localStorage.getItem("hedy-first-save"),e=t?JSON.parse(t):void 0;if(e){await V(e[0],e[1],e[2],e[3]),localStorage.removeItem("hedy-first-save");let l=se();if(l)return r.redirect(l)}let n=localStorage.getItem("hedy-join"),a=n?JSON.parse(n):void 0;if(a)return localStorage.removeItem("hedy-join"),H(a.link,a.name);let i=se();if(i)return r.redirect(i);r.redirect("programs")}function se(){let t=localStorage.getItem("hedy-save-redirect");return t&&localStorage.removeItem("hedy-save-redirect"),t}function le(t){let e=parseInt(t);return!(!e||e<1900||e>new Date().getFullYear())}var b,ue;(function(){window.State||(window.State={}),t($("#editor"));for(let n of $(".turn-pre-into-ace pre").get()){$(n).addClass("text-lg rounded");let a=e(n,!0);if(a.setOptions({maxLines:1/0}),a.setOptions({minLines:2}),a.setValue(a.getValue().replace(/\n+$/,""),-1),$(n).hasClass("no-copy-button")){if($(n).attr("id")){let i=String($(n).attr("id")),l=K(parseInt(i));a.session.setMode(l)}}else{let i=$("<div>").css({position:"absolute",top:5,right:5,width:"auto"}).appendTo(n);$("<button>").attr("title",UiMessages.try_button).css({fontFamily:"sans-serif"}).addClass("green-btn").text("\u21E5").appendTo(i).click(function(){b==null||b.setValue(a.getValue()+`
`)})}}function t(n){if(!n.length)return;var a=e(n.get(0),n.data("readonly"));b=a,f.setEditor(a),window.Range=ace.require("ace/range").Range;let i=window.sessionStorage;if(i){let o=n.data("lskey"),s=n.data("loaded-program"),c=i.getItem(o);s!=="True"&&c&&a.setValue(c,1),a.on("blur",function(x){i.setItem(o,a.getValue())}),a.on("change",function(){$("#inline-modal").is(":visible")&&$("#inline-modal").hide(),window.State.disable_run=!1,$("#runit").css("background-color",""),window.State.unsaved_changes=!0,ce(a)})}window.onbeforeunload=()=>{if(window.State.unsaved_changes&&!window.State.no_unload_prompt)return r.texts.unsaved_changes};let l;return window.addEventListener("keydown",function(o){let s=o.keyCode;if(s===18){l=!0;return}if(s===13&&l){if(!window.State.level||!window.State.lang)throw new Error("Oh no");W(window.State.level,window.State.lang,function(){$("#output").focus()})}s===37&&document.activeElement===document.getElementById("output")&&(a.focus(),a.navigateFileEnd())}),window.addEventListener("keyup",function(o){if(o.keyCode===18){l=!1;return}}),a}function e(n,a){let i=ace.edit(n);i.setTheme("ace/theme/monokai"),a&&i.setOptions({readOnly:!0,showGutter:!1,showPrintMargin:!1,highlightActiveLine:!1});var l=1;if(l==1&&window.State.level){let o=K(parseInt(window.State.level));i.session.setMode(o)}return i}})();function K(t){return{"9":"ace/mode/level9and10","10":"ace/mode/level9and10","18":"ace/mode/level18and19","19":"ace/mode/level18and19"}[t]||"ace/mode/level"+t}function z(){return!r.profile||r.profile.session_expires_at>Date.now()?!1:(location.reload(),!0)}function ce(t){t.session.clearAnnotations();for(let e in t.session.getMarkers(!1))t.session.removeMarker(e)}function W(t,e,n){if(window.State.disable_run)return d.alert(r.texts.answer_question);if(z())return;$("#output").empty(),$("#turtlecanvas").empty(),f.hide(),P.hide();try{t=t.toString();var i=b,l=G();ce(i),pe(),console.log(`Original program:
`,l),$.ajax({type:"POST",url:"/parse",data:JSON.stringify({level:t,code:l,lang:e,read_aloud:!!$("#speak_dropdown").val(),adventure_name:window.State.adventure_name}),contentType:"application/json",dataType:"json"}).done(function(o){if(console.log("Response",o),o.Warning&&(Z(t,e),de(t),f.showWarning(ErrorMessages.Transpile_warning,o.Warning)),o.achievements&&T(o.achievements,!1,""),o.Error){f.show(ErrorMessages.Transpile_error,o.Error),o.Location&&o.Location[0]!="?"&&(Z(t,e),je(i,o.Location[0],o.Location[1]));return}Ue(o.Code,o.has_turtle,o.Warning,n).catch(function(s){console.log(s),f.show(ErrorMessages.Execute_error,s.message),Je(t,l,s.message)})}).fail(function(o){console.error(o),o.readyState<4?f.show(ErrorMessages.Connection_error,ErrorMessages.CheckInternet):f.show(ErrorMessages.Other_error,ErrorMessages.ServerError)})}catch(o){console.error(o),f.show(ErrorMessages.Other_error,o.message)}}function de(t){let e=parseInt(t);if(e<=2){let n=document.getElementById("repair_button");n.style.visibility="visible",n.onclick=function(a){a.preventDefault(),we(e)}}}function L(t){$.ajax({type:"POST",url:"/achievements",data:JSON.stringify({achievement:t}),contentType:"application/json",dataType:"json"}).done(function(e){e.achievements&&(console.log(e.achievements),T(e.achievements,!1,""))})}function T(t,e,n){fe(t,0),e&&setTimeout(function(){location.reload()},t.length*6e3),n&&setTimeout(function(){window.location.pathname=n},t.length*6e3)}async function fe(t,e){await Pe(t[e]),e<t.length-1&&await fe(t,e+1)}function Pe(t){return new Promise(e=>{$("#achievement_reached_title").text('"'+t[0]+'"'),$("#achievement_reached_text").text(t[1]),$("#achievement_pop-up").fadeIn(1e3,function(){setTimeout(function(){$("#achievement_pop-up").fadeOut(1e3)},4e3)}),setTimeout(()=>{e()},6e3)})}function pe(){let t=document.getElementById("repair_button");t.style.visibility="hidden"}function Z(t,e){if(window.State.disable_run)return d.alert(r.texts.answer_question);if(!z())try{t=t.toString();var n=G();$.ajax({type:"POST",url:"/fix-code",data:JSON.stringify({level:t,code:n,lang:e,read_aloud:!!$("#speak_dropdown").val(),adventure_name:window.State.adventure_name}),contentType:"application/json",dataType:"json"}).done(function(a){a.FixedCode&&(sessionStorage.setItem("fixed_level_{lvl}__code".replace("{lvl}",t),a.FixedCode),de(t))}).fail(function(a){console.error(a),a.readyState<4?f.show(ErrorMessages.Connection_error,ErrorMessages.CheckInternet):f.show(ErrorMessages.Other_error,ErrorMessages.ServerError)})}catch(a){console.error(a),f.show(ErrorMessages.Other_error,a.message)}}function je(t,e,n,a=1){if(t.session.setAnnotations([{row:e-1,column:(n!=null?n:1)-1,text:"",type:"error"}]),n===void 0){t.session.addMarker(new ace.Range(e-1,1,e-1,2),"editor-error","fullLine",!1);return}t.session.addMarker(new ace.Range(e-1,n-1,e-1,n-1+a),"editor-error","text",!1)}function Fe(t){if(r.profile)if(window.State.examples_left>0)window.State.examples_left=window.State.examples_left-1;else{$("#commands-window").hide(),$("#toggle-button").hide(),d.alert(r.texts.examples_used);return}var e=ace.edit("editor"),n=1;e.setValue(t+`
`,n),window.State.unsaved_changes=!1}function ge(t,e,n,a,i){window.State.unsaved_changes=!1;var l=window.State.adventure_name;Array.isArray(t)&&(l=t[1],t=t[0]),$.ajax({type:"POST",url:"/programs",data:JSON.stringify({level:t,lang:e,name:n,code:a,adventure_name:l}),contentType:"application/json",dataType:"json"}).done(function(o){var s;if(i)return o.Error?i(o):i(null,o);d.alert(r.texts.save_success_detail,4e3),o.achievements&&T(o.achievements,!1,""),$("#program_name").val(o.name),(s=window.State.adventures)==null||s.map(function(c){c.short_name===(l||"level")&&(c.loaded_program={name:o.name,code:a})})}).fail(function(o){console.error(o),f.show(ErrorMessages.Connection_error,JSON.stringify(o)),o.status===403&&(localStorage.setItem("hedy-first-save",JSON.stringify([l?[t,l]:t,e,n,a])),localStorage.setItem("hedy-save-redirect","hedy"),window.location.pathname="/login")})}function Y(t,e,n,a,i){if(f.hide(),P.hide(),!z())try{if(!r.profile)return d.confirm(r.texts.save_prompt,function(){window.State&&window.State.adventure_name&&!Array.isArray(t)&&(t=[t,window.State.adventure_name]),localStorage.setItem("hedy-first-save",JSON.stringify([t,e,n,a])),window.location.pathname="/login"});$.ajax({type:"POST",url:"/programs/duplicate-check",data:JSON.stringify({name:n}),contentType:"application/json",dataType:"json"}).done(function(l){l.duplicate?d.confirm(r.texts.overwrite_warning,function(){ge(t,e,n,a,i),L("double_check")}):ge(t,e,n,a,i)})}catch(l){console.error(l),f.show(ErrorMessages.Other_error,l.message)}}function V(t,e,n,a){return new Promise((i,l)=>{Y(t,e,n,a,(o,s)=>{o?l(o):i(s)})})}function me(t){return window.location.origin+"/hedy/"+t+"/view"}function Ge(t,e,n,a,i){if(!r.profile)return d.alert(r.texts.must_be_logged);var l=function(c){$.ajax({type:"POST",url:"/programs/share",data:JSON.stringify({id:c,public:a}),contentType:"application/json",dataType:"json"}).done(function(x){x.achievement&&T(x.achievement,!1,""),a&&he(me(c),!0),d.alert(a?r.texts.share_success_detail:r.texts.unshare_success_detail,4e3),i&&setTimeout(function(){location.reload()},1e3)}).fail(function(x){console.error(x),f.show(ErrorMessages.Connection_error,JSON.stringify(x))})};if(n!==!0)return l(n);let o=`${$("#program_name").val()}`,s=G();return Y(t,e,o,s,(c,x)=>{if(c&&c.Warning)return f.showWarning(ErrorMessages.Transpile_warning,c.Warning);if(c&&c.Error)return f.show(ErrorMessages.Transpile_error,c.Error);l(x.id)})}function De(t){d.confirm(r.texts.delete_confirm,function(){$.ajax({type:"POST",url:"/programs/delete",data:JSON.stringify({id:t}),contentType:"application/json",dataType:"json"}).done(function(e){e.achievement?T(e.achievement,!0,""):location.reload()}).fail(function(e){console.error(e),f.show(ErrorMessages.Connection_error,JSON.stringify(e))})})}function Be(t,e){if(!r.profile)return d.alert(r.texts.must_be_logged);if(console.log(e),!e)return d.alert(r.texts.must_be_shared);$.ajax({type:"POST",url:"/programs/submit",data:JSON.stringify({id:t}),contentType:"application/json",dataType:"json"}).done(function(n){n.achievements?T(n.achievements,!0,""):location.reload()})}function he(t,e){var l,o;var n=document.createElement("textarea");n.value=t,n.setAttribute("readonly",""),n.style.position="absolute",n.style.left="-9999px",document.body.appendChild(n);let a=document.getSelection(),i=a&&a.rangeCount>0?a.getRangeAt(0):void 0;n.select(),document.execCommand("copy"),document.body.removeChild(n),i&&((l=document.getSelection())==null||l.removeAllRanges(),(o=document.getSelection())==null||o.addRange(i)),e||d.alert(r.texts.copy_clipboard,4e3)}function Je(t,e,n){$.ajax({type:"POST",url:"/report_error",data:JSON.stringify({level:t,code:e,page:window.location.href,client_error:n}),contentType:"application/json",dataType:"json"})}window.onerror=function(e,n,a,i,l){$.ajax({type:"POST",url:"/client_exception",data:JSON.stringify({message:e,source:n,line_number:a,column_number:i,error:l,url:window.location.href,user_agent:navigator.userAgent}),contentType:"application/json",dataType:"json"})};function Ue(t,e,n,a){window.State.programsInExecution||(window.State.programsInExecution=0),window.State.programsInExecution++;let i=$("#output");i.empty(),Sk.pre="output";let l=Sk.TurtleGraphics||(Sk.TurtleGraphics={});return l.target="turtlecanvas",$("#adventures").is(":hidden")?(l.height=600,l.worldHeight=600):(l.height=300,l.worldHeight=300),l.width=400,l.worldWidth=400,e?$("#turtlecanvas").show():$("#turtlecanvas").empty(),Sk.configure({output:c,read:x,inputfun:R,inputfunTakesPrompt:!0,__future__:Sk.python3,timeoutMsg:function(){return L("hedy_hacking"),ErrorMessages.Program_too_long},execLimit:function(){return e?2e4:3e3}()}),Sk.misceval.asyncToPromise(function(){return Sk.importMainWithBody("<stdin>",!1,t,!0)}).then(function(p){console.log("Program executed"),window.State.programsInExecution===1&&$("#output").is(":empty")&&$("#turtlecanvas").is(":empty")&&(L("error_or_empty"),f.showWarning(ErrorMessages.Transpile_warning,ErrorMessages.Empty_output)),window.State.programsInExecution--,n||Ze(),a&&a()}).catch(function(p){console.log(p);let A=o(p)||JSON.stringify(p);throw new Error(A)});function o(p){return p.args&&p.args.v&&p.args.v[0]&&p.args.v[0].v}function s(p,A){$("<span>").text(p).css({color:A}).appendTo(i)}function c(p){window.State.programsInExecution>1||(s(p,"white"),_e(p))}function x(p){if(Sk.builtinFiles===void 0||Sk.builtinFiles.files[p]===void 0)throw"File not found: '"+p+"'";return Sk.builtinFiles.files[p]}function R(p){return Sk.execStart=new Date(new Date().getTime()+1e3*60*60*24*365),$("#turtlecanvas").hide(),new Promise(function(A){window.State.disable_run=!0,$("#runit").css("background-color","gray");let N=$('#inline-modal input[type="text"]');$("#inline-modal .caption").text(p),N.val(""),N.attr("placeholder",p),_e(p),setTimeout(function(){N.focus()},0),$("#inline-modal form").one("submit",function(F){return window.State.disable_run=!1,$("#runit").css("background-color",""),F.preventDefault(),$("#inline-modal").hide(),e&&$("#turtlecanvas").show(),Sk.execStart=new Date,setTimeout(function(){A(N.val()),$("#output").focus()},0),!1}),$("#inline-modal").show()})}}function _e(t){var e=$("#speak_dropdown").val();if(!!e){var n=window.speechSynthesis.getVoices().filter(a=>a.voiceURI===e)[0];if(n){let a=new SpeechSynthesisUtterance(t);a.voice=n,a.rate=.9,speechSynthesis.speak(a)}L("make_some_noise")}}(()=>{if(!window.speechSynthesis||!window.State.lang)return;let t=0,e=setInterval(function(){var i;t+=1;let a=n((i=window.State.lang)!=null?i:"");if(a.length>0){for(let l of a)$("#speak_dropdown").append($("<option>").attr("value",l.voiceURI).text("\u{1F4E3} "+l.name));$("#speak_container").show(),clearInterval(e)}t>=20&&clearInterval(e)},100);function n(a){let i=a.match(/^([a-z]+)/i);if(!i)return[];let l=i[1];return window.speechSynthesis?window.speechSynthesis.getVoices().filter(o=>o.lang.startsWith(l)):[]}})();function He(t){if(window.State.no_unload_prompt=!0,!window.State.unsaved_changes||!r.profile)return t();d.confirm(r.texts.unsaved_changes,t)}function Ve(t,e){$('*[data-tabtarget="end"]').html('<iframe id="quiz-iframe" class="w-full" title="Quiz" src="/quiz/start/'+t+"?lang="+e+'"></iframe>')}function G(){try{ace.require("ace/ext/whitespace").trimTrailingSpace(b.session,!0)}catch(t){console.error(t)}return b==null?void 0:b.getValue()}function Ke(){let t=document.getElementById("confetti");if(t){t.classList.remove("hidden");let e=new JSConfetti({canvas:t});setTimeout(function(){t.classList.add("hidden")},3e3);let n=$("#adventures"),a=$(n).find(".tab-selected").attr("data-tab");if(["turtle","rock","haunted","restaurant","fortune","songs","dice"].includes(a)){let o=ze(a!=null?a:"");e.addConfetti({emojis:o,emojiSize:45,confettiNumber:100})}else e.addConfetti();let l=document.getElementById("confetti-button");l&&l.classList.add("hidden")}}function ze(t){let e=Array.from(ErrorMessages[t]);return e!=null?e:[["\u{1F308}"],["\u26A1\uFE0F"],["\u{1F4A5}"],["\u2728"],["\u{1F4AB}"]]}function We(){return $("#output").animate({scrollTop:$(document).height()},"slow"),!1}function we(t){Ye(t);let e=$("#modal-editor");Qe(e)}function Ze(){pe();var t=ErrorMessages.Transpile_success,e=Math.floor(Math.random()*t.length);P.show(t[e])}function Ye(t){let e=`<div id='modal-editor' data-lskey="level_{level}__code" class="w-full flex-1 text-lg rounded" style='height:200px; width:50vw;'></div>`.replace("{level}",t.toString()),n=ErrorMessages.Program_repair;d.alert(e,0,n)}function qe(t,e){let n=ace.edit(t);n.setTheme("ace/theme/monokai"),e&&n.setOptions({readOnly:!0,showGutter:!1,showPrintMargin:!1,highlightActiveLine:!1});var a=1;if(a==1&&window.State.level){let i=K(parseInt(window.State.level));n.session.setMode(i)}return n}function Qe(t){var i,l;if(!t.length)return;let e=qe(t.get(0),!0);ue=e,f.setEditor(e),setTimeout(function(){},2e3),window.Range=ace.require("ace/range").Range;let n=window.sessionStorage;if(n){let o=t.data("lskey"),s=0,c="";if(n.getItem("fixed_{lvl}".replace("{lvl}",o))){c=(i=n.getItem("fixed_{lvl}".replace("{lvl}",o)))!=null?i:"";let x="";for(let R=0;R<c.length+1;R++)setTimeout(function(){e.setValue(x,s),x+=c[s],s++},150*R)}else c=(l=n.getItem("warning_{lvl}".replace("{lvl}",o)))!=null?l:"",e.setValue(c)}window.onbeforeunload=()=>{if(window.State.unsaved_changes&&!window.State.no_unload_prompt)return r.texts.unsaved_changes};let a;return window.addEventListener("keydown",function(o){let s=o.keyCode;if(s===18){a=!0;return}if(s===13&&a){if(!window.State.level||!window.State.lang)throw new Error("Oh no");W(window.State.level,window.State.lang,function(){$("#output").focus()})}s===37&&document.activeElement===document.getElementById("output")&&(e.focus(),e.navigateFileEnd())}),window.addEventListener("keyup",function(o){if(o.keyCode===18){a=!1;return}}),e}function Xe(t){$("#developers_toggle").is(":checked")?($("#commands-window-total").hide(),$("#adventures").hide(),L("lets_focus")):(t&&$("#commands-window-total").show(),$("#adventures").show()),$("#adventures").is(":hidden")?($("#editor-area").removeClass("mt-5"),$("#code_editor").css("height",36+"em"),$("#code_output").css("height",36+"em")):($("#editor-area").addClass("mt-5"),$("#code_editor").height("22rem"),$("#code_output").height("22rem"))}function et(t,e,n,a,i){$("#profile").toggle(),$("#profile").is(":visible")&&($("#username").html(t),$("#email").val(e),$("#birth_year").val(n),$("#gender").val(a),$("#country").val(i))}function tt(t){$.ajax({type:"POST",url:"/change_language",data:JSON.stringify({lang:t}),contentType:"application/json",dataType:"json"}).done(function(e){e.succes&&location.reload()}).fail(function(e){console.error(e)})}function nt(t){$(".profile_image").removeClass("border-2 border-blue-600"),$("#profile_image_"+t).addClass("border-2 border-blue-600"),$("#profile_picture").val(t)}$(function(){function t(){$("#warningbox").hide(),$("#errorbox").hide(),$("#okbox").hide(),$("#output").empty(),$("#turtlecanvas").empty(),window.State.unsaved_changes=!1}function e(n){var c,x,R,p,A,N,F;let a=$('*[data-tab="'+n+'"]'),i=a.siblings("*[data-tab]"),l=$('*[data-tabtarget="'+n+'"]'),o=l.siblings("*[data-tabtarget]");i.removeClass("tab-selected"),a.addClass("tab-selected"),o.addClass("hidden"),l.removeClass("hidden");let s={};if((c=window.State.adventures)==null||c.map(function(Q){s[Q.short_name]=Q}),document.getElementById("repair_button").style.visibility="hidden",t(),n==="end"){$("#adventures-tab").css("height",""),$("#adventures-tab").css("max-height","100%"),$("#level-header input").hide(),$("#editor-area").hide();return}$("#adventures-tab").css("max-height","20em"),$("#level-header input").show(),$("#editor-area").show(),window.State.loaded_program&&(window.State.adventure_name_onload||"level")===n?($("#program_name").val(window.State.loaded_program.name),(x=b)==null||x.setValue(window.State.loaded_program.code)):((R=s[n])==null?void 0:R.loaded_program)?($("#program_name").val(s[n].loaded_program.name),(p=b)==null||p.setValue(s[n].loaded_program.code)):n==="level"&&window.State.default_program_name&&window.State.default_program?($("#program_name").val(window.State.default_program_name),(A=b)==null||A.setValue(window.State.default_program)):($("#program_name").val(s[n].default_save_name+" - "+window.State.level_title+" "+window.State.level),(N=b)==null||N.setValue(s[n].start_code)),window.State.adventure_name=n==="level"?void 0:n,(F=b)==null||F.clearSelection(),window.State.unsaved_changes=!1}if($("*[data-tab]").click(function(n){let i=$(n.target).data("tab");n.preventDefault(),window.State.unsaved_changes?d.confirm(r.texts.unsaved_changes,()=>e(i)):e(i);let l=i!=="level"?i:"";window.history&&window.history.replaceState(null,"","#"+l)}),window.State&&window.State.adventure_name)e(window.State.adventure_name);else if(window.location.hash){let n=window.location.hash.replace(/^#/,"");n&&e(n)}});function rt(t){var e=80,n=t.split(`
`),a=n.map(i=>Math.floor(i.length/e));return at(a)+n.length}function at(t){let e=0;for(let n of t)e+=n;return e}function ye(t){var e=Math.max(1,rt($(t).val())),n=e*25+4;$(t).height()<n&&$(t).css({height:`${n}px`})}var q=!0,ve=$(".translated-input").filter(function(t,e){return e.textContent!==null&&e.textContent.length>0&&$(e).parent().parent().find(".original-text")[0].textContent!==e.textContent});$("#show-hide-missing-translations").click(function(){q?(ve.each(function(t,e){$(e).parent().parent().hide()}),$("tr.bg-purple-200").hide(),q=!1,$(this)[0].innerText="Show all translations"):(ve.each(function(t,e){$(e).parent().parent().show()}),$("tr.bg-purple-200").show(),q=!0,$(this)[0].innerText="Show only missing translations")});$("textarea").each((t,e)=>ye(e)).on("input",t=>{let e=$(t.target);e.hasClass("touched")||(e.addClass("touched"),e.attr("name",e.data("name")),ot(e.closest("form"))),ye(e)});var xe=new Map;function ot(t){var e=t.data("file"),n=xe.get(e);if(!n){var a=$('button[data-file="'+e+'"]');n={button:a,changes:0},xe.set(e,n)}n.changes+=1,n.button.text(`${e} (${n.changes})`)}$("button[data-file]").click(t=>{var e=$(t.target).data("file"),n=$('form[data-file="'+e+'"]');n.submit()});return it;})();
//# sourceMappingURL=appbundle.js.map
