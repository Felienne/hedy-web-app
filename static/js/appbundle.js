var hedyApp=(()=>{var Y=Object.defineProperty;var we=n=>Y(n,"__esModule",{value:!0});var Se=(n,t)=>{we(n);for(var r in t)Y(n,r,{get:t[r],enumerable:!0})};var qe={};Se(qe,{ScrollOutputToBottom:()=>Be,auth:()=>a,change_language:()=>We,confetti_cannon:()=>De,copy_to_clipboard:()=>_e,create_class:()=>Te,delete_class:()=>be,error:()=>_,fix_code:()=>V,get_trimmed_code:()=>j,join_class:()=>B,load_quiz:()=>Fe,modal:()=>c,modalStepOne:()=>ge,prompt_unsaved:()=>je,remove_student:()=>$e,rename_class:()=>Ee,reset_level_preferences:()=>Re,runit:()=>H,save_level_settings:()=>Ne,saveit:()=>W,saveitP:()=>U,share_program:()=>Oe,show_doc_section:()=>Ae,submit_program:()=>Pe,success:()=>P,theGlobalEditor:()=>v,theModalEditor:()=>ie,toggle_developers_mode:()=>Ve,tryPaletteCode:()=>ke,viewProgramLink:()=>ce});var q=class{constructor(){$("#modal-confirm-button").on("click",()=>this.hide()),$("#modal-no-button").on("click",()=>this.hide()),$("#modal-cancel-button").on("click",()=>this.hide())}show(){$("#modal-mask").show(),$("#modal-content").show(),window.scrollTo(0,0)}hide(){$("#modal-mask").hide(),$("#modal-content").hide(),$("#modal-alert").hide(),$("#modal-prompt").hide(),$("#modal-confirm").hide()}alert(t,r,o=""){o!=""?($("#modal-alert-title").html(o),$("#modal-alert-title").removeClass("hidden")):($("#modal-alert-title").html(""),$("#modal-alert-title").addClass("hidden")),$("#modal-alert-text").html(t),this.show(),$("#modal-alert").show(),r&&setTimeout(()=>this.hide(),r)}confirm(t,r){$("#modal-confirm-text").text(t),this.show(),$("#modal-confirm").show(),$("#modal-yes-button").off("click").on("click",()=>{this.hide(),r()})}prompt(t,r,o){$("#modal-prompt-text").text(t),this.show(),$("#modal-prompt").show(),r&&$("#modal-prompt-input").val(r),$("#modal-ok-button").off("click").on("click",()=>{this.hide();let s=$("#modal-prompt-input").val();typeof s=="string"&&o(s)})}},f,P={setEditor(n){f=n},hide:function(){$("#okbox").hide(),f==null||f.resize()},showWarning(n,t){$("#okbox .caption").text(n),$("#okbox .details").text(t),$("#okbox").show(),f==null||f.resize()},show(n){$("#okbox .caption").text(n),$("#okbox").show(),f==null||f.resize(),setTimeout(function(){$("#okbox").hide(),f==null||f.resize()},3e3)}},_={setEditor(n){f=n},hide(){$("#errorbox").hide(),$("#warningbox").hide(),f==null||f.resize()},showWarning(n,t){$("#warningbox .caption").text(n),$("#warningbox .details").text(t),$("#warningbox").show(),f==null||f.resize()},show(n,t){$("#errorbox .caption").text(n),$("#errorbox .details").html(t),$("#errorbox").show(),f==null||f.resize()}},c=new q;var Q={_PRINT:"print",_ASK:"ask",_ECHO:"echo",_FORWARD:"forward",_TURN:"turn",_IS:"is",_SLEEP:"sleep",_ADD_LIST:"add",_TO_LIST:"to",_REMOVE:"remove",_FROM:"from",_AT:"at",_RANDOM:"random",_IN:"in",_IF:"if",_ELSE:"else",_AND:"and",_REPEAT:"repeat",_TIMES:"times",_FOR:"for",_RANGE:"range",_TO:"to",_STEP:"step",_ELIF:"elif",_INPUT:"input",_OR:"or",_WHILE:"while",_LENGTH:"length"};var X={_PRINT:"(?:print|print)",_ASK:"(?:vraag|ask)",_ECHO:"(?:echo|echo)",_FORWARD:"(?:vooruit|forward)",_TURN:"(?:draai|turn)",_IS:"(?:is|is)",_SLEEP:"(?:slaap|sleep)",_ADD_LIST:"(?:voeg|add)",_TO_LIST:"(?:toe aan|to)",_REMOVE:"(?:verwijder|remove)",_FROM:"(?:uit|from)",_AT:"(?:op|at)",_RANDOM:"(?:willekeurig|random)",_IN:"(?:in|in)",_IF:"(?:als|if)",_ELSE:"(?:anders|else)",_AND:"(?:en|and)",_REPEAT:"(?:herhaal|repeat)",_TIMES:"(?:keer|times)",_FOR:"(?:voor|for)",_RANGE:"(?:bereik|range)",_TO:"(?:tot|to)",_STEP:"(?:stap|step)",_ELIF:"(?:alsanders|elif)",_INPUT:"(?:invoer|input)",_OR:"(?:of|or)",_WHILE:"(?:zolang|while)",_LENGTH:"(?:lengte|length)"};var e;switch(window.State.lang){case"nl":e=X;break;default:e=Q;break}function m(n,t){return{gobble:[{regex:".*",token:"text",next:"start"}],expression_eol:xe([{regex:"'[^']*'",token:"constant.character"},{regex:n+" "+t,token:"keyword"},{regex:"$",token:"text"}])}}var ye=[{name:"level1",rules:h(m(e._AT,e._RANDOM),A(e._PRINT,"gobble"),F(e._TURN,e._FORWARD),g("start",{regex:k(e._ECHO),token:"keyword",next:"gobble"}),g("start",{regex:k(e._ASK),token:"keyword",next:"gobble"}))},{name:"level2",rules:h(m(e._AT,e._RANDOM),A(e._PRINT,"expression_eol"),R(e._IS,e._ASK,"gobble"),w(e._IS,"gobble"),F(e._TURN,e._FORWARD),ve(e._SLEEP))},{name:"level3",rules:h(m(e._AT,e._RANDOM),F(e._TURN,e._FORWARD),A(e._PRINT,"expression_eol"),R(e._IS,e._ASK),w(e._IS))},{name:"level4",rules:h(m(e._AT,e._RANDOM),A(e._PRINT),R(e._IS,e._ASK),w(e._IS),D(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM))},{name:"level5",rules:h(m(e._AT,e._RANDOM),A(e._PRINT),R(e._IS,e._ASK),w(e._IS),D(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),G(e._REPEAT,e._TIMES))},{name:"level6",rules:h(m(e._AT,e._RANDOM),A(e._PRINT),R(e._IS,e._ASK),w(e._IS),D(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),G(e._REPEAT,e._TIMES),y())},{name:"level7",rules:h(m(e._AT,e._RANDOM),A(e._PRINT),R(e._IS,e._ASK),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),G(e._REPEAT,e._TIMES),y())},{name:"level8",rules:h(m(e._AT,e._RANDOM),A(e._PRINT),R(e._IS,e._ASK),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),ee(e._FOR,e._IN))},{name:"level9and10",rules:h(m(e._AT,e._RANDOM),A(e._PRINT),R(e._IS,e._ASK),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),te(e._FOR,e._IN,e._RANGE),ee(e._FOR,e._IN))},{name:"level11",rules:h(m(e._AT,e._RANDOM),A(e._PRINT),R(e._IS,e._ASK),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),te(e._FOR,e._IN,e._RANGE))},{name:"level12",rules:h(m(e._AT,e._RANDOM),T(e._PRINT),E(e._IS,e._INPUT),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),b(e._FOR,e._IN,e._RANGE))},{name:"level11",rules:h(m(e._AT,e._RANDOM),T(e._PRINT),E(e._IS,e._INPUT),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),b(e._FOR,e._IN,e._RANGE))},{name:"level13",rules:h(m(e._AT,e._RANDOM),T(e._PRINT),E(e._IS,e._INPUT),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),b(e._FOR,e._IN,e._RANGE))},{name:"level14",rules:h(m(e._AT,e._RANDOM),T(e._PRINT),E(e._IS,e._INPUT),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),b(e._FOR,e._IN,e._RANGE))},{name:"level15",rules:h(m(e._AT,e._RANDOM),T(e._PRINT),E(e._IS,e._INPUT),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),b(e._FOR,e._IN,e._RANGE))},{name:"level16",rules:h(m(e._AT,e._RANDOM),T(e._PRINT),E(e._IS,e._INPUT),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),b(e._FOR,e._IN,e._RANGE))},{name:"level17",rules:h(m(e._AT,e._RANDOM),T(e._PRINT),E(e._IS,e._INPUT),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),b(e._FOR,e._IN,e._RANGE))},{name:"level18and19",rules:h(m(e._AT,e._RANDOM),T(e._PRINT),E(e._IS,e._INPUT),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),b(e._FOR,e._IN,e._RANGE))},{name:"level20",rules:h(m(e._AT,e._RANDOM),T(e._PRINT),E(e._IS,e._INPUT),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),b(e._FOR,e._IN,e._RANGE))},{name:"level21",rules:h(m(e._AT,e._RANDOM),T(e._PRINT),E(e._IS,e._INPUT),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),b(e._FOR,e._IN,e._RANGE))},{name:"level22",rules:h(m(e._AT,e._RANDOM),T(e._PRINT),E(e._IS,e._INPUT),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),b(e._FOR,e._IN,e._RANGE))},{name:"level23",rules:h(m(e._AT,e._RANDOM),T(e._PRINT),E(e._IS,e._INPUT),w(e._IS),x(e._IF,e._ELSE,e._IS,e._IN),S(e._AT,e._RANDOM),y(),b(e._FOR,e._IN,e._RANGE))}];function xe(n){let t=[];for(let r of n)r.regex&&t.push({regex:r.regex+"$",token:r.token,next:"start"}),t.push(r);return t}function g(n,t){return r=>{Array.isArray(n)||(n=[n]);for(let o of n)r[o]||(r[o]=[]),Array.isArray(t)?r[o].push(...t):r[o].push(t);return r}}function C(...n){return t=>{for(let r of n)t=r(t);return t}}function h(n,...t){return C(...t)(n)}function A(n,t){return g("start",{regex:k(n),token:"keyword",next:t!=null?t:"start"})}function R(n,t,r){return g("start",{regex:"(\\w+)( "+n+" "+t+")",token:["text","keyword"],next:r!=null?r:"expression_eol"})}function w(n,t){return g("start",{regex:"(\\w+)( "+n+" )",token:["text","keyword"],next:t!=null?t:"expression_eol"})}function T(n){return g("start",{regex:"("+n+")(\\()",token:["keyword","paren.lparen"],next:"start"})}function F(n,t){return C(g("start",{regex:n+" (left|right)?",token:"keyword",next:"start"}),g("start",{regex:t,token:"keyword",next:"start"}))}function ve(n){return g("start",{regex:n,token:"keyword",next:"start"})}function E(n,t){return g("start",{regex:"(\\w+)( "+n+" "+t+")(\\()",token:["text","keyword","paren.lparen"],next:"start"})}function S(n,t){return C(g("start",{regex:"'[^']*'",token:"constant.character"}),g("start",{regex:n+t,token:"keyword"}),g("start",{regex:"[, ]+",token:"punctuation.operator"}))}function D(n,t,r,o){return C(g("start",{regex:k(n),token:"keyword",next:"condition"}),g("start",{regex:k(t),token:"keyword"}),g("condition",{regex:k("(("+r+")|("+o+"))"),token:"keyword",next:"start"}))}function x(n,t,r,o){return C(g("start",{regex:k(n),token:"keyword",next:"condition"}),g("start",{regex:"\\b"+t+"\\b",token:"keyword"}),g("condition",{regex:k("(("+r+")|("+o+"))"),token:"keyword",next:"start"}))}function y(){return g(["start","expression_eol"],[{regex:" \\* ",token:"keyword"},{regex:" \\+ ",token:"keyword"},{regex:" \\- ",token:"keyword"}])}function G(n,t){return g("start",{regex:"("+n+")( \\w+ )("+t+")",token:["keyword","text","keyword"]})}function ee(n,t){return g("start",{regex:"("+n+" )(\\w+)( "+t+" )(\\w+)",token:["keyword","text","keyword","text"]})}function te(n,t,r){return g("start",{regex:"("+n+" )(\\w+)( "+t+" "+r+" )(\\w+)( to )(\\w+)",token:["keyword","text","keyword","text","keyword","text"]})}function b(n,t,r){return g("start",{regex:"("+n+" )(\\w+)( "+t+" "+r+")(\\()([\\s\\w]+)(,)([\\s\\w]+)(\\))",token:["keyword","text","keyword","paren.lparen","text","punctuation.operator","text","paren.rparen"]})}function k(n){return"\\b"+n+" "}function Ie(n){for(let t of Object.values(n))for(let r of t)r.regex&&!r._loosened&&(r.regex=r.regex.replace(/ /g," +"),r._loosened=!0);return n}if(window.define)for(let n of ye)define("ace/mode/"+n.name,[],function(t,r,o){var s=t("ace/lib/oop"),l=t("ace/mode/text").Mode,i=t("ace/mode/text_highlight_rules").TextHighlightRules;function u(){this.$rules=Ie(n.rules),this.normalizeRules()}s.inherits(u,i);function d(){this.HighlightRules=u}s.inherits(d,l),r.Mode=d});function Te(){c.prompt(a.texts.class_name_prompt,"",function(n){if(!n){c.alert(a.texts.class_name_empty);return}$.ajax({type:"POST",url:"/class",data:JSON.stringify({name:n}),contentType:"application/json",dataType:"json"}).done(function(t){window.location.pathname="/customize-class/"+t.id}).fail(function(t){if(t.responseText=="duplicate"){c.alert(a.texts.class_name_duplicate);return}console.error(t),_.show(ErrorMessages.Connection_error,JSON.stringify(t))})})}function Ee(n){c.prompt(a.texts.class_name_prompt,"",function(t){if(!t){c.alert(a.texts.class_name_empty);return}$.ajax({type:"PUT",url:"/class/"+n,data:JSON.stringify({name:t}),contentType:"application/json",dataType:"json"}).done(function(r){location.reload()}).fail(function(r){if(r.responseText=="duplicate"){c.alert(a.texts.class_name_duplicate);return}console.error(r),_.show(ErrorMessages.Connection_error,JSON.stringify(r))})})}function be(n){c.confirm(a.texts.delete_class_prompt,function(){$.ajax({type:"DELETE",url:"/class/"+n,contentType:"application/json",dataType:"json"}).done(function(t){window.location.pathname="/for-teachers"}).fail(function(t){console.error(t),_.show(ErrorMessages.Connection_error,JSON.stringify(t))})})}function B(n,t,r=!1){if(!a.profile)return c.confirm(a.texts.join_prompt,function(){localStorage.setItem("hedy-join",JSON.stringify({link:n,name:t})),window.location.pathname="/login"});$.ajax({type:"GET",url:n}).done(function(o){c.alert(a.texts.class_join_confirmation+" "+t),r||(window.location.pathname="/programs")}).fail(function(o){console.error(o),_.show(ErrorMessages.Connection_error,JSON.stringify(o))})}function $e(n,t){c.confirm(a.texts.remove_student_prompt,function(){$.ajax({type:"DELETE",url:"/class/"+n+"/student/"+t,contentType:"application/json",dataType:"json"}).done(function(r){location.reload()}).fail(function(r){console.error(r),_.show(ErrorMessages.Connection_error,JSON.stringify(r))})})}function Ae(n){$(".section-button").each(function(){$(this).hasClass("blue-btn")&&($(this).removeClass("blue-btn"),$(this).addClass("green-btn"))}),$("#section-"+n).is(":visible")?($("#button-"+n).removeClass("blue-btn"),$("#button-"+n).addClass("green-btn"),$(".section").hide()):($("#button-"+n).removeClass("green-btn"),$("#button-"+n).addClass("blue-btn"),$(".section").hide(),$("#section-"+n).toggle())}function Ne(n,t){let r=[];$("#adventures_overview li").each(function(){$(this).is(":visible")&&$(this).find(":input").prop("checked")&&r.push(this.getAttribute("id"))});let o=!!$(`#hide_level${t}`).prop("checked"),s=!!$(`#hide_level${t-1}`).prop("checked"),l=!!$(`#example_programs${t}`).prop("checked"),i=!!$(`#hide_level${t-1}`).prop("checked");$.ajax({type:"PUT",url:"/customize-class/"+n,data:JSON.stringify({adventures:r,example_programs:l,hide_level:o,hide_prev_level:i,hide_next_level:s,level:t}),contentType:"application/json",dataType:"json"}).done(function(u){location.reload()}).fail(function(u){console.error(u),_.show(ErrorMessages.Connection_error,JSON.stringify(u))})}function Re(n){$("#adventures_overview li").each(function(){$(this).is(":visible")&&$(this).find(":input").prop("checked",!0)}),$("#example_programs"+n).prop("checked",!0),$("#hide_level"+n).prop("checked",!1)}var ne={AF:"Afghanistan",AX:"\xC5land Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia, Plurinational State of",BQ:"Bonaire, Sint Eustatius and Saba",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo",CD:"Congo, the Democratic Republic of the",CK:"Cook Islands",CR:"Costa Rica",CI:"C\xF4te d'Ivoire",HR:"Croatia",CU:"Cuba",CW:"Cura\xE7ao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Territories",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and McDonald Islands",VA:"Holy See (Vatican City State)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic of",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People's Democratic Republic",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia, the Former Yugoslav Republic of",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, Federated States of",MD:"Moldova, Republic of",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestine, State of",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"R\xE9union",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint Barth\xE9lemy",SH:"Saint Helena, Ascension and Tristan da Cunha",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",MF:"Saint Martin (French part)",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Sint Maarten (Dutch part)",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and the South Sandwich Islands",SS:"South Sudan",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard and Jan Mayen",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan, Province of China",TJ:"Tajikistan",TZ:"Tanzania, United Republic of",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Minor Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela, Bolivarian Republic of",VN:"Viet Nam",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"};if(!window.AuthMessages)throw new Error('On a page where you load this JavaScript, you must also load the "client_messages.js" script');var a={texts:AuthMessages,profile:void 0,reset:void 0,entityify:function(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},emailRegex:/^(([a-zA-Z0-9_+\.\-]+)@([\da-zA-Z\.\-]+)\.([a-zA-Z\.]{2,6})\s*)$/,redirect:function(n){n="/"+n,window.location.pathname=n},logout:function(){$.ajax({type:"POST",url:"/auth/logout"}).done(function(){a.redirect("login")})},destroy:function(){c.confirm(a.texts.are_you_sure,function(){$.ajax({type:"POST",url:"/auth/destroy"}).done(function(){a.redirect("")})})},error:function(n,t,r){$(r||"#error").html(n),$(r||"#error").css("display","block"),t&&$("#"+t).css("border","solid 1px red")},clear_error:function(n){$(n||"#error").html(""),$(n||"#error").css("display","none"),$("form *").css("border","")},success:function(n,t){$("#error").css("display","none"),$(t||"#success").html(n),$(t||"#success").css("display","block")},submit:function(n){var r,o,s,l;let t={};if($("form.js-validated-form *").map(function(i,u){u.id&&(t[u.id]=u.value)}),n==="signup"){if(!t.username)return a.error(a.texts.please_username,"username");if(t.username=t.username.trim(),t.username.length<3)return a.error(a.texts.username_three,"username");if(t.username.match(/:|@/))return a.error(a.texts.username_special,"username");if(!((r=t.email)==null?void 0:r.match(a.emailRegex)))return a.error(a.texts.valid_email,"email");if(t.email!==t.mail_repeat)return a.error(a.texts.repeat_match_email,"mail_repeat");if(!t.password)return a.error(a.texts.please_password,"password");if(t.password.length<6)return a.error(a.texts.password_six,"password");if(t.password!==t.password_repeat)return a.error(a.texts.repeat_match_password,"password_repeat");if(t.birth_year&&!oe(t.birth_year))return a.error(a.texts.valid_year+new Date().getFullYear(),"birth_year");let i={username:t.username,email:t.email,password:t.password,birth_year:t.birth_year?parseInt(t.birth_year):void 0,country:t.country?t.country:void 0,gender:t.gender?t.gender:void 0,subscribe:$("#subscribe").prop("checked"),is_teacher:$("#is_teacher").prop("checked"),prog_experience:$("input[name=has_experience]:checked").val(),experience_languages:$("#languages").is(":visible")?$("input[name=languages]").filter(":checked").map((u,d)=>$(d).val()).get():void 0};$.ajax({type:"POST",url:"/auth/signup",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){a.success(a.texts.signup_success),a.profile={session_expires_at:Date.now()+1e3*60*60*24},re()}).fail(function(u){let d=u.responseText||"";d.match("email")?a.error(a.texts.exists_email):d.match("username")?a.error(a.texts.exists_username):a.error(a.texts.ajax_error)})}if(n==="login"){if(!t.username)return a.error(a.texts.please_username_email,"username");if(!t.password)return a.error(a.texts.please_password,"password");a.clear_error(),$.ajax({type:"POST",url:"/auth/login",data:JSON.stringify({username:t.username,password:t.password}),contentType:"application/json; charset=utf-8"}).done(function(){a.profile={session_expires_at:Date.now()+1e3*60*60*24},re()}).fail(function(i){var u;i.status===403?(a.error(a.texts.invalid_username_password+" "+a.texts.no_account+` &nbsp;<button class="green-btn" onclick="auth.redirect ('signup')">`+a.texts.create_account+"</button>"),$("#create-account").hide(),localStorage.setItem("hedy-login-username",(u=t.username)!=null?u:"")):a.error(a.texts.ajax_error)})}if(n==="profile"){if(!((o=t.email)!=null?o:"").match(a.emailRegex))return a.error(a.texts.valid_email,"email");if(t.birth_year&&!oe(t.birth_year))return a.error(a.texts.valid_year+new Date().getFullYear(),"birth_year");let i={email:t.email,birth_year:t.birth_year?parseInt(t.birth_year):void 0,country:t.country,gender:t.gender,prog_experience:$("input[name=has_experience]:checked").val(),experience_languages:$("#languages").is(":visible")?$("input[name=languages]").filter(":checked").map((u,d)=>$(d).val()).get():void 0};console.log(i),a.clear_error(),$.ajax({type:"POST",url:"/profile",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){a.success(a.texts.profile_updated)}).fail(function(u){a.error(a.texts.ajax_error+" "+u.responseText)})}if(n==="change_password"){if(!t.password)return a.error(a.texts.please_password,"password","#error-password");if(t.password.length<6)return a.error(a.texts.password_six,"password","#error-password");if(t.password!==t.password_repeat)return a.error(a.texts.repeat_match,"password_repeat","#error-password");let i={old_password:t.old_password,new_password:t.password};a.clear_error("#error-password"),$.ajax({type:"POST",url:"/auth/change_password",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){a.success(a.texts.password_updated,"#success-password"),$("#old_password").val(""),$("#password").val(""),$("#password_repeat").val("")}).fail(function(u){u.status===403?a.error(a.texts.invalid_password,null,"#error-password"):a.error(a.texts.ajax_error,null,"#error-password")})}if(n==="recover"){if(!t.username)return a.error(a.texts.please_username,"username");let i={username:t.username};a.clear_error(),$.ajax({type:"POST",url:"/auth/recover",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){a.success(a.texts.sent_password_recovery),$("#username").val("")}).fail(function(u){u.status===403?a.error(a.texts.invalid_username):a.error(a.texts.ajax_error)})}if(n==="reset"){if(!t.password)return a.error(a.texts.please_password,"password");if(t.password.length<6)return a.error(a.texts.password_six,"password");if(t.password!==t.password_repeat)return a.error(a.texts.repeat_match,"password_repeat");let i={username:(s=a.reset)==null?void 0:s.username,token:(l=a.reset)==null?void 0:l.token,password:t.password};a.clear_error(),$.ajax({type:"POST",url:"/auth/reset",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){a.success(a.texts.password_resetted),$("#password").val(""),$("#password_repeat").val(""),delete a.reset,a.redirect("login")}).fail(function(u){u.status===403?a.error(a.texts.invalid_reset_link):a.error(a.texts.ajax_error)})}},markAsTeacher:function(n,t){$.ajax({type:"POST",url:"/admin/markAsTeacher",data:JSON.stringify({username:n,is_teacher:t}),contentType:"application/json; charset=utf-8"}).done(function(){c.alert(["User",n,"successfully",t?"marked":"unmarked","as teacher"].join(" "),4e3),location.reload()}).fail(function(r){console.log(r),c.alert(["Error when",t?"marking":"unmarking","user",n,"as teacher"].join(" "))})},changeUserEmail:function(n,t){c.prompt("Please enter the corrected email",t,function(r){if(r!==t){if(!r.match(a.emailRegex))return c.alert("Please enter a valid email.");$.ajax({type:"POST",url:"/admin/changeUserEmail",data:JSON.stringify({username:n,email:r}),contentType:"application/json; charset=utf-8"}).done(function(){c.alert(["Successfully changed the email for User",n,"to",r].join(" ")),location.reload()}).fail(function(o){console.log(o),c.alert(["Error when changing the email for User",n].join(" "))})}})}};if($("#country")){let n=$("#country").html();Object.keys(ne).map(function(t){n+='<option value="'+t+'">'+ne[t]+"</option>"}),$("#country").html(n)}$(".auth input").get().map(function(n){n.addEventListener("input",()=>a.clear_error())});$.ajax({type:"GET",url:"/profile"}).done(function(n){["/signup","/login"].indexOf(window.location.pathname)!==-1&&a.redirect("my-profile"),a.profile=n,$("#profile").html()&&($("#username").html(n.username),$("#email").val(n.email),$("#birth_year").val(n.birth_year),$("#gender").val(n.gender),$("#country").val(n.country),n.prog_experience&&($('input[name=has_experience][value="'+n.prog_experience+'"]').prop("checked",!0),n.prog_experience==="yes"&&$("#languages").show()),(n.experience_languages||[]).map(function(t){$('input[name=languages][value="'+t+'"]').prop("checked",!0)}),jQuery.isEmptyObject(n.student_classes)?$("#student_classes").hide():$("#student_classes ul").html((n.student_classes||[]).map(function(t){return"<li>"+a.entityify(t.name)+"</li>"}).join("")))}).fail(function(n){window.location.pathname.indexOf("/my-profile")!==-1&&a.redirect("login")});if(window.location.pathname==="/reset"){let n=window.location.search.slice(1).split("&"),t={};n.map(function(r){let o=r.split("=");t[o[0]]=decodeURIComponent(o[1])}),!t.username||!t.token?a.redirect("recover"):a.reset=t}if(window.location.pathname==="/signup"){let n=localStorage.getItem("hedy-login-username");n&&(localStorage.removeItem("hedy-login-username"),n.match("@")?$("#email").val(n):$("#username").val(n));let t=localStorage.getItem("hedy-save-redirect");t&&t.includes("invite")&&$("#is_teacher_div").hide()}$("#email, #mail_repeat").on("cut copy paste",function(n){return n.preventDefault(),!1});async function re(){let n=localStorage.getItem("hedy-first-save"),t=n?JSON.parse(n):void 0;if(t){await U(t[0],t[1],t[2],t[3]),localStorage.removeItem("hedy-first-save");let l=ae();if(l)return a.redirect(l)}let r=localStorage.getItem("hedy-join"),o=r?JSON.parse(r):void 0;if(o)return localStorage.removeItem("hedy-join"),B(o.link,o.name);let s=ae();if(s)return a.redirect(s);a.redirect("programs")}function ae(){let n=localStorage.getItem("hedy-save-redirect");return n&&localStorage.removeItem("hedy-save-redirect"),n}function oe(n){let t=parseInt(n);return!(!t||t<1900||t>new Date().getFullYear())}var v,ie;(function(){window.State||(window.State={}),n($("#editor"));for(let r of $(".turn-pre-into-ace pre").get()){$(r).addClass("text-lg rounded");let o=t(r,!0);if(o.setOptions({maxLines:1/0}),o.setOptions({minLines:2}),o.setValue(o.getValue().replace(/\n+$/,""),-1),$(r).hasClass("no-copy-button")){if($(r).attr("id")){let s=String($(r).attr("id")),l=J(parseInt(s));o.session.setMode(l)}}else{let s=$("<div>").css({position:"absolute",top:5,right:5,width:"auto"}).appendTo(r);$("<button>").attr("title",UiMessages.try_button).css({fontFamily:"sans-serif"}).addClass("green-btn").text("\u21E5").appendTo(s).click(function(){v==null||v.setValue(o.getValue()+`
`)})}}function n(r){if(!r.length)return;var o=t(r.get(0),r.data("readonly"));v=o,_.setEditor(o),window.Range=ace.require("ace/range").Range;let s=window.sessionStorage;if(s){let i=r.data("lskey"),u=r.data("loaded-program"),d=s.getItem(i);u!=="True"&&d&&o.setValue(d,1),o.on("blur",function(I){s.setItem(i,o.getValue())}),o.on("change",function(){$("#inline-modal").is(":visible")&&$("#inline-modal").hide(),window.State.disable_run=!1,$("#runit").css("background-color",""),window.State.unsaved_changes=!0,se(o)})}window.onbeforeunload=()=>{if(window.State.unsaved_changes&&!window.State.no_unload_prompt)return a.texts.unsaved_changes};let l;return window.addEventListener("keydown",function(i){let u=i.keyCode;if(u===18){l=!0;return}if(u===13&&l){if(!window.State.level||!window.State.lang)throw new Error("Oh no");H(window.State.level,window.State.lang,function(){$("#output").focus()})}u===37&&document.activeElement===document.getElementById("output")&&(o.focus(),o.navigateFileEnd())}),window.addEventListener("keyup",function(i){if(i.keyCode===18){l=!1;return}}),o}function t(r,o){let s=ace.edit(r);s.setTheme("ace/theme/monokai"),o&&s.setOptions({readOnly:!0,showGutter:!1,showPrintMargin:!1,highlightActiveLine:!1});var l=1;if(l==1&&window.State.level){let i=J(parseInt(window.State.level));s.session.setMode(i)}return s}})();function J(n){return{"9":"ace/mode/level9and10","10":"ace/mode/level9and10","18":"ace/mode/level18and19","19":"ace/mode/level18and19"}[n]||"ace/mode/level"+n}function K(){return!a.profile||a.profile.session_expires_at>Date.now()?!1:(location.reload(),!0)}function se(n){n.session.clearAnnotations();for(let t in n.session.getMarkers(!1))n.session.removeMarker(t)}function H(n,t,r){if(window.State.disable_run)return c.alert(a.texts.answer_question);if(K())return;$("#output").empty(),$("#turtlecanvas").empty(),_.hide(),P.hide();try{n=n.toString();var s=v,l=j();se(s),ue(),console.log(`Original program:
`,l),$.ajax({type:"POST",url:"/parse",data:JSON.stringify({level:n,code:l,lang:t,read_aloud:!!$("#speak_dropdown").val(),adventure_name:window.State.adventure_name}),contentType:"application/json",dataType:"json"}).done(function(i){if(console.log("Response",i),i.Warning&&(V(n,t),le(n),_.showWarning(ErrorMessages.Transpile_warning,i.Warning)),i.Error){_.show(ErrorMessages.Transpile_error,i.Error),i.Location&&i.Location[0]!="?"&&(V(n,t),Me(s,i.Location[0],i.Location[1]));return}Le(i.Code,i.has_turtle,i.Warning,r).catch(function(u){console.log(u),_.show(ErrorMessages.Execute_error,u.message),Ce(n,l,u.message)})}).fail(function(i){console.error(i),i.readyState<4?_.show(ErrorMessages.Connection_error,ErrorMessages.CheckInternet):_.show(ErrorMessages.Other_error,ErrorMessages.ServerError)})}catch(i){console.error(i),_.show(ErrorMessages.Other_error,i.message)}}function le(n){let t=parseInt(n);if(t<=2){let r=document.getElementById("repair_button");r.style.visibility="visible",r.onclick=function(o){o.preventDefault(),ge(t)}}}function ue(){let n=document.getElementById("repair_button");n.style.visibility="hidden"}function V(n,t){if(window.State.disable_run)return c.alert(a.texts.answer_question);if(!K())try{n=n.toString();var r=j();$.ajax({type:"POST",url:"/fix-code",data:JSON.stringify({level:n,code:r,lang:t,read_aloud:!!$("#speak_dropdown").val(),adventure_name:window.State.adventure_name}),contentType:"application/json",dataType:"json"}).done(function(o){o.FixedCode&&(sessionStorage.setItem("fixed_level_{lvl}__code".replace("{lvl}",n),o.FixedCode),le(n))}).fail(function(o){console.error(o),o.readyState<4?_.show(ErrorMessages.Connection_error,ErrorMessages.CheckInternet):_.show(ErrorMessages.Other_error,ErrorMessages.ServerError)})}catch(o){console.error(o),_.show(ErrorMessages.Other_error,o.message)}}function Me(n,t,r,o=1){if(n.session.setAnnotations([{row:t-1,column:(r!=null?r:1)-1,text:"",type:"error"}]),r===void 0){n.session.addMarker(new ace.Range(t-1,1,t-1,2),"editor-error","fullLine",!1);return}n.session.addMarker(new ace.Range(t-1,r-1,t-1,r-1+o),"editor-error","text",!1)}function ke(n){if(a.profile)if(window.State.examples_left>0)window.State.examples_left=window.State.examples_left-1;else{$("#commands-window").hide(),$("#toggle-button").hide(),c.alert(a.texts.examples_used);return}var t=ace.edit("editor"),r=1;t.setValue(n+`
`,r),window.State.unsaved_changes=!1}function de(n,t,r,o,s){window.State.unsaved_changes=!1;var l=window.State.adventure_name;Array.isArray(n)&&(l=n[1],n=n[0]),$.ajax({type:"POST",url:"/programs",data:JSON.stringify({level:n,lang:t,name:r,code:o,adventure_name:l}),contentType:"application/json",dataType:"json"}).done(function(i){var u;if(s)return i.Error?s(i):s(null,i);if(i.Warning&&_.showWarning(ErrorMessages.Transpile_warning,i.Warning),i.Error){_.show(ErrorMessages.Transpile_error,i.Error);return}c.alert(a.texts.save_success_detail,4e3),$("#program_name").val(i.name),(u=window.State.adventures)==null||u.map(function(d){d.short_name===(l||"level")&&(d.loaded_program={name:i.name,code:o})})}).fail(function(i){console.error(i),_.show(ErrorMessages.Connection_error,JSON.stringify(i)),i.status===403&&(localStorage.setItem("hedy-first-save",JSON.stringify([l?[n,l]:n,t,r,o])),localStorage.setItem("hedy-save-redirect","hedy"),window.location.pathname="/login")})}function W(n,t,r,o,s){if(_.hide(),P.hide(),!K())try{if(!a.profile)return c.confirm(a.texts.save_prompt,function(){window.State&&window.State.adventure_name&&!Array.isArray(n)&&(n=[n,window.State.adventure_name]),localStorage.setItem("hedy-first-save",JSON.stringify([n,t,r,o])),window.location.pathname="/login"});$.ajax({type:"POST",url:"/programs/duplicate-check",data:JSON.stringify({name:r}),contentType:"application/json",dataType:"json"}).done(function(l){l.duplicate?c.confirm(a.texts.overwrite_warning,function(){de(n,t,r,o,s)}):de(n,t,r,o,s)})}catch(l){console.error(l),_.show(ErrorMessages.Other_error,l.message)}}function U(n,t,r,o){return new Promise((s,l)=>{W(n,t,r,o,(i,u)=>{i?l(i):s(u)})})}function ce(n){return window.location.origin+"/hedy/"+n+"/view"}function Oe(n,t,r,o,s){if(!a.profile)return c.alert(a.texts.must_be_logged);var l=function(d){$.ajax({type:"POST",url:"/programs/share",data:JSON.stringify({id:d,public:o}),contentType:"application/json",dataType:"json"}).done(function(I){o&&_e(ce(d),!0),c.alert(o?a.texts.share_success_detail:a.texts.unshare_success_detail,4e3),s&&setTimeout(function(){location.reload()},1e3)}).fail(function(I){console.error(I),_.show(ErrorMessages.Connection_error,JSON.stringify(I))})};if(r!==!0)return l(r);let i=`${$("#program_name").val()}`,u=j();return W(n,t,i,u,(d,I)=>{if(d&&d.Warning)return _.showWarning(ErrorMessages.Transpile_warning,d.Warning);if(d&&d.Error)return _.show(ErrorMessages.Transpile_error,d.Error);l(I.id)})}function Pe(n,t){if(!a.profile)return c.alert(a.texts.must_be_logged);if(console.log(t),!t)return c.alert(a.texts.must_be_shared);$.ajax({type:"POST",url:"/programs/submit",data:JSON.stringify({id:n}),contentType:"application/json",dataType:"json"}).done(function(r){location.reload()})}function _e(n,t){var l,i;var r=document.createElement("textarea");r.value=n,r.setAttribute("readonly",""),r.style.position="absolute",r.style.left="-9999px",document.body.appendChild(r);let o=document.getSelection(),s=o&&o.rangeCount>0?o.getRangeAt(0):void 0;r.select(),document.execCommand("copy"),document.body.removeChild(r),s&&((l=document.getSelection())==null||l.removeAllRanges(),(i=document.getSelection())==null||i.addRange(s)),t||c.alert(a.texts.copy_clipboard,4e3)}function Ce(n,t,r){$.ajax({type:"POST",url:"/report_error",data:JSON.stringify({level:n,code:t,page:window.location.href,client_error:r}),contentType:"application/json",dataType:"json"})}window.onerror=function(t,r,o,s,l){$.ajax({type:"POST",url:"/client_exception",data:JSON.stringify({message:t,source:r,line_number:o,column_number:s,error:l,url:window.location.href,user_agent:navigator.userAgent}),contentType:"application/json",dataType:"json"})};function Le(n,t,r,o){window.State.programsInExecution||(window.State.programsInExecution=0),window.State.programsInExecution++;let s=$("#output");s.empty(),Sk.pre="output";let l=Sk.TurtleGraphics||(Sk.TurtleGraphics={});return l.target="turtlecanvas",$("#adventures").is(":hidden")?(l.height=600,l.worldHeight=600):(l.height=300,l.worldHeight=300),l.width=400,l.worldWidth=400,t?$("#turtlecanvas").show():$("#turtlecanvas").empty(),Sk.configure({output:d,read:I,inputfun:M,inputfunTakesPrompt:!0,__future__:Sk.python3,timeoutMsg:function(){return ErrorMessages.Program_too_long},execLimit:function(){return t?2e4:3e3}()}),Sk.misceval.asyncToPromise(function(){return Sk.importMainWithBody("<stdin>",!1,n,!0)}).then(function(p){console.log("Program executed"),window.State.programsInExecution===1&&$("#output").is(":empty")&&$("#turtlecanvas").is(":empty")&&_.showWarning(ErrorMessages.Transpile_warning,ErrorMessages.Empty_output),window.State.programsInExecution--,r||Ue(),o&&o()}).catch(function(p){console.log(p);let N=i(p)||JSON.stringify(p);throw new Error(N)});function i(p){return p.args&&p.args.v&&p.args.v[0]&&p.args.v[0].v}function u(p,N){$("<span>").text(p).css({color:N}).appendTo(s)}function d(p){window.State.programsInExecution>1||(u(p,"white"),pe(p))}function I(p){if(Sk.builtinFiles===void 0||Sk.builtinFiles.files[p]===void 0)throw"File not found: '"+p+"'";return Sk.builtinFiles.files[p]}function M(p){return Sk.execStart=new Date(new Date().getTime()+1e3*60*60*24*365),$("#turtlecanvas").hide(),new Promise(function(N){window.State.disable_run=!0,$("#runit").css("background-color","gray");let O=$('#inline-modal input[type="text"]');$("#inline-modal .caption").text(p),O.val(""),O.attr("placeholder",p),pe(p),setTimeout(function(){O.focus()},0),$("#inline-modal form").one("submit",function(L){return window.State.disable_run=!1,$("#runit").css("background-color",""),L.preventDefault(),$("#inline-modal").hide(),t&&$("#turtlecanvas").show(),Sk.execStart=new Date,setTimeout(function(){N(O.val()),$("#output").focus()},0),!1}),$("#inline-modal").show()})}}function pe(n){var t=$("#speak_dropdown").val();if(!!t){var r=window.speechSynthesis.getVoices().filter(o=>o.voiceURI===t)[0];if(r){let o=new SpeechSynthesisUtterance(n);o.voice=r,o.rate=.9,speechSynthesis.speak(o)}}}(()=>{if(!window.speechSynthesis||!window.State.lang)return;let n=0,t=setInterval(function(){var s;n+=1;let o=r((s=window.State.lang)!=null?s:"");if(o.length>0){for(let l of o)$("#speak_dropdown").append($("<option>").attr("value",l.voiceURI).text("\u{1F4E3} "+l.name));$("#speak_container").show(),clearInterval(t)}n>=20&&clearInterval(t)},100);function r(o){let s=o.match(/^([a-z]+)/i);if(!s)return[];let l=s[1];return window.speechSynthesis?window.speechSynthesis.getVoices().filter(i=>i.lang.startsWith(l)):[]}})();function je(n){if(window.State.no_unload_prompt=!0,!window.State.unsaved_changes||!a.profile)return n();c.confirm(a.texts.unsaved_changes,n)}function Fe(n,t){$('*[data-tabtarget="end"]').html('<iframe id="quiz-iframe" class="w-full" title="Quiz" src="/quiz/start/'+n+"?lang="+t+'"></iframe>')}function j(){try{ace.require("ace/ext/whitespace").trimTrailingSpace(v.session,!0)}catch(n){console.error(n)}return v==null?void 0:v.getValue()}function De(){let n=document.getElementById("confetti");if(n){n.classList.remove("hidden");let t=new JSConfetti({canvas:n});setTimeout(function(){n.classList.add("hidden")},3e3);let r=$("#adventures"),o=$(r).find(".tab-selected").attr("data-tab");if(["turtle","rock","haunted","restaurant","fortune","songs","dice"].includes(o)){let i=Ge(o!=null?o:"");t.addConfetti({emojis:i,emojiSize:45,confettiNumber:100})}else t.addConfetti();let l=document.getElementById("confetti-button");l&&l.classList.add("hidden")}}function Ge(n){let t=Array.from(ErrorMessages[n]);return t!=null?t:[["\u{1F308}"],["\u26A1\uFE0F"],["\u{1F4A5}"],["\u2728"],["\u{1F4AB}"]]}function Be(){return $("#output").animate({scrollTop:$(document).height()},"slow"),!1}function ge(n){Je(n);let t=$("#modal-editor");He(t)}function Ue(){ue();var n=ErrorMessages.Transpile_success,t=Math.floor(Math.random()*n.length);P.show(n[t])}function Je(n){let t=`<div id='modal-editor' data-lskey="level_{level}__code" class="w-full flex-1 text-lg rounded" style='height:200px; width:50vw;'></div>`.replace("{level}",n.toString()),r=ErrorMessages.Program_repair;c.alert(t,0,r)}function Ke(n,t){let r=ace.edit(n);r.setTheme("ace/theme/monokai"),t&&r.setOptions({readOnly:!0,showGutter:!1,showPrintMargin:!1,highlightActiveLine:!1});var o=1;if(o==1&&window.State.level){let s=J(parseInt(window.State.level));r.session.setMode(s)}return r}function He(n){var s,l;if(!n.length)return;let t=Ke(n.get(0),!0);ie=t,_.setEditor(t),setTimeout(function(){},2e3),window.Range=ace.require("ace/range").Range;let r=window.sessionStorage;if(r){let i=n.data("lskey"),u=0,d="";if(r.getItem("fixed_{lvl}".replace("{lvl}",i))){d=(s=r.getItem("fixed_{lvl}".replace("{lvl}",i)))!=null?s:"";let I="";for(let M=0;M<d.length+1;M++)setTimeout(function(){t.setValue(I,u),I+=d[u],u++},150*M)}else d=(l=r.getItem("warning_{lvl}".replace("{lvl}",i)))!=null?l:"",t.setValue(d)}window.onbeforeunload=()=>{if(window.State.unsaved_changes&&!window.State.no_unload_prompt)return a.texts.unsaved_changes};let o;return window.addEventListener("keydown",function(i){let u=i.keyCode;if(u===18){o=!0;return}if(u===13&&o){if(!window.State.level||!window.State.lang)throw new Error("Oh no");H(window.State.level,window.State.lang,function(){$("#output").focus()})}u===37&&document.activeElement===document.getElementById("output")&&(t.focus(),t.navigateFileEnd())}),window.addEventListener("keyup",function(i){if(i.keyCode===18){o=!1;return}}),t}function Ve(n){$("#developers_toggle").is(":checked")?($("#commands-window-total").hide(),$("#adventures").hide()):(n&&$("#commands-window-total").show(),$("#adventures").show()),$("#adventures").is(":hidden")?($("#editor-area").removeClass("mt-5"),$("#code_editor").css("height",36+"em"),$("#code_output").css("height",36+"em")):($("#editor-area").addClass("mt-5"),$("#code_editor").height("22rem"),$("#code_output").height("22rem"))}function We(n){$.ajax({type:"POST",url:"/change_language",data:JSON.stringify({lang:n}),contentType:"application/json",dataType:"json"}).done(function(t){t.succes&&location.reload()}).fail(function(t){console.error(t)})}$(function(){function n(){$("#warningbox").hide(),$("#errorbox").hide(),$("#okbox").hide(),$("#output").empty(),$("#turtlecanvas").empty(),window.State.unsaved_changes=!1}function t(r){var d,I,M,p,N,O,L;let o=$('*[data-tab="'+r+'"]'),s=o.siblings("*[data-tab]"),l=$('*[data-tabtarget="'+r+'"]'),i=l.siblings("*[data-tabtarget]");s.removeClass("tab-selected"),o.addClass("tab-selected"),i.addClass("hidden"),l.removeClass("hidden");let u={};if((d=window.State.adventures)==null||d.map(function(Z){u[Z.short_name]=Z}),document.getElementById("repair_button").style.visibility="hidden",n(),r==="end"){$("#adventures-tab").css("height",""),$("#adventures-tab").css("max-height","100%"),$("#level-header input").hide(),$("#editor-area").hide();return}$("#adventures-tab").css("max-height","20em"),$("#level-header input").show(),$("#editor-area").show(),window.State.loaded_program&&(window.State.adventure_name_onload||"level")===r?($("#program_name").val(window.State.loaded_program.name),(I=v)==null||I.setValue(window.State.loaded_program.code)):((M=u[r])==null?void 0:M.loaded_program)?($("#program_name").val(u[r].loaded_program.name),(p=v)==null||p.setValue(u[r].loaded_program.code)):r==="level"&&window.State.default_program_name&&window.State.default_program?($("#program_name").val(window.State.default_program_name),(N=v)==null||N.setValue(window.State.default_program)):($("#program_name").val(u[r].default_save_name+" - "+window.State.level_title+" "+window.State.level),(O=v)==null||O.setValue(u[r].start_code)),window.State.adventure_name=r==="level"?void 0:r,(L=v)==null||L.clearSelection(),window.State.unsaved_changes=!1}if($("*[data-tab]").click(function(r){let s=$(r.target).data("tab");r.preventDefault(),window.State.unsaved_changes?c.confirm(a.texts.unsaved_changes,()=>t(s)):t(s);let l=s!=="level"?s:"";window.history&&window.history.replaceState(null,"","#"+l)}),window.State&&window.State.adventure_name)t(window.State.adventure_name);else if(window.location.hash){let r=window.location.hash.replace(/^#/,"");r&&t(r)}});function ze(n){var t=80,r=n.split(`
`),o=r.map(s=>Math.floor(s.length/t));return Ze(o)+r.length}function Ze(n){let t=0;for(let r of n)t+=r;return t}function fe(n){var t=Math.max(1,ze($(n).val())),r=t*25+4;$(n).height()<r&&$(n).css({height:`${r}px`})}var z=!0,me=$(".translated-input").filter(function(n,t){return t.textContent!==null&&t.textContent.length>0&&$(t).parent().parent().find(".original-text")[0].textContent!==t.textContent});$("#show-hide-missing-translations").click(function(){z?(me.each(function(n,t){$(t).parent().parent().hide()}),$("tr.bg-purple-200").hide(),z=!1,$(this)[0].innerText="Show all translations"):(me.each(function(n,t){$(t).parent().parent().show()}),$("tr.bg-purple-200").show(),z=!0,$(this)[0].innerText="Show only missing translations")});$("textarea").each((n,t)=>fe(t)).on("input",n=>{let t=$(n.target);t.hasClass("touched")||(t.addClass("touched"),t.attr("name",t.data("name")),Ye(t.closest("form"))),fe(t)});var he=new Map;function Ye(n){var t=n.data("file"),r=he.get(t);if(!r){var o=$('button[data-file="'+t+'"]');r={button:o,changes:0},he.set(t,r)}r.changes+=1,r.button.text(`${t} (${r.changes})`)}$("button[data-file]").click(n=>{var t=$(n.target).data("file"),r=$('form[data-file="'+t+'"]');r.submit()});return qe;})();
//# sourceMappingURL=appbundle.js.map
