var hedyApp=(()=>{var q=Object.defineProperty;var ye=e=>q(e,"__esModule",{value:!0});var xe=(e,t)=>{ye(e);for(var n in t)q(e,n,{get:t[n],enumerable:!0})};var et={};xe(et,{ScrollOutputToBottom:()=>Je,auth:()=>a,change_language:()=>Ye,confetti_cannon:()=>Be,copy_to_clipboard:()=>fe,create_class:()=>Ee,delete_class:()=>Ie,error:()=>c,fix_code:()=>K,get_trimmed_code:()=>j,join_class:()=>U,load_profile:()=>Ze,load_quiz:()=>De,modal:()=>d,modalStepOne:()=>me,prompt_unsaved:()=>Ge,remove_student:()=>Me,rename_class:()=>ke,reset_level_preferences:()=>Oe,runit:()=>W,save_level_settings:()=>Re,saveit:()=>z,saveitP:()=>J,share_program:()=>Le,show_doc_section:()=>Ae,submit_program:()=>Pe,success:()=>N,theGlobalEditor:()=>S,theModalEditor:()=>se,toggle_developers_mode:()=>ze,tryPaletteCode:()=>Ne,viewProgramLink:()=>ge});var Q=class{constructor(){$("#modal-confirm-button").on("click",()=>this.hide()),$("#modal-no-button").on("click",()=>this.hide()),$("#modal-cancel-button").on("click",()=>this.hide())}show(){$("#modal-mask").show(),$("#modal-content").show(),window.scrollTo(0,0)}hide(){$("#modal-mask").hide(),$("#modal-content").hide(),$("#modal-alert").hide(),$("#modal-prompt").hide(),$("#modal-confirm").hide()}alert(t,n,r=""){r!=""?($("#modal-alert-title").html(r),$("#modal-alert-title").removeClass("hidden")):($("#modal-alert-title").html(""),$("#modal-alert-title").addClass("hidden")),$("#modal-alert-text").html(t),this.show(),$("#modal-alert").show(),n&&setTimeout(()=>this.hide(),n)}confirm(t,n){$("#modal-confirm-text").text(t),this.show(),$("#modal-confirm").show(),$("#modal-yes-button").off("click").on("click",()=>{this.hide(),n()})}prompt(t,n,r){$("#modal-prompt-text").text(t),this.show(),$("#modal-prompt").show(),n&&$("#modal-prompt-input").val(n),$("#modal-ok-button").off("click").on("click",()=>{this.hide();let i=$("#modal-prompt-input").val();typeof i=="string"&&r(i)})}},m,N={setEditor(e){m=e},hide:function(){$("#okbox").hide(),m==null||m.resize()},showWarning(e,t){$("#okbox .caption").text(e),$("#okbox .details").text(t),$("#okbox").show(),m==null||m.resize()},show(e){$("#okbox .caption").text(e),$("#okbox").show(),m==null||m.resize(),setTimeout(function(){$("#okbox").hide(),m==null||m.resize()},3e3)}},c={setEditor(e){m=e},hide(){$("#errorbox").hide(),$("#warningbox").hide(),m==null||m.resize()},showWarning(e,t){$("#warningbox .caption").text(e),$("#warningbox .details").text(t),$("#warningbox").show(),m==null||m.resize()},show(e,t){$("#errorbox .caption").text(e),$("#errorbox .details").html(t),$("#errorbox").show(),m==null||m.resize()}},d=new Q;var F={_PRINT:"print",_ASK:"ask",_ECHO:"echo",_FORWARD:"forward",_TURN:"turn",_IS:"is",_SLEEP:"sleep",_ADD_LIST:"add",_TO_LIST:"to",_REMOVE:"remove",_FROM:"from",_AT:"at",_RANDOM:"random",_IN:"in",_IF:"if",_ELSE:"else",_AND:"and",_REPEAT:"repeat",_TIMES:"times",_FOR:"for",_RANGE:"range",_TO:"to",_STEP:"step",_ELIF:"elif",_INPUT:"input",_OR:"or",_WHILE:"while",_LENGTH:"length"};var X={_PRINT:"(?:imprimir|print)",_ASK:"(?:preguntar|ask)",_ECHO:"(?:eco|echo)",_FORWARD:"(?:adelante|forward)",_TURN:"(?:girar|turn)",_IS:"(?:es|is)",_SLEEP:"(?:dormir|sleep)",_ADD_LIST:"(?:a\xF1adir|add)",_TO_LIST:"(?:a|to)",_REMOVE:"(?:borrar|remove)",_FROM:"(?:de|from)",_AT:"(?:en|at)",_RANDOM:"(?:aleatorio|random)",_IN:"(?:en|in)",_IF:"(?:si|if)",_ELSE:"(?:sino|else)",_AND:"(?:y|and)",_REPEAT:"(?:repetir|repeat)",_TIMES:"(?:veces|times)",_FOR:"(?:para|for)",_RANGE:"(?:rango|range)",_TO:"(?:a|to)",_STEP:"(?:paso|step)",_ELIF:"(?:sinosi|elif)",_INPUT:"(?:entrada|input)",_OR:"(?:o|or)",_WHILE:"(?:mientrasw|while)",_LENGTH:"(?:longitud|length)"};var ee={_PRINT:"(?:print|print)",_ASK:"(?:vraag|ask)",_ECHO:"(?:echo|echo)",_FORWARD:"(?:vooruit|forward)",_TURN:"(?:draai|turn)",_IS:"(?:is|is)",_SLEEP:"(?:slaap|sleep)",_ADD_LIST:"(?:voeg|add)",_TO_LIST:"(?:toe aan|to)",_REMOVE:"(?:verwijder|remove)",_FROM:"(?:uit|from)",_AT:"(?:op|at)",_RANDOM:"(?:willekeurig|random)",_IN:"(?:in|in)",_IF:"(?:als|if)",_ELSE:"(?:anders|else)",_AND:"(?:en|and)",_REPEAT:"(?:herhaal|repeat)",_TIMES:"(?:keer|times)",_FOR:"(?:voor|for)",_RANGE:"(?:bereik|range)",_TO:"(?:tot|to)",_STEP:"(?:stap|step)",_ELIF:"(?:alsanders|elif)",_INPUT:"(?:invoer|input)",_OR:"(?:of|or)",_WHILE:"(?:zolang|while)",_LENGTH:"(?:lengte|length)"};window.State||(window.State={});var ve=!0,u;if(ve)switch(window.State.lang){case"nl":u=ee;break;case"es":u=X;break;default:u=F;break}else u=F;function _(){return{gobble:[{regex:".*",token:"text",next:"start"}],expression_eol:be([{regex:"'[^']*'",token:"constant.character"},{regex:u._AT+" "+u._RANDOM,token:"keyword"},{regex:"$",token:"text"}])}}var Se=[{name:"level1",rules:h(_(),I("gobble"),G(),p("start",{regex:O(u._ECHO),token:"keyword",next:"gobble"}),p("start",{regex:O(u._ASK),token:"keyword",next:"gobble"}))},{name:"level2",rules:h(_(),I("expression_eol"),A("gobble"),w("gobble"),G(),$e())},{name:"level3",rules:h(_(),G(),I("expression_eol"),A(),w())},{name:"level4",rules:h(_(),I(),A(),w(),D(),y())},{name:"level5",rules:h(_(),I(),A(),w(),D(),y(),B())},{name:"level6",rules:h(_(),I(),A(),w(),D(),y(),B(),x())},{name:"level7",rules:h(_(),I(),A(),w(),v(),y(),B(),x())},{name:"level8",rules:h(_(),I(),A(),w(),v(),y(),x(),te())},{name:"level9and10",rules:h(_(),I(),A(),w(),v(),y(),x(),ne(),te())},{name:"level11",rules:h(_(),I(),A(),w(),v(),y(),x(),ne())},{name:"level12",rules:h(_(),T(),E(),w(),v(),y(),x(),k())},{name:"level11",rules:h(_(),T(),E(),w(),v(),y(),x(),k())},{name:"level13",rules:h(_(),T(),E(),w(),v(),y(),x(),k())},{name:"level14",rules:h(_(),T(),E(),w(),v(),y(),x(),k())},{name:"level15",rules:h(_(),T(),E(),w(),v(),y(),x(),k())},{name:"level16",rules:h(_(),T(),E(),w(),v(),y(),x(),k())},{name:"level17",rules:h(_(),T(),E(),w(),v(),y(),x(),k())},{name:"level18and19",rules:h(_(),T(),E(),w(),v(),y(),x(),k())},{name:"level20",rules:h(_(),T(),E(),w(),v(),y(),x(),k())},{name:"level21",rules:h(_(),T(),E(),w(),v(),y(),x(),k())},{name:"level22",rules:h(_(),T(),E(),w(),v(),y(),x(),k())},{name:"level23",rules:h(_(),T(),E(),w(),v(),y(),x(),k())}];function be(e){let t=[];for(let n of e)n.regex&&t.push({regex:n.regex+"$",token:n.token,next:"start"}),t.push(n);return t}function p(e,t){return n=>{Array.isArray(e)||(e=[e]);for(let r of e)n[r]||(n[r]=[]),Array.isArray(t)?n[r].push(...t):n[r].push(t);return n}}function L(...e){return t=>{for(let n of e)t=n(t);return t}}function h(e,...t){return L(...t)(e)}function I(e){return p("start",{regex:O(u._PRINT),token:"keyword",next:e!=null?e:"start"})}function A(e){return p("start",{regex:"(\\w+)( "+u._IS+" "+u._ASK+")",token:["text","keyword"],next:e!=null?e:"expression_eol"})}function w(e){return p("start",{regex:"(\\w+)( "+u._IS+" )",token:["text","keyword"],next:e!=null?e:"expression_eol"})}function T(){return p("start",{regex:"("+u._PRINT+")(\\()",token:["keyword","paren.lparen"],next:"start"})}function G(){return L(p("start",{regex:u._TURN+" (left|right)?",token:"keyword",next:"start"}),p("start",{regex:u._FORWARD,token:"keyword",next:"start"}))}function $e(){return p("start",{regex:u._SLEEP,token:"keyword",next:"start"})}function E(){return p("start",{regex:"(\\w+)( "+u._IS+" "+u._INPUT+")(\\()",token:["text","keyword","paren.lparen"],next:"start"})}function y(){return L(p("start",{regex:"'[^']*'",token:"constant.character"}),p("start",{regex:u._AT+u._RANDOM,token:"keyword"}),p("start",{regex:"[, ]+",token:"punctuation.operator"}))}function D(){return L(p("start",{regex:O(u._IF),token:"keyword",next:"condition"}),p("start",{regex:O(u._ELSE),token:"keyword"}),p("condition",{regex:O("(("+u._IS+")|("+u._IN+"))"),token:"keyword",next:"start"}))}function v(){return L(p("start",{regex:O(u._IF),token:"keyword",next:"condition"}),p("start",{regex:"\\b"+u._ELSE+"\\b",token:"keyword"}),p("condition",{regex:O("(("+u._IS+")|("+u._IN+"))"),token:"keyword",next:"start"}))}function x(){return p(["start","expression_eol"],[{regex:" \\* ",token:"keyword"},{regex:" \\+ ",token:"keyword"},{regex:" \\- ",token:"keyword"}])}function B(){return p("start",{regex:"("+u._REPEAT+")( \\w+ )("+u._TIMES+")",token:["keyword","text","keyword"]})}function te(){return p("start",{regex:"("+u._FOR+" )(\\w+)( "+u._IN+" )(\\w+)",token:["keyword","text","keyword","text"]})}function ne(){return p("start",{regex:"("+u._FOR+" )(\\w+)( "+u._IN+" "+u._RANGE+" )(\\w+)( to )(\\w+)",token:["keyword","text","keyword","text","keyword","text"]})}function k(){return p("start",{regex:"("+u._FOR+" )(\\w+)( "+u._IN+" "+u._RANGE+")(\\()([\\s\\w]+)(,)([\\s\\w]+)(\\))",token:["keyword","text","keyword","paren.lparen","text","punctuation.operator","text","paren.rparen"]})}function O(e){return"\\b"+e+" "}function Te(e){for(let t of Object.values(e))for(let n of t)n.regex&&!n._loosened&&(n.regex=n.regex.replace(/ /g," +"),n._loosened=!0);return e}if(window.define)for(let e of Se)define("ace/mode/"+e.name,[],function(t,n,r){var i=t("ace/lib/oop"),o=t("ace/mode/text").Mode,s=t("ace/mode/text_highlight_rules").TextHighlightRules;function l(){this.$rules=Te(e.rules),this.normalizeRules()}i.inherits(l,s);function g(){this.HighlightRules=l}i.inherits(g,o),n.Mode=g});function Ee(){d.prompt(a.texts.class_name_prompt,"",function(e){if(!e){d.alert(a.texts.class_name_empty);return}$.ajax({type:"POST",url:"/class",data:JSON.stringify({name:e}),contentType:"application/json",dataType:"json"}).done(function(t){window.location.pathname="/customize-class/"+t.id}).fail(function(t){if(t.responseText=="duplicate"){d.alert(a.texts.class_name_duplicate);return}console.error(t),c.show(ErrorMessages.Connection_error,JSON.stringify(t))})})}function ke(e){d.prompt(a.texts.class_name_prompt,"",function(t){if(!t){d.alert(a.texts.class_name_empty);return}$.ajax({type:"PUT",url:"/class/"+e,data:JSON.stringify({name:t}),contentType:"application/json",dataType:"json"}).done(function(n){location.reload()}).fail(function(n){if(n.responseText=="duplicate"){d.alert(a.texts.class_name_duplicate);return}console.error(n),c.show(ErrorMessages.Connection_error,JSON.stringify(n))})})}function Ie(e){d.confirm(a.texts.delete_class_prompt,function(){$.ajax({type:"DELETE",url:"/class/"+e,contentType:"application/json",dataType:"json"}).done(function(t){window.location.pathname="/for-teachers"}).fail(function(t){console.error(t),c.show(ErrorMessages.Connection_error,JSON.stringify(t))})})}function U(e,t,n=!1){if(!a.profile)return d.confirm(a.texts.join_prompt,function(){localStorage.setItem("hedy-join",JSON.stringify({link:e,name:t})),window.location.pathname="/login"});$.ajax({type:"GET",url:e}).done(function(r){d.alert(a.texts.class_join_confirmation+" "+t),n||(window.location.pathname="/programs")}).fail(function(r){console.error(r),c.show(ErrorMessages.Connection_error,JSON.stringify(r))})}function Me(e,t,n){let r;n?r=a.texts.self_removal_prompt:r=a.texts.remove_student_prompt,d.confirm(r,function(){$.ajax({type:"DELETE",url:"/class/"+e+"/student/"+t,contentType:"application/json",dataType:"json"}).done(function(i){location.reload()}).fail(function(i){console.error(i),c.show(ErrorMessages.Connection_error,JSON.stringify(i))})})}function Ae(e){$(".section-button").each(function(){$(this).hasClass("blue-btn")&&($(this).removeClass("blue-btn"),$(this).addClass("green-btn"))}),$("#section-"+e).is(":visible")?($("#button-"+e).removeClass("blue-btn"),$("#button-"+e).addClass("green-btn"),$(".section").hide()):($("#button-"+e).removeClass("green-btn"),$("#button-"+e).addClass("blue-btn"),$(".section").hide(),$("#section-"+e).toggle())}function Re(e,t){let n=[];$("#adventures_overview li").each(function(){$(this).is(":visible")&&$(this).find(":input").prop("checked")&&n.push(this.getAttribute("id"))});let r=!!$(`#hide_level${t}`).prop("checked"),i=!!$(`#hide_level${t-1}`).prop("checked"),o=!!$(`#example_programs${t}`).prop("checked"),s=!!$(`#hide_level${t-1}`).prop("checked");$.ajax({type:"PUT",url:"/customize-class/"+e,data:JSON.stringify({adventures:n,example_programs:o,hide_level:r,hide_prev_level:s,hide_next_level:i,level:t}),contentType:"application/json",dataType:"json"}).done(function(l){location.reload()}).fail(function(l){console.error(l),c.show(ErrorMessages.Connection_error,JSON.stringify(l))})}function Oe(e){$("#adventures_overview li").each(function(){$(this).is(":visible")&&$(this).find(":input").prop("checked",!0)}),$("#example_programs"+e).prop("checked",!0),$("#hide_level"+e).prop("checked",!1)}var re={AF:"Afghanistan",AX:"\xC5land Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia, Plurinational State of",BQ:"Bonaire, Sint Eustatius and Saba",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo",CD:"Congo, the Democratic Republic of the",CK:"Cook Islands",CR:"Costa Rica",CI:"C\xF4te d'Ivoire",HR:"Croatia",CU:"Cuba",CW:"Cura\xE7ao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Territories",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and McDonald Islands",VA:"Holy See (Vatican City State)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic of",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People's Democratic Republic",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia, the Former Yugoslav Republic of",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, Federated States of",MD:"Moldova, Republic of",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestine, State of",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"R\xE9union",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint Barth\xE9lemy",SH:"Saint Helena, Ascension and Tristan da Cunha",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",MF:"Saint Martin (French part)",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Sint Maarten (Dutch part)",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and the South Sandwich Islands",SS:"South Sudan",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard and Jan Mayen",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan, Province of China",TJ:"Tajikistan",TZ:"Tanzania, United Republic of",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Minor Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela, Bolivarian Republic of",VN:"Viet Nam",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"};if(!window.AuthMessages)throw new Error('On a page where you load this JavaScript, you must also load the "client_messages.js" script');var a={texts:AuthMessages,profile:void 0,reset:void 0,entityify:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/`/g,"&#96;")},emailRegex:/^(([a-zA-Z0-9_+\.\-]+)@([\da-zA-Z\.\-]+)\.([a-zA-Z\.]{2,6})\s*)$/,redirect:function(e){e="/"+e,window.location.pathname=e},logout:function(){$.ajax({type:"POST",url:"/auth/logout"}).done(function(){a.redirect("login")})},destroy:function(){d.confirm(a.texts.are_you_sure,function(){$.ajax({type:"POST",url:"/auth/destroy"}).done(function(){a.redirect("")})})},error:function(e,t,n){$(n||"#error").html(e),$(n||"#error").css("display","block"),t&&$("#"+t).css("border","solid 1px red")},clear_error:function(e){$(e||"#error").html(""),$(e||"#error").css("display","none"),$("form *").css("border","")},success:function(e,t){$("#error").css("display","none"),$(t||"#success").html(e),$(t||"#success").css("display","block")},submit:function(e){var n,r;let t={};if($("form.js-validated-form *").map(function(i,o){o.id&&(t[o.id]=o.value)}),e==="signup"){let i={username:t.username,email:t.email,mail_repeat:t.mail_repeat,password:t.password,password_repeat:t.password_repeat,language:t.language,birth_year:t.birth_year?parseInt(t.birth_year):void 0,country:t.country?t.country:void 0,gender:t.gender?t.gender:void 0,subscribe:$("#subscribe").prop("checked"),is_teacher:$("#is_teacher").prop("checked"),prog_experience:$("input[name=has_experience]:checked").val(),experience_languages:$("#languages").is(":visible")?$("input[name=languages]").filter(":checked").map((o,s)=>$(s).val()).get():void 0};$.ajax({type:"POST",url:"/auth/signup",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){a.success(a.texts.signup_success),a.profile={session_expires_at:Date.now()+1e3*60*60*24},ae()}).fail(function(o){ie(o)})}if(e==="login"&&(a.clear_error(),$.ajax({type:"POST",url:"/auth/login",data:JSON.stringify({username:t.username,password:t.password}),contentType:"application/json; charset=utf-8"}).done(function(){a.profile={session_expires_at:Date.now()+1e3*60*60*24},ae()}).fail(function(i){var o;if($("#create-account-button").hide(),i.status>=500)return a.error(a.texts.server_error);i.status==400&&a.error(i.responseText),i.status===403?(a.error(a.texts.invalid_username_password+" "+a.texts.no_account),$("#create-account-button").show(),localStorage.setItem("hedy-login-username",(o=t.username)!=null?o:"")):a.error(a.texts.ajax_error)})),e==="profile"){let i={email:t.email,language:t.language,birth_year:t.birth_year?parseInt(t.birth_year):void 0,country:t.country?t.country:void 0,gender:t.gender?t.gender:void 0,prog_experience:$("input[name=has_experience]:checked").val(),experience_languages:$("#languages").is(":visible")?$("input[name=languages]").filter(":checked").map((o,s)=>$(s).val()).get():void 0};$.ajax({type:"POST",url:"/profile",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){a.success(a.texts.profile_updated),setTimeout(function(){location.reload()},1e3)}).fail(function(o){ie(o)})}if(e==="change_password"){let i={old_password:t.old_password,password:t.password,password_repeat:t.password_repeat};a.clear_error("#error-password"),$.ajax({type:"POST",url:"/auth/change_password",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){a.success(a.texts.password_updated,"#success_password"),$("#old_password").val(""),$("#password").val(""),$("#password_repeat").val("")}).fail(function(o){if(o.status>=500)return a.error(a.texts.server_error,null,"#error_password");o.status==400?a.error(a.texts[o.responseText],null,"#error_password"):o.status===403?a.error(a.texts.password_invalid,null,"#error_password"):a.error(a.texts.ajax_error,null,"#error_password")})}if(e==="recover"){let i={username:t.username};a.clear_error(),$.ajax({type:"POST",url:"/auth/recover",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){a.success(a.texts.sent_password_recovery),$("#username").val("")}).fail(function(o){if(o.status>=500)return a.error(a.texts.server_error);o.status===403?a.error(a.texts[o.responseText]):a.error(a.texts.ajax_error)})}if(e==="reset"){let i={username:(n=a.reset)==null?void 0:n.username,token:(r=a.reset)==null?void 0:r.token,password:t.password};a.clear_error(),$.ajax({type:"POST",url:"/auth/reset",data:JSON.stringify(i),contentType:"application/json; charset=utf-8"}).done(function(){a.success(a.texts.password_resetted),$("#password").val(""),$("#password_repeat").val(""),delete a.reset,a.redirect("login")}).fail(function(o){if(o.status>=500)return a.error(a.texts.server_error);o.status===400?a.error(a.texts[o.responseText]):o.status===403?a.error(a.texts.invalid_reset_link):a.error(a.texts.ajax_error)})}},markAsTeacher:function(e,t){$.ajax({type:"POST",url:"/admin/markAsTeacher",data:JSON.stringify({username:e,is_teacher:t}),contentType:"application/json; charset=utf-8"}).done(function(){d.alert(["User",e,"successfully",t?"marked":"unmarked","as teacher"].join(" "),4e3),location.reload()}).fail(function(n){console.log(n),d.alert(["Error when",t?"marking":"unmarking","user",e,"as teacher"].join(" "))})},changeUserEmail:function(e,t){d.prompt("Please enter the corrected email",t,function(n){if(n!==t){if(!n.match(a.emailRegex))return d.alert("Please enter a valid email.");$.ajax({type:"POST",url:"/admin/changeUserEmail",data:JSON.stringify({username:e,email:n}),contentType:"application/json; charset=utf-8"}).done(function(){d.alert(["Successfully changed the email for User",e,"to",n].join(" ")),location.reload()}).fail(function(r){console.log(r),d.alert(["Error when changing the email for User",e].join(" "))})}})}};if($("#country")){let e=$("#country").html();Object.keys(re).map(function(t){e+='<option value="'+t+'">'+re[t]+"</option>"}),$("#country").html(e)}$(".auth input").get().map(function(e){e.addEventListener("input",()=>a.clear_error())});$.ajax({type:"GET",url:"/profile"}).done(function(e){["/signup","/login"].indexOf(window.location.pathname)!==-1&&a.redirect("my-profile"),a.profile=e});if(window.location.pathname==="/reset"){let e=window.location.search.slice(1).split("&"),t={};e.map(function(n){let r=n.split("=");t[r[0]]=decodeURIComponent(r[1])}),!t.username||!t.token?a.redirect("recover"):a.reset=t}if(window.location.pathname==="/signup"){let e=localStorage.getItem("hedy-login-username");e&&(localStorage.removeItem("hedy-login-username"),e.match("@")?$("#email").val(e):$("#username").val(e));let t=localStorage.getItem("hedy-save-redirect");t&&t.includes("invite")&&$("#is_teacher_div").hide()}$("#email, #mail_repeat").on("cut copy paste",function(e){return e.preventDefault(),!1});async function ae(){let e=localStorage.getItem("hedy-first-save"),t=e?JSON.parse(e):void 0;if(t){await J(t[0],t[1],t[2],t[3]),localStorage.removeItem("hedy-first-save");let o=oe();if(o)return a.redirect(o)}let n=localStorage.getItem("hedy-join"),r=n?JSON.parse(n):void 0;if(r)return localStorage.removeItem("hedy-join"),U(r.link,r.name);let i=oe();if(i)return a.redirect(i);a.redirect("programs")}function oe(){let e=localStorage.getItem("hedy-save-redirect");return e&&localStorage.removeItem("hedy-save-redirect"),e}function ie(e){if(a.clear_error(),e.status>=500)return a.error(a.texts.server_error);e.status==400||e.status==403?e.responseText=="year_invalid"?a.error(a.texts[e.responseText]+new Date().getFullYear()):a.error(a.texts[e.responseText]):a.error(a.texts.ajax_error)}var S,se;(function(){window.State||(window.State={}),e($("#editor"));for(let n of $(".turn-pre-into-ace pre").get()){$(n).addClass("text-lg rounded");let r=t(n,!0);if(r.setOptions({maxLines:1/0}),r.setOptions({minLines:2}),r.setValue(r.getValue().replace(/\n+$/,""),-1),$(n).hasClass("no-copy-button")){if($(n).attr("id")){let i=String($(n).attr("id")),o=H(parseInt(i));r.session.setMode(o)}}else{let i=$("<div>").css({position:"absolute",top:5,right:5,width:"auto"}).appendTo(n);$("<button>").attr("title",UiMessages.try_button).css({fontFamily:"sans-serif"}).addClass("green-btn").text("\u21E5").appendTo(i).click(function(){S==null||S.setValue(r.getValue()+`
`)})}}function e(n){if(!n.length)return;var r=t(n.get(0),n.data("readonly"));S=r,c.setEditor(r),window.Range=ace.require("ace/range").Range;let i=window.sessionStorage;if(i){let s=n.data("lskey"),l=n.data("loaded-program"),g=i.getItem(s);l!=="True"&&g&&r.setValue(g,1),r.on("blur",function(b){i.setItem(s,r.getValue())}),r.on("change",function(){$("#inline-modal").is(":visible")&&$("#inline-modal").hide(),window.State.disable_run=!1,$("#runit").css("background-color",""),window.State.unsaved_changes=!0,le(r)})}window.onbeforeunload=()=>{if(window.State.unsaved_changes&&!window.State.no_unload_prompt)return a.texts.unsaved_changes};let o;return window.addEventListener("keydown",function(s){let l=s.keyCode;if(l===18){o=!0;return}if(l===13&&o){if(!window.State.level||!window.State.lang)throw new Error("Oh no");W(window.State.level,window.State.lang,function(){$("#output").focus()})}l===37&&document.activeElement===document.getElementById("output")&&(r.focus(),r.navigateFileEnd())}),window.addEventListener("keyup",function(s){if(s.keyCode===18){o=!1;return}}),r}function t(n,r){let i=ace.edit(n);i.setTheme("ace/theme/monokai"),r&&i.setOptions({readOnly:!0,showGutter:!1,showPrintMargin:!1,highlightActiveLine:!1});var o=1;if(o==1&&window.State.level){let s=H(parseInt(window.State.level));i.session.setMode(s)}return i}})();function H(e){return{"9":"ace/mode/level9and10","10":"ace/mode/level9and10","18":"ace/mode/level18and19","19":"ace/mode/level18and19"}[e]||"ace/mode/level"+e}function V(){return!a.profile||a.profile.session_expires_at>Date.now()?!1:(location.reload(),!0)}function le(e){e.session.clearAnnotations();for(let t in e.session.getMarkers(!1))e.session.removeMarker(t)}function W(e,t,n){if(window.State.disable_run)return d.alert(a.texts.answer_question);if(V())return;$("#output").empty(),$("#turtlecanvas").empty(),c.hide(),N.hide();try{e=e.toString();var i=S,o=j();le(i),de(),console.log(`Original program:
`,o),$.ajax({type:"POST",url:"/parse",data:JSON.stringify({level:e,code:o,lang:t,read_aloud:!!$("#speak_dropdown").val(),adventure_name:window.State.adventure_name}),contentType:"application/json",dataType:"json"}).done(function(s){if(console.log("Response",s),s.Warning&&(K(e,t),ue(e),c.showWarning(ErrorMessages.Transpile_warning,s.Warning)),s.Error){c.show(ErrorMessages.Transpile_error,s.Error),s.Location&&s.Location[0]!="?"&&(K(e,t),Ce(i,s.Location[0],s.Location[1]));return}Fe(s.Code,s.has_turtle,s.Warning,n).catch(function(l){console.log(l),c.show(ErrorMessages.Execute_error,l.message),je(e,o,l.message)})}).fail(function(s){console.error(s),s.readyState<4?c.show(ErrorMessages.Connection_error,ErrorMessages.CheckInternet):c.show(ErrorMessages.Other_error,ErrorMessages.ServerError)})}catch(s){console.error(s),c.show(ErrorMessages.Other_error,s.message)}}function ue(e){let t=parseInt(e);if(t<=2){let n=document.getElementById("repair_button");n.style.visibility="visible",n.onclick=function(r){r.preventDefault(),me(t)}}}function de(){let e=document.getElementById("repair_button");e.style.visibility="hidden"}function K(e,t){if(window.State.disable_run)return d.alert(a.texts.answer_question);if(!V())try{e=e.toString();var n=j();$.ajax({type:"POST",url:"/fix-code",data:JSON.stringify({level:e,code:n,lang:t,read_aloud:!!$("#speak_dropdown").val(),adventure_name:window.State.adventure_name}),contentType:"application/json",dataType:"json"}).done(function(r){r.FixedCode&&(sessionStorage.setItem("fixed_level_{lvl}__code".replace("{lvl}",e),r.FixedCode),ue(e))}).fail(function(r){console.error(r),r.readyState<4?c.show(ErrorMessages.Connection_error,ErrorMessages.CheckInternet):c.show(ErrorMessages.Other_error,ErrorMessages.ServerError)})}catch(r){console.error(r),c.show(ErrorMessages.Other_error,r.message)}}function Ce(e,t,n,r=1){if(e.session.setAnnotations([{row:t-1,column:(n!=null?n:1)-1,text:"",type:"error"}]),n===void 0){e.session.addMarker(new ace.Range(t-1,1,t-1,2),"editor-error","fullLine",!1);return}e.session.addMarker(new ace.Range(t-1,n-1,t-1,n-1+r),"editor-error","text",!1)}function Ne(e){if(a.profile)if(window.State.examples_left>0)window.State.examples_left=window.State.examples_left-1;else{$("#commands-window").hide(),$("#toggle-button").hide(),d.alert(a.texts.examples_used);return}var t=ace.edit("editor"),n=1;t.setValue(e+`
`,n),window.State.unsaved_changes=!1}function ce(e,t,n,r,i){window.State.unsaved_changes=!1;var o=window.State.adventure_name;Array.isArray(e)&&(o=e[1],e=e[0]),$.ajax({type:"POST",url:"/programs",data:JSON.stringify({level:e,lang:t,name:n,code:r,adventure_name:o}),contentType:"application/json",dataType:"json"}).done(function(s){var l;if(i)return s.Error?i(s):i(null,s);if(s.Warning&&c.showWarning(ErrorMessages.Transpile_warning,s.Warning),s.Error){c.show(ErrorMessages.Transpile_error,s.Error);return}d.alert(a.texts.save_success_detail,4e3),$("#program_name").val(s.name),(l=window.State.adventures)==null||l.map(function(g){g.short_name===(o||"level")&&(g.loaded_program={name:s.name,code:r})})}).fail(function(s){console.error(s),c.show(ErrorMessages.Connection_error,JSON.stringify(s)),s.status===403&&(localStorage.setItem("hedy-first-save",JSON.stringify([o?[e,o]:e,t,n,r])),localStorage.setItem("hedy-save-redirect","hedy"),window.location.pathname="/login")})}function z(e,t,n,r,i){if(c.hide(),N.hide(),!V())try{if(!a.profile)return d.confirm(a.texts.save_prompt,function(){window.State&&window.State.adventure_name&&!Array.isArray(e)&&(e=[e,window.State.adventure_name]),localStorage.setItem("hedy-first-save",JSON.stringify([e,t,n,r])),window.location.pathname="/login"});$.ajax({type:"POST",url:"/programs/duplicate-check",data:JSON.stringify({name:n}),contentType:"application/json",dataType:"json"}).done(function(o){o.duplicate?d.confirm(a.texts.overwrite_warning,function(){ce(e,t,n,r,i)}):ce(e,t,n,r,i)})}catch(o){console.error(o),c.show(ErrorMessages.Other_error,o.message)}}function J(e,t,n,r){return new Promise((i,o)=>{z(e,t,n,r,(s,l)=>{s?o(s):i(l)})})}function ge(e){return window.location.origin+"/hedy/"+e+"/view"}function Le(e,t,n,r,i){if(!a.profile)return d.alert(a.texts.must_be_logged);var o=function(g){$.ajax({type:"POST",url:"/programs/share",data:JSON.stringify({id:g,public:r}),contentType:"application/json",dataType:"json"}).done(function(b){r&&fe(ge(g),!0),d.alert(r?a.texts.share_success_detail:a.texts.unshare_success_detail,4e3),i&&setTimeout(function(){location.reload()},1e3)}).fail(function(b){console.error(b),c.show(ErrorMessages.Connection_error,JSON.stringify(b))})};if(n!==!0)return o(n);let s=`${$("#program_name").val()}`,l=j();return z(e,t,s,l,(g,b)=>{if(g&&g.Warning)return c.showWarning(ErrorMessages.Transpile_warning,g.Warning);if(g&&g.Error)return c.show(ErrorMessages.Transpile_error,g.Error);o(b.id)})}function Pe(e,t){if(!a.profile)return d.alert(a.texts.must_be_logged);if(console.log(t),!t)return d.alert(a.texts.must_be_shared);$.ajax({type:"POST",url:"/programs/submit",data:JSON.stringify({id:e}),contentType:"application/json",dataType:"json"}).done(function(n){location.reload()})}function fe(e,t){var o,s;var n=document.createElement("textarea");n.value=e,n.setAttribute("readonly",""),n.style.position="absolute",n.style.left="-9999px",document.body.appendChild(n);let r=document.getSelection(),i=r&&r.rangeCount>0?r.getRangeAt(0):void 0;n.select(),document.execCommand("copy"),document.body.removeChild(n),i&&((o=document.getSelection())==null||o.removeAllRanges(),(s=document.getSelection())==null||s.addRange(i)),t||d.alert(a.texts.copy_clipboard,4e3)}function je(e,t,n){$.ajax({type:"POST",url:"/report_error",data:JSON.stringify({level:e,code:t,page:window.location.href,client_error:n}),contentType:"application/json",dataType:"json"})}window.onerror=function(t,n,r,i,o){$.ajax({type:"POST",url:"/client_exception",data:JSON.stringify({message:t,source:n,line_number:r,column_number:i,error:o,url:window.location.href,user_agent:navigator.userAgent}),contentType:"application/json",dataType:"json"})};function Fe(e,t,n,r){window.State.programsInExecution||(window.State.programsInExecution=0),window.State.programsInExecution++;let i=$("#output");i.empty(),Sk.pre="output";let o=Sk.TurtleGraphics||(Sk.TurtleGraphics={});return o.target="turtlecanvas",$("#adventures").is(":hidden")?(o.height=600,o.worldHeight=600):(o.height=300,o.worldHeight=300),o.width=400,o.worldWidth=400,t?$("#turtlecanvas").show():$("#turtlecanvas").empty(),Sk.configure({output:g,read:b,inputfun:R,inputfunTakesPrompt:!0,__future__:Sk.python3,timeoutMsg:function(){return ErrorMessages.Program_too_long},execLimit:function(){return t?2e4:3e3}()}),Sk.misceval.asyncToPromise(function(){return Sk.importMainWithBody("<stdin>",!1,e,!0)}).then(function(f){console.log("Program executed"),window.State.programsInExecution===1&&$("#output").is(":empty")&&$("#turtlecanvas").is(":empty")&&c.showWarning(ErrorMessages.Transpile_warning,ErrorMessages.Empty_output),window.State.programsInExecution--,n||He(),r&&r()}).catch(function(f){console.log(f);let M=s(f)||JSON.stringify(f);throw new Error(M)});function s(f){return f.args&&f.args.v&&f.args.v[0]&&f.args.v[0].v}function l(f,M){$("<span>").text(f).css({color:M}).appendTo(i)}function g(f){window.State.programsInExecution>1||(l(f,"white"),pe(f))}function b(f){if(Sk.builtinFiles===void 0||Sk.builtinFiles.files[f]===void 0)throw"File not found: '"+f+"'";return Sk.builtinFiles.files[f]}function R(f){return Sk.execStart=new Date(new Date().getTime()+1e3*60*60*24*365),$("#turtlecanvas").hide(),new Promise(function(M){window.State.disable_run=!0,$("#runit").css("background-color","gray");let C=$('#inline-modal input[type="text"]');$("#inline-modal .caption").text(f),C.val(""),C.attr("placeholder",f),pe(f),setTimeout(function(){C.focus()},0),$("#inline-modal form").one("submit",function(P){return window.State.disable_run=!1,$("#runit").css("background-color",""),P.preventDefault(),$("#inline-modal").hide(),t&&$("#turtlecanvas").show(),Sk.execStart=new Date,setTimeout(function(){M(C.val()),$("#output").focus()},0),!1}),$("#inline-modal").show()})}}function pe(e){var t=$("#speak_dropdown").val();if(!!t){var n=window.speechSynthesis.getVoices().filter(r=>r.voiceURI===t)[0];if(n){let r=new SpeechSynthesisUtterance(e);r.voice=n,r.rate=.9,speechSynthesis.speak(r)}}}(()=>{if(!window.speechSynthesis||!window.State.lang)return;let e=0,t=setInterval(function(){var i;e+=1;let r=n((i=window.State.lang)!=null?i:"");if(r.length>0){for(let o of r)$("#speak_dropdown").append($("<option>").attr("value",o.voiceURI).text("\u{1F4E3} "+o.name));$("#speak_container").show(),clearInterval(t)}e>=20&&clearInterval(t)},100);function n(r){let i=r.match(/^([a-z]+)/i);if(!i)return[];let o=i[1];return window.speechSynthesis?window.speechSynthesis.getVoices().filter(s=>s.lang.startsWith(o)):[]}})();function Ge(e){if(window.State.no_unload_prompt=!0,!window.State.unsaved_changes||!a.profile)return e();d.confirm(a.texts.unsaved_changes,e)}function De(e,t){$('*[data-tabtarget="end"]').html('<iframe id="quiz-iframe" class="w-full" title="Quiz" src="/quiz/start/'+e+"?lang="+t+'"></iframe>')}function j(){try{ace.require("ace/ext/whitespace").trimTrailingSpace(S.session,!0)}catch(e){console.error(e)}return S==null?void 0:S.getValue()}function Be(){let e=document.getElementById("confetti");if(e){e.classList.remove("hidden");let t=new JSConfetti({canvas:e});setTimeout(function(){e.classList.add("hidden")},3e3);let n=$("#adventures"),r=$(n).find(".tab-selected").attr("data-tab");if(["turtle","rock","haunted","restaurant","fortune","songs","dice"].includes(r)){let s=Ue(r!=null?r:"");t.addConfetti({emojis:s,emojiSize:45,confettiNumber:100})}else t.addConfetti();let o=document.getElementById("confetti-button");o&&o.classList.add("hidden")}}function Ue(e){let t=Array.from(ErrorMessages[e]);return t!=null?t:[["\u{1F308}"],["\u26A1\uFE0F"],["\u{1F4A5}"],["\u2728"],["\u{1F4AB}"]]}function Je(){return $("#output").animate({scrollTop:$(document).height()},"slow"),!1}function me(e){Ve(e);let t=$("#modal-editor");Ke(t)}function He(){de();var e=ErrorMessages.Transpile_success,t=Math.floor(Math.random()*e.length);N.show(e[t])}function Ve(e){let t=`<div id='modal-editor' data-lskey="level_{level}__code" class="w-full flex-1 text-lg rounded" style='height:200px; width:50vw;'></div>`.replace("{level}",e.toString()),n=ErrorMessages.Program_repair;d.alert(t,0,n)}function We(e,t){let n=ace.edit(e);n.setTheme("ace/theme/monokai"),t&&n.setOptions({readOnly:!0,showGutter:!1,showPrintMargin:!1,highlightActiveLine:!1});var r=1;if(r==1&&window.State.level){let i=H(parseInt(window.State.level));n.session.setMode(i)}return n}function Ke(e){var i,o;if(!e.length)return;let t=We(e.get(0),!0);se=t,c.setEditor(t),setTimeout(function(){},2e3),window.Range=ace.require("ace/range").Range;let n=window.sessionStorage;if(n){let s=e.data("lskey"),l=0,g="";if(n.getItem("fixed_{lvl}".replace("{lvl}",s))){g=(i=n.getItem("fixed_{lvl}".replace("{lvl}",s)))!=null?i:"";let b="";for(let R=0;R<g.length+1;R++)setTimeout(function(){t.setValue(b,l),b+=g[l],l++},150*R)}else g=(o=n.getItem("warning_{lvl}".replace("{lvl}",s)))!=null?o:"",t.setValue(g)}window.onbeforeunload=()=>{if(window.State.unsaved_changes&&!window.State.no_unload_prompt)return a.texts.unsaved_changes};let r;return window.addEventListener("keydown",function(s){let l=s.keyCode;if(l===18){r=!0;return}if(l===13&&r){if(!window.State.level||!window.State.lang)throw new Error("Oh no");W(window.State.level,window.State.lang,function(){$("#output").focus()})}l===37&&document.activeElement===document.getElementById("output")&&(t.focus(),t.navigateFileEnd())}),window.addEventListener("keyup",function(s){if(s.keyCode===18){r=!1;return}}),t}function ze(e){$("#developers_toggle").is(":checked")?($("#commands-window-total").hide(),$("#adventures").hide()):(e&&$("#commands-window-total").show(),$("#adventures").show()),$("#adventures").is(":hidden")?($("#editor-area").removeClass("mt-5"),$("#code_editor").css("height",36+"em"),$("#code_output").css("height",36+"em")):($("#editor-area").addClass("mt-5"),$("#code_editor").height("22rem"),$("#code_output").height("22rem"))}function Ze(e,t,n,r,i){$("#profile").toggle(),$("#profile").is(":visible")&&($("#username").html(e),$("#email").val(t),$("#birth_year").val(n),$("#gender").val(r),$("#country").val(i))}function Ye(e){$.ajax({type:"POST",url:"/change_language",data:JSON.stringify({lang:e}),contentType:"application/json",dataType:"json"}).done(function(t){t.succes&&location.reload()}).fail(function(t){console.error(t)})}$(function(){function e(){$("#warningbox").hide(),$("#errorbox").hide(),$("#okbox").hide(),$("#output").empty(),$("#turtlecanvas").empty(),window.State.unsaved_changes=!1}function t(n){var g,b,R,f,M,C,P;let r=$('*[data-tab="'+n+'"]'),i=r.siblings("*[data-tab]"),o=$('*[data-tabtarget="'+n+'"]'),s=o.siblings("*[data-tabtarget]");i.removeClass("tab-selected"),r.addClass("tab-selected"),s.addClass("hidden"),o.removeClass("hidden");let l={};if((g=window.State.adventures)==null||g.map(function(Y){l[Y.short_name]=Y}),document.getElementById("repair_button").style.visibility="hidden",e(),n==="end"){$("#adventures-tab").css("height",""),$("#adventures-tab").css("max-height","100%"),$("#level-header input").hide(),$("#editor-area").hide();return}$("#adventures-tab").css("max-height","20em"),$("#level-header input").show(),$("#editor-area").show(),window.State.loaded_program&&(window.State.adventure_name_onload||"level")===n?($("#program_name").val(window.State.loaded_program.name),(b=S)==null||b.setValue(window.State.loaded_program.code)):((R=l[n])==null?void 0:R.loaded_program)?($("#program_name").val(l[n].loaded_program.name),(f=S)==null||f.setValue(l[n].loaded_program.code)):n==="level"&&window.State.default_program_name&&window.State.default_program?($("#program_name").val(window.State.default_program_name),(M=S)==null||M.setValue(window.State.default_program)):($("#program_name").val(l[n].default_save_name+" - "+window.State.level_title+" "+window.State.level),(C=S)==null||C.setValue(l[n].start_code)),window.State.adventure_name=n==="level"?void 0:n,(P=S)==null||P.clearSelection(),window.State.unsaved_changes=!1}if($("*[data-tab]").click(function(n){let i=$(n.target).data("tab");n.preventDefault(),window.State.unsaved_changes?d.confirm(a.texts.unsaved_changes,()=>t(i)):t(i);let o=i!=="level"?i:"";window.history&&window.history.replaceState(null,"","#"+o)}),window.State&&window.State.adventure_name)t(window.State.adventure_name);else if(window.location.hash){let n=window.location.hash.replace(/^#/,"");n&&t(n)}});function qe(e){var t=80,n=e.split(`
`),r=n.map(i=>Math.floor(i.length/t));return Qe(r)+n.length}function Qe(e){let t=0;for(let n of e)t+=n;return t}function _e(e){var t=Math.max(1,qe($(e).val())),n=t*25+4;$(e).height()<n&&$(e).css({height:`${n}px`})}var Z=!0,he=$(".translated-input").filter(function(e,t){return t.textContent!==null&&t.textContent.length>0&&$(t).parent().parent().find(".original-text")[0].textContent!==t.textContent});$("#show-hide-missing-translations").click(function(){Z?(he.each(function(e,t){$(t).parent().parent().hide()}),$("tr.bg-purple-200").hide(),Z=!1,$(this)[0].innerText="Show all translations"):(he.each(function(e,t){$(t).parent().parent().show()}),$("tr.bg-purple-200").show(),Z=!0,$(this)[0].innerText="Show only missing translations")});$("textarea").each((e,t)=>_e(t)).on("input",e=>{let t=$(e.target);t.hasClass("touched")||(t.addClass("touched"),t.attr("name",t.data("name")),Xe(t.closest("form"))),_e(t)});var we=new Map;function Xe(e){var t=e.data("file"),n=we.get(t);if(!n){var r=$('button[data-file="'+t+'"]');n={button:r,changes:0},we.set(t,n)}n.changes+=1,n.button.text(`${t} (${n.changes})`)}$("button[data-file]").click(e=>{var t=$(e.target).data("file"),n=$('form[data-file="'+t+'"]');n.submit()});return et;})();
//# sourceMappingURL=appbundle.js.map
